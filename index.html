<!DOCTYPE html>
<html id="html-lang" lang="it" data-search-suggest="on" data-lazy="on">
<head>
  <!-- ===== AREA HEAD ===== -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Echi di Sofia — Portale di Filosofia</title>
  <meta name="description" content="Portale di filosofia: antica, moderna e contemporanea, con approfondimenti su autori e correnti.">
  <meta name="theme-color" content="#0a0a1a">

  <!-- Open Graph / Social -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Echi di Sofia">
  <meta property="og:title" content="Echi di Sofia — Portale di Filosofia">
  <meta property="og:description" content="Portale di filosofia: antica, moderna e contemporanea, con approfondimenti su autori e correnti.">
  <meta property="og:image" content="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Socrates_Louvre.jpg">

  <!-- Preloads -->
  <link rel="preload" href="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Socrates_Louvre.jpg" as="image" fetchpriority="high">
  <link rel="preload" href="https://casi0048.github.io/suoni/thunder-sound.mp3" as="audio" fetchpriority="low" crossorigin type="audio/mpeg">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&amp;family=Cinzel+Decorative:wght@700&amp;family=Cormorant+Garamond:wght@600&amp;family=EB+Garamond:ital,wght@0,400;0,500;1,400&amp;family=Montserrat:wght@300;400;600&amp;display=swap" rel="stylesheet" />
  <!-- Favicon -->
  <link href="favicon_io/favicon-32x32.png" rel="icon" type="image/png" />
  <!-- Preconnessioni per caricamento font più rapido -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <!-- Icons -->
  <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" referrerpolicy="no-referrer" rel="stylesheet" />
  <!-- GSAP -->
  <script defer="" src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <!-- ===== STILI PRINCIPALI ===== -->
<style>
    :root {
      --bg: #0a0a1a;
      --gold: #d4af37;
      --cyan: #00ccff;
      --menu-bg: rgba(10, 10, 30, .98);
      --menu-border: rgba(255, 215, 0, .22);
      --glass: rgba(0, 0, 0, .35);
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%;
      margin: 0
    }

    body {
      font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: #e9eef5;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a {
      color: #9ad0ff;
      text-decoration: none;
      transition: .25s
    }

    a:hover {
      color: #fff;
      text-shadow: 0 0 6px #33ccff
    }

    /* Layers: nebula behind, stars/comets above it */
    #nebula {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
    }

    #star-canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 7;
      pointer-events: none;
    }

    /* Lightning overlay + bolt */
    #lightning {
      position: fixed;
      inset: 0;
      z-index: 50;
      pointer-events: none;
      opacity: 0;
      background: radial-gradient(circle at 50% 40%, rgba(255, 255, 255, .95), rgba(255, 255, 255, .22) 40%, transparent 65%);
      mix-blend-mode: screen;
      filter: blur(1px);
    }

    .bolt {
      position: fixed;
      width: 2px;
      height: 160px;
      background: linear-gradient(#fff, rgba(255, 255, 255, .4));
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(12deg) scaleY(0);
      box-shadow: 0 0 18px rgba(255, 255, 255, .9);
      z-index: 55;
      opacity: .7;
    }

    /* Top bar + logo + translate + search + buttons */
    .top-bar {
      position: fixed;
      top: 14px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
      padding: 8px 12px;
      background: var(--glass);
      z-index: 1000;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-right: 10px;
      text-decoration: none;
    }

    .brand svg {
      width: 34px;
      height: 34px;
      filter: drop-shadow(0 0 6px rgba(255, 215, 0, .5))
    }

    .brand span {
      font-family: 'Cinzel Decorative', cursive;
      font-weight: 700;
      letter-spacing: .5px;
      background: linear-gradient(90deg, #ffd700, #fff7b0, #ffd700);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(255, 215, 0, .35);
    }

    .bar-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #google_translate_element {
      min-width: 160px;
    }

    .ctrl-btn {
      border: 1px solid var(--menu-border);
      background: rgba(20, 20, 40, .75);
      color: #e9eef5;
      padding: .45rem .6rem;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: .2s;
      font-family: 'Montserrat', sans-serif;
    }

    .ctrl-btn:hover {
      color: #fff;
      box-shadow: 0 0 10px rgba(255, 215, 0, .25)
    }

    .ctrl-btn:active {
      transform: translateY(1px)
    }

    /* SEARCH BOX */
    .search-container input {
      width: 260px;
      max-width: 52vw;
      height: 40px;
      /* altezza fissa, cliccabile ovunque */
      line-height: 40px !important;
      /* centra il cursore */
      padding: 0 2.4rem 0 2.4rem;
      /* spazio a sinistra e destra per lente e crocetta */
      background: rgba(20, 20, 40, .78);
      border: 1px solid var(--menu-border);
      border-radius: 6px;
      color: #e0e0e0;
      font-weight: 300;
      font-size: .95rem;
      outline: none;
      transition: .25s;
      box-sizing: border-box;
      /* evita che il padding allarghi troppo l’input */
    }

    .search-container input:focus {
      border-color: rgba(255, 215, 0, .5);
      box-shadow: 0 0 12px rgba(255, 215, 0, .18)
    }

    .search-icon {
      position: absolute;
      left: .8rem;
      font-size: .95rem;
      color: rgba(255, 215, 0, .85)
    }

    header {
      margin-top: 76px;
      display: flex;
      justify-content: center;
      z-index: 900
    }

    .menu-container {
      max-width: 1200px;
      width: 100%;
      padding: .4rem 1rem;
    }

    nav.menu-desktop ul {
      display: flex;
      gap: 1px;
      list-style: none;
      margin: 0;
      padding: 0;
      justify-content: center;
      white-space: nowrap
    }

    nav.menu-desktop li {
      position: relative
    }

    .menu-btn,
    nav.menu-desktop li>a {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      background: none;
      border: none;
      cursor: pointer;
      color: #9ad0ff;
      font-family: 'Cormorant Garamond', serif;
      font-weight: 700;
      font-size: 1.35rem;
      padding: .45rem .7rem;
      border-radius: 6px;
      transition: .25s;
      text-decoration: none;
      text-shadow: 0 0 6px #33ccff99;
    }

    .menu-btn:hover,
    nav.menu-desktop li>a:hover {
      color: #fff
    }

    .arrow {
      font-size: .75rem
    }

    .mega-menu {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(10px);
      width: 980px;
      max-width: 94vw;
      background: var(--menu-bg);
      border: 1px solid var(--menu-border);
      border-top: 0;
      padding: 14px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, .4);
      backdrop-filter: blur(10px);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: .3s;
      z-index: 950;
    }

    /* Accessibilità: apertura mega-menu anche via tastiera */
    .mega-menu:focus-within {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0);
    }

    li.dropdown:hover>.mega-menu,
    li.dropdown:focus-within>.mega-menu,
    .mega-menu:hover {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0)
    }

    .mega-menu h4 {
      margin: .2rem 0 .4rem;
      font-size: 1rem;
      color: var(--gold)
    }

    .mega-menu a {
      display: block;
      color: #9ad0ff;
      font-weight: 700;
      font-size: .95rem;
      padding: .12rem 0;
    }

    .mega-menu a:hover {
      color: #fff;
      transform: translateX(3px)
    }

    /* QUOTES BAR sotto la barra del menu */
    .quotes-bar {
      position: relative;
      z-index: 880;
      margin: 10px auto 0;
      max-width: 1200px;
      width: 95%;
      background: rgba(0, 0, 0, 0);
      border: 1px solid rgba(255, 215, 0, .15);
      padding: 10px 14px;
      border-radius: 8px;
      text-align: center;
    }

    .quotes-bar .quote-text {
      font-family: 'EB Garamond', serif;
      font-size: 1.12rem;
      font-style: italic;
      color: #00CFFF;
      font-weight: 700;
    }

    .quotes-bar .author {
      margin-left: 6px;
      color: #ffd86a;
      font-size: 1rem
    }

    /* Welcome */
    .welcome-section {
      padding: 14px 16px 10px;
      text-align: center
    }

    .welcome-title {
  font-family: 'Cinzel Decorative', cursive;
  font-weight: 700;
  font-size: 3.05rem;
  color: transparent;
  background: linear-gradient(90deg, #00ff55, #00ff55); /* verde pieno brillante */
  -webkit-background-clip: text;
  background-clip: text;
  filter: drop-shadow(0 0 14px rgba(0, 255, 85, .55)); /* alone verde */
  animation: titlePulse 6s infinite;
}

    @keyframes titlePulse {

      0%,
      100% {
        transform: scale(1)
      }

      50% {
        transform: scale(1.04)
      }
    }

    .welcome-subtitle {
      margin-top: -20px;
      color: #9ad0ff;
      font-size: 1.5rem
    }

    .typing-wrap {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }

    .typing-effect {
      font-family: 'EB Garamond', serif;
      font-size: 1.4rem;
      font-style: italic;
      color: #00CFFF;
      font-weight: 700;
    }

    .caret {
      display: inline-block;
      width: 1ch;
    }

    .caret::after {
      content: "|";
      animation: blink 1s infinite;
      opacity: .8
    }

    @keyframes blink {

      0%,
      49% {
        opacity: .8
      }

      50%,
      100% {
        opacity: 0
      }
    }

    /* Exploding text */
    .exploding-text {
      margin: 16px auto 0;
      font-family: 'EB Garamond', serif;
      font-size: 1.25rem;
      font-style: italic;
      color: #e7f6ff;
      letter-spacing: .5px;
      display: inline-block;
      cursor: pointer;
      user-select: none;
      z-index: 1;
    }

    .exploding-text .ch {
      display: inline-block;
      will-change: transform, opacity
    }

    /* Particles (symbols) */
    #philoParticles {
      position: fixed;
      inset: 0;
      z-index: 10;
      pointer-events: none;
    }

    .particle {
      position: fixed;
      will-change: transform, opacity;
      user-select: none;
      white-space: nowrap;
      text-shadow: 0 0 10px rgba(255, 215, 0, .35);
      opacity: .95;
      pointer-events: auto;
      cursor: default;
      transform-origin: 50% 50%;
    }

    /* =====INIZIO SLIDER VERTICALE SINISTRA — STABILE ===== */
    .slider-vertical {
      position: fixed;
      left: 52px;
      top: 120px;
      width: 180px;
      height: 320px;
      /* viewport dello slider: fissa */
      z-index: 930;
      overflow: hidden;
      /* evita scroll interni */
      border: 1px solid rgba(255, 215, 0, .18);
      border-radius: 12px;
      background: rgba(10, 10, 25, .45);
      backdrop-filter: blur(6px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, .35);
    }

    .slider-vertical .slider-inner {
      position: absolute;
      inset: 0;
      /* left:0; right:0; top:0; bottom:0 */
      will-change: transform;
      /* animazione fluida */
    }

    .slide-vertical {
      width: 100%;
      padding: 10px 10px 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      /* Altezza totale dello “slide” coerente:
         140px immagine + ~44px caption + padding */
      box-sizing: border-box;
    }

    .slide-vertical img {
      width: 100%;
      height: 140px;
      /* tutte le immagini stessa altezza */
      object-fit: contain;
      /* nessun crop; usa cover se preferisci riempire */
      display: block;
      /* elimina line-gap */
      background: rgba(0, 0, 0, .25);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, .1);
      box-shadow: 0 6px 14px rgba(0, 0, 0, .25);
    }

    /* Didascalia con altezza uniforme → niente scossoni */
    .slide-vertical p {
      margin: .25rem 0 0;
      font-family: 'Cormorant Garamond', serif;
      font-size: .92rem;
      text-align: center;
      color: #ffe9b8;
      text-shadow: 0 0 8px rgba(255, 215, 0, .25);
      /* blocco stabile: 2 righe max senza saltelli */
      min-height: 2.6em;
      /* ~2 righe di testo */
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      /* tronca a 2 righe (se vuoi) */
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* (Opzionale) se preferisci riempire il riquadro senza “letterboxing”:
         usa object-fit: cover; per l’immagine */
    /* =====FINE SLIDER VERTICALE SINISTRA — STABILE ===== */
    /* ===== BLOB ANIMATO DESTRA (Ultimi articoli) ===== */
    .articles-blob {
      position: fixed;
      right: 14px;
      top: 200px;
      width: 300px;
      max-width: 32vw;
      z-index: 930;
      padding: 14px 16px;
      color: #e9eef5;
      border: 1px solid rgba(255, 215, 0, .18);
      border-radius: 45% 55% 50% 50%/55% 45% 55% 45%;
      background: radial-gradient(120% 120% at 10% 10%, rgba(255, 215, 0, .18), rgba(0, 180, 255, .14) 40%, rgba(0, 0, 0, .38) 78%);
      box-shadow: 0 10px 30px rgba(0, 0, 0, .4), inset 0 0 24px rgba(0, 140, 255, .15);
      animation: blobMorph 14s ease-in-out infinite;
      backdrop-filter: blur(8px);
    }

    @keyframes blobMorph {
      0% {
        transform: scale(1) translateY(0);
        border-radius: 45% 55% 50% 50%/55% 45% 55% 45%;
      }

      33% {
        transform: scale(1.02) translateY(-3px);
        border-radius: 55% 45% 45% 55%/45% 55% 45% 55%;
      }

      66% {
        transform: scale(0.98) translateY(2px);
        border-radius: 52% 48% 58% 42%/48% 52% 48% 52%;
      }

      100% {
        transform: scale(1) translateY(0);
        border-radius: 45% 55% 50% 50%/55% 45% 55% 45%;
      }
    }

    .articles-blob h3 {
      margin: .2rem 0 .5rem;
      font-family: 'Cinzel', serif;
      letter-spacing: .3px;
      color: #ffd86a;
      font-size: 1.1rem;
      text-shadow: 0 0 10px rgba(255, 215, 0, .35);
    }

    .articles-blob ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 300px;
      overflow: auto
    }

    .articles-blob li {
      margin: .35rem 0;
      display: flex;
      align-items: center;
      gap: 8px
    }

    .articles-blob li i {
      opacity: .9
    }

    .articles-blob a {
      color: #cfe8ff;
      font-weight: 700;
    }

    .articles-blob a:hover {
      color: #fff
    }

    footer {
      margin-top: auto;
      background: #000;
      color: #fff;
      text-align: center;
      padding: 24px
    }

    /* Mobile: nascondo elementi laterali per spazio */
    @media (max-width: 980px) {

      .slider-vertical,
      .articles-blob {
        display: none
      }

      .welcome-title {
        font-size: 2.3rem
      }

      .mega-menu {
        grid-template-columns: repeat(2, 1fr)
      }

      .bar-right {
        gap: 6px
      }

      #google_translate_element {
        min-width: 120px
      }

      .ctrl-btn {
        padding: .35rem .5rem
      }

      .quotes-bar {
        width: 92%
      }
    }

    /* INIZIO AGGIUNTE RESTRINGIMENTO COLONNE SUBMENU */
    /* === Mega-menu più stretto (4 colonne compatte) === */
    .menu-desktop .mega-menu.columns-4 {
      width: 700px !important;
      /* prima ~980px */
      grid-template-columns: repeat(4, 200px) !important;
      /* larghezza di ogni colonna */
      gap: 8px 12px !important;
      /* spazi più stretti */
      padding: 10px 12px !important;
    }

    /* Colonne: contenuto più denso + scrollbar se serve */
    .menu-desktop .mega-menu.columns-4>div {
      padding: 4px 6px;
      max-height: 450px;
      /* evita menu troppo alti */
      overflow: auto;
      /* scrollbar solo quando serve */
    }

    /* Titoli e link compattati */
    .menu-desktop .mega-menu.columns-4>div h4 {
      margin: 0 0 6px;
      font-size: .95rem;
    }

    .menu-desktop .mega-menu.columns-4>div a {
      margin: 2px 0;
      font-size: .92rem;
      line-height: 1.25;
    }

    /* === 1) IL MENU SOPRA A TUTTO === */
    header,
    .menu-container,
    nav.menu-desktop {
      position: relative !important;
      z-index: 9999 !important;
      /* sopra top-bar, slider, blob, player */
    }

    .menu-desktop .mega-menu {
      z-index: 10000 !important;
      /* il pannello del sottomenu ancora più in alto */
    }

    /* === 2) COLORE PANNELLO + COLONNE === */
    .menu-desktop .mega-menu {
      background: rgba(8, 18, 40, 0.98) !important;
      /* sfondo pannello */
      border: 1px solid rgba(255, 215, 0, 0.28) !important;
      box-shadow: 0 18px 40px rgba(0, 0, 0, .55) !important;
    }

    .menu-desktop .mega-menu.columns-4>div {
      background: rgba(3, 10, 24, 0.92) !important;
      /* sfondo singole colonne */
      border: 1px solid rgba(255, 255, 255, 0.06) !important;
      border-radius: 8px !important;
      padding: 8px 10px !important;
    }

    /* === 3) COLONNE PIÙ STRETTE (opzionale ma utile) === */
    .menu-desktop .mega-menu.columns-4 {
      width: 820px !important;
      grid-template-columns: repeat(4, 180px) !important;
      gap: 10px 12px !important;
      padding: 12px !important;
    }

    /* === 4) TESTO DENTRO LE COLONNE (leggibilità) === */
    .menu-desktop .mega-menu.columns-4>div h4 {
      color: #ffd86a !important;
      margin: 0 0 6px !important;
      font-size: .95rem !important;
    }

    .menu-desktop .mega-menu.columns-4>div a {
      color: #cfe8ff !important;
      font-size: .92rem !important;
      line-height: 1.25 !important;
    }

    .menu-desktop .mega-menu.columns-4>div a:hover {
      color: #ffffff !important;
    }

    /* === 5) TUTTO IL RESTO SOTTO AL MENU (evita che lo coprano) === */
    .slider-vertical,
    .articles-blob,
    #russell-box,
    #russell-hint,
    #video-right,
    #audio-player {
      z-index: 900 !important;
      /* Meno del menu */
    }

    /* --- Evita overflow orizzontale dei mega-menu --- */
    .menu-desktop .mega-menu {
      max-width: 100vw !important;
      box-sizing: border-box !important;
      /* il default del file resta centrato: left:50% + translateX(-50%) */
    }

    /* === FILOSOFIA ANTICA (2° li): aggancia a sinistra, apri verso destra/centro === */
    .menu-desktop>ul>li.dropdown:nth-child(2)>.mega-menu {
      left: 0 !important;
      right: auto !important;
      transform: translateY(10px) !important;
      /* niente translateX(-50%) */
    }

    .menu-desktop>ul>li.dropdown:nth-child(2):hover>.mega-menu,
    .menu-desktop>ul>li.dropdown:nth-child(2):focus-within>.mega-menu,
    .menu-desktop>ul>li.dropdown:nth-child(2)>.mega-menu:hover {
      transform: translateY(0) !important;
    }

    /* === FILOSOFIA POLACCA (7° li): aggancia a destra, apri verso sinistra/centro === */
    .menu-desktop>ul>li.dropdown:nth-child(7)>.mega-menu {
      right: 0 !important;
      left: auto !important;
      transform: translateY(10px) !important;
      /* niente translateX(-50%) */
    }

    .menu-desktop>ul>li.dropdown:nth-child(7):hover>.mega-menu,
    .menu-desktop>ul>li.dropdown:nth-child(7):focus-within>.mega-menu,
    .menu-desktop>ul>li.dropdown:nth-child(7)>.mega-menu:hover {
      transform: translateY(0) !important;
    }

    /* (Opzionale) dimensioni più contenute per tutte le versioni a 4 colonne */
    .menu-desktop .mega-menu.columns-4 {
      width: min(880px, 94vw) !important;
      grid-template-columns: repeat(4, minmax(160px, 1fr)) !important;
      gap: 10px 12px !important;
    }

    /* === SOLO: larghezza colonne dei mega-menu a 4 colonne === */
    .menu-desktop .mega-menu.columns-4 {
      /* lascia che la larghezza totale segua le colonne */
      width: max-content !important;
      max-width: 96vw !important;
      /* non oltre lo schermo */
      grid-template-columns: repeat(4, minmax(230px, 1fr)) !important;
      /* ← cambia 230 se vuoi più largo */
    }

    /* ogni colonna non scende sotto la misura scelta */
    .menu-desktop .mega-menu.columns-4>div {
      min-width: 220px !important;
      /* coerente con il valore sopra */
    }

    /* === FX HOVER per i link del mega-menu: freccetta + evidenza === */
    .menu-desktop .mega-menu a {
      position: relative;
      display: block;
      padding: .14rem 22px .14rem 10px;
      /* spazio per freccetta a destra */
      border-radius: 6px;
      /* evidenza fluida che “riempie” il link */
      background-image: linear-gradient(90deg, rgba(255, 215, 0, .14), rgba(0, 180, 255, .12));
      background-size: 0% 100%;
      background-repeat: no-repeat;
      transition: background-size .25s ease, transform .18s ease, color .18s ease, box-shadow .18s ease;
    }

    .menu-desktop .mega-menu a::after {
      content: "›";
      /* freccetta elegante */
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%) translateX(-6px);
      /* parte nascosta */
      opacity: 0;
      font-size: .95em;
      color: #ffd86a;
      transition: transform .22s ease, opacity .22s ease;
    }

    .menu-desktop .mega-menu a:hover,
    .menu-desktop .mega-menu a:focus {
      color: #fff;
      transform: translateX(2px);
      /* leggero slide del testo */
      background-size: 100% 100%;
      /* riempie il fondo */
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .06);
      outline: none;
    }

    .menu-desktop .mega-menu a:hover::after,
    .menu-desktop .mega-menu a:focus::after {
      opacity: 1;
      transform: translateY(-50%) translateX(0);
      /* freccetta entra */
    }

    /* Focus tastiera ben visibile */
    .menu-desktop .mega-menu a:focus-visible {
      box-shadow: 0 0 0 2px rgba(255, 215, 0, .45);
      border-radius: 6px;
    }

    /* Opzionale: stato “attivo” se vuoi segnare la pagina corrente */
    .menu-desktop .mega-menu a.is-active {
      background-size: 100% 100%;
      color: #fff;
    }

    /* === PALETTE B: VERDE PETROLIO ELEGANTE === */
    .menu-desktop .mega-menu {
      background: rgba(6, 28, 30, 0.98) !important;
      /* #061C1E */
      border-color: rgba(95, 224, 197, 0.24) !important;
      /* bordo con riflesso teal */
      box-shadow: 0 22px 45px rgba(0, 0, 0, .55) !important;
    }

    .menu-desktop .mega-menu.columns-4>div {
      background: rgba(8, 36, 38, 0.94) !important;
      /* #082426 */
      border: 1px solid rgba(255, 255, 255, 0.06) !important;
      border-radius: 8px !important;
    }

    /* I link #cfe8ff restano ben leggibili su petrolio */
    .menu-desktop .mega-menu,
    .menu-desktop .mega-menu.columns-4>div {
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    /* === COOKIE BANNER & MODAL (Echi di Sofia) === */
    .cookie-banner {
      position: fixed;
      left: 50%;
      bottom: 12px;
      transform: translateX(-50%);
      width: min(980px, 92vw);
      background: rgba(10, 10, 30, .95);
      border: 1px solid rgba(255, 215, 0, .28);
      box-shadow: 0 20px 40px rgba(0, 0, 0, .45);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding: 12px 14px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 20000;
    }

    .cookie-banner .cookie-text {
      flex: 1;
      font-size: .95rem;
      line-height: 1.45;
      color: #cfe8ff
    }

    .cookie-banner .cookie-text a {
      color: var(--gold, #d4af37);
      text-decoration: underline
    }

    .cookie-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap
    }

    .btn {
      border-radius: 8px;
      padding: .55rem .8rem;
      font-weight: 600;
      cursor: pointer;
      font-family: 'Montserrat', system-ui, Arial, sans-serif;
      border: 1px solid transparent;
    }

    .btn.solid {
      background: linear-gradient(90deg, #ffd86a, #ffb100);
      color: #000;
      border-color: rgba(255, 215, 0, .6);
    }

    .btn.outline {
      background: rgba(0, 0, 0, .2);
      color: #cfe8ff;
      border-color: rgba(0, 180, 255, .5);
    }

    .btn.ghost {
      background: transparent;
      color: #cfe8ff;
      border-color: rgba(255, 255, 255, .2);
    }

    .btn:hover {
      filter: brightness(1.08)
    }

    /* Modal overlay */
    .cookie-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .6);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 999999;
    }

    .cookie-modal[aria-hidden="false"] {
      display: flex
    }

    .cookie-modal__panel {
      width: min(640px, 92vw);
      background: rgba(10, 10, 30, .98);
      border: 1px solid rgba(255, 215, 0, .28);
      border-radius: 14px;
      padding: 16px 16px 12px;
      position: relative;
      color: #e9eef5;
    }

    .cookie-modal__panel h3 {
      margin: 0 0 .25rem;
      color: #ffd86a;
      font-family: 'Cinzel', serif;
      font-size: 1.15rem
    }

    .cookie-modal__panel .muted {
      opacity: .85;
      font-size: .95rem;
      margin: .15rem 0 .6rem
    }

    .cookie-list {
      list-style: none;
      margin: .2rem 0 .6rem;
      padding: 0;
      display: grid;
      gap: .45rem
    }

    .cookie-list li label {
      display: flex;
      align-items: center;
      gap: .5rem;
      cursor: pointer
    }

    .cookie-list small {
      display: block;
      margin-left: 1.6rem;
      opacity: .75;
      font-size: .85rem
    }

    .cookie-modal__actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: .6rem
    }

    .cookie-close {
      position: absolute;
      top: 8px;
      right: 10px;
      width: 34px;
      height: 34px;
      border-radius: 8px;
      background: rgba(255, 255, 255, .06);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, .15);
      cursor: pointer;
      font-size: 20px;
      line-height: 1;
    }

    .cookie-close:hover {
      background: rgba(255, 255, 255, .12)
    }

    /* Pulsante flottante per riaprire preferenze */
    .cookie-manage {
      position: fixed;
      left: 50%;
      bottom: 8px;
      transform: translateX(-50%);
      background: rgba(10, 10, 30, .8);
      color: #cfe8ff;
      border: 1px solid rgba(255, 215, 0, .28);
      border-radius: 999px;
      padding: .35rem .7rem;
      font-size: .85rem;
      backdrop-filter: blur(6px);
      z-index: 20001;
    }

    /* Riduci movimento se preferito dal sistema */
    @media (prefers-reduced-motion: reduce) {

      .cookie-banner,
      .cookie-modal,
      .cookie-manage {
        transition: none
      }
    }

    /* FINE AGGIUNTE RESTRINGIMENTO COLONNE SUBMENU */
    .ctrl-btn.active {
      border-color: #ffd86a;
      box-shadow: 0 0 18px rgba(255, 215, 0, .45), inset 0 0 10px rgba(255, 215, 0, .25);
    }

    .cookie-modal.force-open {
      display: flex !important;
    }
  </style>
  <style>
    .translate-box {
      display: inline-flex;
      align-items: center;
      gap: .5rem
    }

    .translate-select {
      appearance: none;
      padding: .45rem .8rem;
      border: 1px solid var(--menu-border, #2f3a3f);
      border-radius: 10px;
      background: rgba(20, 20, 40, .78);
      color: #e6f0f3;
      font-size: .95rem;
      cursor: pointer
    }

    .translate-select:focus {
      outline: 2px solid #2a7c9c
    }

    /* ===== CSE: leggibilità controlli "Ordina per" (patch minima) ===== */
    .gsc-above-wrapper-area,
    .gsc-above-wrapper-area-container,
    .gsc-orderby-container,
    .gsc-selected-option-container {
      background: transparent !important;
      color: var(--cse-txt, inherit) !important;
    }

    .gsc-option-menu {
      background: var(--cse-card, #111) !important;
      border: 1px solid rgba(255, 255, 255, .15) !important;
      box-shadow: 0 6px 18px rgba(0, 0, 0, .35) !important;
    }

    .gsc-option-menu-item {
      color: var(--cse-txt, #eee) !important;
    }

    .gsc-option-menu-item-highlighted {
      background: rgba(255, 255, 255, .07) !important;
      color: var(--cse-txt, #fff) !important;
    }

    .gsc-option-selector,
    .gsc-orderby-label,
    .gsc-selected-option-container {
      color: var(--cse-txt, inherit) !important;
    }

    .gsc-control-cse,
    .gcse-wrapper {
      background: transparent !important;
    }

    /* === Cookie UI micro-interactions === */
    .cookie-banner .btn:focus-visible,
    .cookie-modal .btn:focus-visible,
    #manage-cookies:focus-visible {
      outline: 2px solid color-mix(in oklab, #ffffff, var(--accent, #d4af37) 60%);
      outline-offset: 2px;
      box-shadow: 0 0 0 2px rgba(255, 255, 255, .08);
    }

    @media (prefers-reduced-motion: reduce) {

      .cookie-banner,
      .cookie-modal {
        transition: none !important;
      }
    }

    /* === Cookie floating badge (always visible) === */
    .cookie-fab {
      position: fixed;
      left: auto;
      right: 16px;
      bottom: 16px;
      z-index: 1000000;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      background: var(--card-2, #0f141a);
      color: var(--txt, #eaeaea);
      border: 1px solid rgba(255, 255, 255, .18);
      box-shadow: 0 10px 26px rgba(0, 0, 0, .45);
      cursor: pointer;
      pointer-events: auto;
      user-select: none;
    }

    .cookie-fab .emoji {
      font-size: 1rem;
      line-height: 1;
    }

    .cookie-fab .label {
      font-weight: 600;
      letter-spacing: .2px;
    }

    .cookie-fab:hover {
      filter: brightness(1.08);
    }

    .cookie-fab:focus-visible {
      outline: 2px solid color-mix(in oklab, #ffffff, var(--accent, #d4af37) 55%);
      outline-offset: 2px;
      box-shadow: 0 0 0 2px rgba(255, 255, 255, .08);
    }

    @media (prefers-reduced-motion: reduce) {
      .cookie-fab {
        position: fixed;
        left: auto;
        right: 16px;
        bottom: 16px;
        z-index: 20050;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 14px;
        border-radius: 999px;
        background: var(--card-2, #0f141a);
        color: var(--txt, #eaeaea);
        border: 1px solid rgba(255, 255, 255, .18);
        box-shadow: 0 10px 26px rgba(0, 0, 0, .45);
        cursor: pointer;
        user-select: none;
      }

      .cookie-fab .emoji {
        font-size: 1rem;
        line-height: 1;
      }

      .cookie-fab .label {
        font-weight: 600;
        letter-spacing: .2px;
      }
    }

    .cookie-modal.force-open {
      display: flex !important;
    }

    .symbol-rotator {
      display: inline-block;
      /* permette parole lunghe */
      max-width: 100%;
      white-space: nowrap;
      overflow: visible;
      /* non hidden */
    }
  </style>
  <style>
    /* Fallback font per simboli/emoji */
    .particle,
    .symbol-rotator {
      font-family: system-ui, "Segoe UI", Roboto, "Noto Sans", "Noto Sans Symbols 2",
        "DejaVu Sans", Symbola, "Apple Color Emoji", "Segoe UI Emoji",
        "Twemoji Mozilla", sans-serif;
    }
  </style>
  <!-- RIMOSSO: stelle cadenti/canvas -->
  <style>
    /* === MENU FIXED UNDER TOP BAR === */
    header {
      margin-top: 76px !important;
      /* distanza dalla top-bar */
      padding-bottom: 68px !important;
      /* spazio riservato per il menu fisso */
      display: flex;
      justify-content: center;
      z-index: 900;
    }

    .menu-container {
      max-width: 1200px;
      width: 100%;
      padding: .4rem 1rem;
      position: fixed !important;
      top: 76px !important;
      /* allineato alla top-bar */
      left: 50% !important;
      transform: translateX(-50%) !important;
      z-index: 999 !important;
      background: rgba(0, 0, 0, 0.85) !important;
      /* sfondo per leggibilità */
      margin-top: 0 !important;
      /* nessun rialzo */
    }

    /* === SEARCH: caret centered + larger clickable area + stable clear === */
    .search-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    .search-container input {
      height: 40px !important;
      line-height: 40px !important;
      padding: 0 2.6rem 0 3rem !important;
      /* spazio per lente a sinistra e crocetta a destra */
      box-sizing: border-box !important;
    }

    /* disabilita l'icona clear nativa */
    .search-container input::-webkit-search-cancel-button {
      -webkit-appearance: none;
    }

    /* icona clear nostra: sempre visibile e a tutta altezza */
    .search-container .clear-icon {
      position: absolute;
      right: .8rem;
      font-size: 1rem;
      color: rgba(255, 215, 0, .85);
      cursor: pointer;
      user-select: none;
      display: flex !important;
      align-items: center;
      justify-content: center;
      height: 100%;
    }

    .search-container .clear-icon:hover {
      filter: brightness(1.1);
    }
  </style>
  <style>
    /* Pulsante Tuono */
    #play-thunder {
      min-width: 60px;
      /* larghezza minima */
      min-height: 44px !important;
      /* altezza minima */
      padding: 0.6rem 1.2rem;
      display: inline-flex;
      /* per centrare il contenuto */
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }

    /* Pulsante Esplodi */
    #explode-btn {
      min-width: 60px;
      min-height: 44px !important;
      padding: 0.6rem 1.2rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }
  </style>
  <style>
    .exploding-text.explode {
      animation: explodeAnim 1.2s forwards;
    }

    @keyframes explodeAnim {
      0% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: .7;
        transform: scale(1.4) rotate(5deg);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
  <style data-cookie-remove="">
    /* Disattiva banner cookie legacy: resta solo il fab a biscottino + modal preferenze */
    .cookie-banner {
      display: none !important;
      visibility: hidden !important;
    }
  </style>
  <style data-cookie-fab-vars="">
    :root {
      --cookie-fab-bottom: 18px;
      /* regola posizione verticale */
      --cookie-fab-right: 18px;
      /* regola posizione orizzontale */
      --cookie-fab-size: 44px;
      /* altezza minima del bottone */
    }

    .cookie-fab {
      bottom: var(--cookie-fab-bottom) !important;
      right: var(--cookie-fab-right) !important;
      min-height: var(--cookie-fab-size) !important;
    }

    /* Facoltativo: ridimensiona l'emoji internamente in modo proporzionale */
    .cookie-fab .emoji {
      font-size: calc(var(--cookie-fab-size) * 0.5) !important;
      line-height: 1;
    }
  </style>
  <style data-cookie-fab-bob="">
    :root {
      /* Impostazioni animazione (puoi modificarle) */
      --cookie-bob-amp: 8px;
      /* ampiezza del su/giù */
      --cookie-bob-duration: 3.6s;
      /* durata del ciclo */
      --cookie-bob-ease: ease-in-out;
      /* curva */
    }

    /* Animazione fluttuante */
    @keyframes cookie-bob {

      0%,
      100% {
        transform: translate3d(0, 0, 0);
      }

      50% {
        transform: translate3d(0, calc(-1 * var(--cookie-bob-amp)), 0);
      }
    }

    #cookie-fab.cookie-fab {
      will-change: transform;
      animation: cookie-bob var(--cookie-bob-duration) var(--cookie-bob-ease) infinite;
    }

    /* Pausa su hover/focus per non distrarre */
    #cookie-fab.cookie-fab:hover,
    #cookie-fab.cookie-fab:focus-within {
      animation-play-state: paused;
      transform: translate3d(0, -2px, 0);
    }

    /* Rispetta utenti con riduzione movimento */
    @media (prefers-reduced-motion: reduce) {
      #cookie-fab.cookie-fab {
        animation: none !important;
      }
    }

    /* Switch globale (se vuoi spegnere da JS/HTML): 
         <html data-cookie-bob="off">
            */
    html[data-cookie-bob="off"] #cookie-fab.cookie-fab {
      animation: none !important;
    }
  </style>
  <style data-cse-suggest-css="">
    #cse-suggest {
      position: fixed;
      z-index: 11050;
      display: none;
      background: rgba(10, 10, 30, .98);
      border: 1px solid rgba(255, 215, 0, .25);
      border-radius: 10px;
      box-shadow: 0 16px 36px rgba(0, 0, 0, .55);
      padding: 6px;
      max-height: 56vh;
      overflow: auto;
    }

    #cse-suggest.show {
      display: block;
    }

    #cse-suggest .item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 8px;
      color: #cfe8ff;
      text-decoration: none;
    }

    #cse-suggest .item:hover,
    #cse-suggest .item:focus {
      background: rgba(255, 255, 255, .06);
      color: #fff;
      outline: none;
    }

    #cse-suggest .item i {
      opacity: .9
    }

    #cse-suggest .section {
      font-size: .8rem;
      letter-spacing: .02em;
      text-transform: uppercase;
      opacity: .85;
      padding: 6px 8px;
      margin: 4px 4px 2px;
      border-bottom: 1px dashed rgba(255, 255, 255, .15);
    }
  </style>
  <style data-typing-cls-fallback="">
    /* Fallback anti-CLS per typing: riserva ~2 righe */
    .typing-wrap {
      min-height: 2.6em;
    }
  </style>
  <style id="repel-vars" type="text/css">
    :root {
      --repel-radius: 120px;
      --repel-strength: 28px;
      --repel-ease: 160ms cubic-bezier(.2, .6, .3, 1);
    }
  </style>
  <style data-repel-css="">
    [data-repel-item] {
      display: inline-block;
      will-change: transform;
      transition: transform var(--repel-ease);
    }

    @media (prefers-reduced-motion: reduce) {
      [data-repel-item] {
        transition: none;
        transform: none !important;
      }
    }

    html[data-repel="off"] [data-repel-item] {
      transition: none;
      transform: none !important;
    }
  </style>
  <script data-repel-js="">
    (function(){
       const RS = getComputedStyle(document.documentElement);
       const R = parseFloat(RS.getPropertyValue('--repel-radius')) || 120;
       const S = parseFloat(RS.getPropertyValue('--repel-strength')) || 28;
       const items = Array.from(document.querySelectorAll('[data-repel-item]'));
       if(!items.length) return;
     
       let mx = 0, my = 0, raf = 0;
       function tick(){
         raf = 0;
         for(const el of items){
           const r = el.getBoundingClientRect();
           const cx = r.left + r.width/2;
           const cy = r.top  + r.height/2;
           const dx = cx - mx, dy = cy - my;
           const d  = Math.hypot(dx, dy);
           if(d < R){
             const k  = 1 - d / R;
             const tx = (dx / (d || 1)) * S * k;
             const ty = (dy / (d || 1)) * S * k;
             el.style.transform = `translate(${tx}px, ${ty}px)`;
           }else{
             el.style.transform = '';
           }
         }
       }
       function onMove(e){
         if(e.pointerType && e.pointerType !== 'mouse') return; // solo mouse
         mx = e.clientX; my = e.clientY;
         if(!raf) raf = requestAnimationFrame(tick);
       }
       window.addEventListener('pointermove', onMove, {passive:true});
       window.addEventListener('scroll', ()=>{ if(!raf) raf = requestAnimationFrame(tick); }, {passive:true});
     })();
  </script>
  <style data-explode-cls-guard="">
    /* Anti-CLS exploding text: evita il wrap durante l'animazione */
    .exploding-text {
      white-space: nowrap !important;
    }
  </style>
  <!-- ===== ANIMAZIONI/COSMO ===== -->
<!-- RIMOSSO: cosmo dinamico (galaxy, stars, meteors, stardust, planets) -->
  <!-- Fix conservativi per click footer e link -->
  <style id="fix-conservativo">
    /* Lascia passare i click dai layer decorativi al contenuto */
    .galaxy,
    .stars,
    .stardust,
    .meteor-shower,
    .planet,
    .planet-ring,
    .star,
    .meteor,
    .supernova,
    .particle {
      pointer-events: none !important;
    }

    /* Assicura che il footer stia sopra i layer decorativi senza alterare la grafica */
    footer {
      position: relative;
      z-index: 20;
    }
  </style>
  <style>
    /* Dizionario filosofico — CLICK-SAFE (senza JS), compatto */
    .edx-dict {
      background: rgba(10, 10, 30, .9);
      border: 1px solid rgba(255, 215, 0, .35);
      border-radius: 10px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, .28);
      margin: 8px 0;
      position: relative;
      z-index: 1;
    }

    .edx-dict[open] {
      box-shadow: 0 8px 18px rgba(0, 0, 0, .35);
    }

    .edx-dict__head {
      list-style: none;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 4px 8px;
      cursor: pointer;
      user-select: none;
      min-height: 26px;
    }

    .edx-dict__head::-webkit-details-marker {
      display: none
    }

    .edx-dict__title {
      font-family: 'Cinzel', serif;
      color: #ffd86a;
      font-weight: 700;
      font-size: .9rem;
    }

    .edx-dict__chev {
      margin-left: auto;
      font-size: .85rem;
      color: #e9eef5;
      transition: transform .2s ease;
    }

    .edx-dict[open] .edx-dict__chev {
      transform: rotate(180deg)
    }

    .edx-dict__body {
      border-top: 1px solid rgba(255, 255, 255, .08);
      padding: 6px 8px;
    }

    .edx-dict__controls {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .edx-dict__controls input[name="query"] {
      box-sizing: border-box;
      flex: 1;
      min-width: 160px;
      height: 22px;
      line-height: 22px;
      padding: 0 .55rem;
      background: rgba(20, 20, 40, .78);
      border: 1px solid rgba(255, 215, 0, .28);
      border-radius: 6px;
      color: #e9eef5;
      font-size: .85rem;
    }

    .edx-dict__controls button[type="submit"] {
      appearance: none;
      -webkit-appearance: none;
      box-sizing: border-box;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 22px;
      padding: 0 .45rem;
      line-height: 1;
      font-size: .8rem;
      border: 1px solid rgba(255, 215, 0, .28);
      background: rgba(255, 255, 255, .06);
      color: #e9eef5;
      border-radius: 6px;
      cursor: pointer;
    }

    @media (max-width:980px) {
      .edx-dict {
        display: none
      }
    }

    /* forza la logica apri/chiudi del <details> */
    .edx-dict .edx-dict__body {
      display: none;
    }

    .edx-dict[open] .edx-dict__body {
      display: block;
    }

    < !-------------------------------------------------------->

    /* più aria sotto il box */
    .edx-dict {
      margin: 16px 0 16px;
    }

    .edx-dict[open] {
      margin-bottom: 24px;
    }

    /* opzionale: anche l’iframe parte un po’ più giù */
    aside iframe,
    .sidebar iframe {
      margin-top: 12px;
      display: block;
    }

    /* il box sta sopra */
    .edx-dict {
      position: relative;
      z-index: 10;
    }

    /* l’iframe sta sotto */
    aside iframe,
    .sidebar iframe {
      position: relative;
      z-index: 0;
    }

    /* vale quando il dizionario è subito prima dell'iframe */
    .edx-dict[open]+iframe {
      pointer-events: none;
      /* non cattura click mentre il box è aperto */
      filter: opacity(.6) grayscale(.2);
      /* feedback visivo, facoltativo */
      margin-top: 12px;
      /* piccolo distacco extra */
    }

    /* regola definitiva, vince su tutto */
    body .edx-dict {
      margin-bottom: 32px !important;
    }

    < !------------------------>

    /* Stile per la tendina delle fonti */
    .edx-dict__select {
      background: rgba(20, 20, 40, .85);
      /* sfondo scuro */
      color: #ffd86a;
      /* testo leggibile */
      border: 1px solid rgba(255, 215, 0, .35);
      border-radius: 6px;
      padding: 2px 6px;
      font-size: .85rem;
      font-family: 'Cinzel', serif;
      cursor: pointer;
    }

    /* Colori anche quando si apre la lista */
    .edx-dict__select option {
      background: rgba(10, 10, 30, .95);
      /* scuro uniforme */
      color: #e9eef5;
      /* testo chiaro */
    }
  </style>
  <!-- ===== Dizionario filosofico — multi-fonte, compatto ===== -->
  <style>
    .edx-dict {
      background: rgba(10, 10, 30, .9);
      border: 1px solid rgba(255, 215, 0, .35);
      border-radius: 10px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, .28);
      margin: 16px 0 32px;
      position: relative;
      z-index: 10;
    }

    .edx-dict[open] {
      box-shadow: 0 8px 18px rgba(0, 0, 0, .35)
    }

    .edx-dict__head {
      list-style: none;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 4px 8px;
      cursor: pointer;
      user-select: none;
      min-height: 26px;
    }

    .edx-dict__head::-webkit-details-marker {
      display: none
    }

    .edx-dict__title {
      font-family: 'Cinzel', serif;
      color: #ffd86a;
      font-weight: 700;
      font-size: .9rem
    }

    .edx-dict__chev {
      margin-left: auto;
      font-size: .85rem;
      color: #e9eef5;
      transition: transform .2s ease
    }

    .edx-dict[open] .edx-dict__chev {
      transform: rotate(180deg)
    }

    .edx-dict__body {
      border-top: 1px solid rgba(255, 255, 255, .08);
      padding: 6px 8px
    }

    .edx-dict__controls {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap
    }

    .edx-dict__select {
      height: 22px;
      padding: 0 .4rem;
      font-size: .8rem;
      border: 1px solid rgba(255, 215, 0, .28);
      border-radius: 6px;
      background: rgba(255, 255, 255, .06);
      color: #e9eef5;
    }

    .edx-dict__input {
      flex: 1;
      min-width: 150px;
      height: 22px;
      line-height: 22px;
      padding: 0 .55rem;
      background: rgba(20, 20, 40, .78);
      border: 1px solid rgba(255, 215, 0, .28);
      border-radius: 6px;
      color: #e9eef5;
      font-size: .85rem;
      box-sizing: border-box;
    }

    .edx-dict__btn {
      appearance: none;
      -webkit-appearance: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 22px;
      padding: 0 .45rem;
      line-height: 1;
      font-size: .8rem;
      border: 1px solid rgba(255, 215, 0, .28);
      border-radius: 6px;
      cursor: pointer;
      background: rgba(255, 255, 255, .06);
      color: #e9eef5;
    }

    /* garantisci apri/chiudi con <details> */
    .edx-dict .edx-dict__body {
      display: none
    }

    .edx-dict[open] .edx-dict__body {
      display: block
    }

    /* se è subito sopra un iframe, tieni aria e blocca click quando aperto */
    .edx-dict[open]+iframe {
      pointer-events: none;
      margin-top: 12px;
      filter: opacity(.85)
    }

    /* stacco definitivo sotto anche se altri CSS sovrascrivono */
    body .edx-dict {
      margin-bottom: 32px !important;
    }

    @media (max-width:980px) {
      .edx-dict {
        display: none
      }
    }
  </style>
  <style>
    /* ===== CONTROLLI SLIDER VERTICALE — Eleganti e coerenti ===== */
    .slider-controls {
      position: fixed;
      left: 52px;
      top: 460px;
      /* sotto lo slider (320px altezza + margine) */
      width: 180px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      background: rgba(10, 10, 25, .55);
      border: 1px solid rgba(255, 215, 0, .18);
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, .35);
      z-index: 930;
    }

    .slider-controls .ctrl-btn {
      background: rgba(20, 20, 40, .7);
      border: 1px solid rgba(255, 215, 0, .25);
      border-radius: 8px;
      color: #ffd86a;
      font-weight: 600;
      cursor: pointer;
      padding: 6px;
      transition: all .2s;
      font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .slider-controls .ctrl-btn:hover {
      background: rgba(255, 215, 0, .15);
      box-shadow: 0 0 8px rgba(255, 215, 0, .4);
    }

    .slider-controls .speed-label {
      display: flex;
      flex-direction: column;
      font-size: .8rem;
      color: #cfe8ff;
      font-family: 'Montserrat', sans-serif;
      gap: 4px;
    }

    .slider-controls input[type=range] {
      width: 100%;
      accent-color: #ffd86a;
    }

    @media (max-width: 980px) {
      .slider-controls {
        display: none;
      }
    }
  </style>
  <style>
    /* Didascalie leggibili e immagini pulite nello slider */
    .slider-vertical .slide-vertical p {
      background: linear-gradient(to bottom, rgba(0, 0, 0, .35), rgba(0, 0, 0, .35));
      padding: 4px 6px;
      border-radius: 6px;
    }

    .slider-vertical .slide-vertical img {
      object-fit: contain;
      /* mantiene proporzioni senza crop */
      background: rgba(0, 0, 0, .35);
    }
  </style>
  <!-- INIZIO CSS CONTROLLI SLIDER SAFARI  -->
  <!-- ===== Slider velocità – fix Safari & co. ===== -->
  <STYLE>
    .slider-controls input[type="range"] {
      -webkit-appearance: none;
      /* Safari/Chrome: toglie lo stile di default */
      appearance: none;
      width: 160px;
      height: 10px;
      /* altezza visibile del track */
      background: rgba(10, 12, 24, .85);
      /* sfondo track (fallback) */
      border: 1px solid rgba(212, 175, 55, .35);
      border-radius: 9999px;
      box-shadow: inset 0 0 8px rgba(212, 175, 55, .25), 0 0 10px rgba(0, 0, 0, .35);
      outline: none;
    }

    /* Track (WebKit: Safari/Chrome) */
    .slider-controls input[type="range"]::-webkit-slider-runnable-track {
      height: 10px;
      background: linear-gradient(90deg,
          rgba(212, 175, 55, .85) 0%,
          rgba(212, 175, 55, .55) 60%,
          rgba(212, 175, 55, .25) 100%);
      border-radius: 9999px;
      box-shadow: inset 0 0 6px rgba(212, 175, 55, .35);
    }

    /* Thumb (WebKit) */
    .slider-controls input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      margin-top: -4px;
      /* centra il thumb sul track */
      background: #d4af37;
      border: 2px solid #0f1426;
      border-radius: 50%;
      box-shadow: 0 0 12px rgba(212, 175, 55, .9);
      cursor: pointer;
    }

    /* Track (Firefox) */
    .slider-controls input[type="range"]::-moz-range-track {
      height: 10px;
      background: linear-gradient(90deg,
          rgba(212, 175, 55, .85) 0%,
          rgba(212, 175, 55, .55) 60%,
          rgba(212, 175, 55, .25) 100%);
      border: 1px solid rgba(212, 175, 55, .35);
      border-radius: 9999px;
      box-shadow: inset 0 0 6px rgba(212, 175, 55, .35);
    }

    /* Thumb (Firefox) */
    .slider-controls input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: #d4af37;
      border: 2px solid #0f1426;
      border-radius: 50%;
      box-shadow: 0 0 12px rgba(212, 175, 55, .9);
      cursor: pointer;
    }

    /* Stato focus/hover (accessibilità) */
    .slider-controls input[type="range"]:focus::-webkit-slider-thumb,
    .slider-controls input[type="range"]:hover::-webkit-slider-thumb {
      box-shadow: 0 0 16px rgba(212, 175, 55, 1);
    }

    .slider-controls input[type="range"]:focus {
      outline: 2px solid rgba(212, 175, 55, .5);
      outline-offset: 2px;
    }
  </STYLE>
  <!--FINE CSS CONTROLLI SLIDER SAFARI  -->
  <style id="audio-player-range-css">
    /* === AUDIO-PLAYER RANGE: colore azzurro, nessuna ombra (Safari incluso) === */
    .audio-player input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 120px;
      height: 28px;
      background: transparent;
      margin: 0;
      border: 0;
    }

    /* Track (WebKit: Safari/Chrome) */
    .audio-player input[type="range"]::-webkit-slider-runnable-track {
      height: 6px;
      background: #199cff;
      border: none;
      border-radius: 999px;
    }

    /* Thumb (WebKit) */
    .audio-player input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      margin-top: -5px;
      background: #fff;
      border: 2px solid #199cff;
      border-radius: 50%;
      box-shadow: none;
    }

    /* Firefox */
    .audio-player input[type="range"]::-moz-range-track {
      height: 6px;
      background: #199cff;
      border: none;
      border-radius: 999px;
    }

    .audio-player input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #fff;
      border: 2px solid #199cff;
      border-radius: 50%;
      box-shadow: none;
    }

    .audio-player input[type="range"]::-moz-range-progress {
      height: 6px;
      background: #199cff;
      border-radius: 999px 0 0 999px;
    }
  </style>
  <style id="speed-range-hard-fix-css">
    /* Wrapper del controllo velocità (solo per lo speed range) */
    .range-ui-speed {
      position: relative;
      height: 28px;
      /* area comoda al dito */
    }

    /* Track visibile SEMPRE (Safari compreso) */
    .range-ui-speed .speed-track {
      position: absolute;
      left: 0;
      right: 0;
      top: 50%;
      height: 8px;
      transform: translateY(-50%);
      background: #ffd86a;
      /* oro pieno */
      border: 1px solid rgba(255, 255, 255, .15);
      border-radius: 999px;
      pointer-events: none;
      z-index: 0;
    }

    /* L’input sta sopra e non disegna track nativo */
    .range-ui-speed>input[type="range"] {
      position: relative;
      z-index: 1;
      width: 100%;
      height: 100%;
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      border: 0;
      margin: 0;
    }

    /* Thumb (pallina) – nessuna ombra */
    .range-ui-speed>input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      margin-top: -5px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #ffd86a;
      box-shadow: none;
    }

    /* Disattiva il track nativo WebKit (evita “doppio binario”) */
    .range-ui-speed>input[type="range"]::-webkit-slider-runnable-track {
      background: transparent;
      height: 8px;
    }

    /* Firefox, per coerenza visiva */
    .range-ui-speed>input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #ffd86a;
      box-shadow: none;
    }

    .range-ui-speed>input[type="range"]::-moz-range-track {
      height: 8px;
      background: transparent;
      border: 0;
    }
  </style>
  <script>
    // PATCH SAFARI: shim iniziale
             window.thunderOn = window.thunderOn ?? false;
             window.updateLabel = window.updateLabel || function(){
               var b = document.getElementById('btn-thunder');
               if (!b) return;
               b.classList.toggle('active', !!window.thunderOn);
               b.setAttribute('aria-pressed', window.thunderOn ? 'true' : 'false');
               b.textContent = window.thunderOn ? '⚡ Tuono: ON' : '⚡ Tuono';
             };
  </script>
  <style>
    /* PATCH SAFARI: controlli Tuono (visibilità) */
    #thunder-controls {
      position: fixed;
      left: 52px;
      top: 420px;
      z-index: 9999;
      display: flex;
    }

    #thunder-controls .ctrl-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 44px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255, 215, 0, .25);
      background: rgba(20, 20, 40, .7);
      color: #ffd86a;
      font-weight: 600;
      cursor: pointer;
    }

    @media (max-width:980px) {
      #thunder-controls {
        display: flex !important;
        left: 10px;
        top: auto;
        bottom: 16px;
      }
    }
  </style>
  <script>
    // PATCH SAFARI: WebAudio v2 (audible on phone speakers)
             (function(){
               var btn = document.getElementById('btn-thunder');
               if (!btn) return;
               var clone = btn.cloneNode(true); btn.parentNode.replaceChild(clone, btn);
               btn = document.getElementById('btn-thunder') || clone;
               var audioEl = document.getElementById('thunder-sound');
               var ctx = null;
               var isSafari = /Safari\//.test(navigator.userAgent) && !/Chrome|Chromium|Edg\//.test(navigator.userAgent);
             
               function webAudioThunder(){
                 try {
                   ctx = ctx || new (window.AudioContext || window.webkitAudioContext)();
                   var startUnlock = ctx.state === 'suspended' ? ctx.resume() : Promise.resolve();
                   return startUnlock.then(function(){
                     var sr = ctx.sampleRate;
                     var now = ctx.currentTime;
                     var master = ctx.createGain(); master.gain.value = 0.9; master.connect(ctx.destination);
             
                     var crackDur = 0.09, crackN = (sr*crackDur)|0;
                     var crackBuf = ctx.createBuffer(1, crackN, sr);
                     var cch = crackBuf.getChannelData(0);
                     for (var i=0;i<crackN;i++){ cch[i] = (Math.random()*2-1) * (1 - i/crackN); }
                     var crackSrc = ctx.createBufferSource(); crackSrc.buffer = crackBuf;
                     var bp = ctx.createBiquadFilter(); bp.type = "bandpass"; bp.frequency.value = 1800; bp.Q.value = 3.5;
                     var hp = ctx.createBiquadFilter(); hp.type = "highpass"; hp.frequency.value = 600;
                     var cg = ctx.createGain(); cg.gain.setValueAtTime(0.0, now);
                     cg.gain.linearRampToValueAtTime(0.8, now + 0.01);
                     cg.gain.exponentialRampToValueAtTime(0.05, now + crackDur);
                     crackSrc.connect(bp); bp.connect(hp); hp.connect(cg); cg.connect(master);
                     crackSrc.start(now);
             
                     var rumDur = 2.6, rumN = (sr*rumDur)|0;
                     var rumBuf = ctx.createBuffer(1, rumN, sr);
                     var rch = rumBuf.getChannelData(0);
                     var last = 0;
                     for (var j=0;j<rumN;j++){
                       var white = Math.random()*2 - 1;
                       var brown = (last + 0.02*white)/1.02; last = brown;
                       var t = j/rumN;
                       var env = Math.exp(-2.1*t);
                       rch[j] = brown * 0.75 * env;
                     }
                     var rumSrc = ctx.createBufferSource(); rumSrc.buffer = rumBuf;
                     var lp = ctx.createBiquadFilter(); lp.type = "lowpass"; lp.frequency.value = 220;
                     var rg = ctx.createGain(); rg.gain.setValueAtTime(0.0, now);
                     rg.gain.linearRampToValueAtTime(0.7, now + 0.02);
                     rg.gain.exponentialRampToValueAtTime(0.0001, now + rumDur);
                     rumSrc.connect(lp); lp.connect(rg); rg.connect(master);
                     rumSrc.start(now + 0.02);
             
                     var tailDur = 0.3, tailN = (sr*tailDur)|0;
                     var tailBuf = ctx.createBuffer(1, tailN, sr);
                     var tch = tailBuf.getChannelData(0);
                     for (var k=0;k<tailN;k++){ tch[k] = (Math.random()*2-1) * Math.pow(1 - k/tailN, 2); }
                     var tailSrc = ctx.createBufferSource(); tailSrc.buffer = tailBuf;
                     var tailBP = ctx.createBiquadFilter(); tailBP.type = "bandpass"; tailBP.frequency.value = 900; tailBP.Q.value = 2;
                     var tg = ctx.createGain(); tg.gain.setValueAtTime(0.0, now);
                     tg.gain.linearRampToValueAtTime(0.4, now + 0.05);
                     tg.gain.exponentialRampToValueAtTime(0.0001, now + tailDur);
                     tailSrc.connect(tailBP); tailBP.connect(tg); tg.connect(master);
                     tailSrc.start(now + 0.02);
             
                     setTimeout(function(){ try{ master.disconnect(); }catch(_){ } }, 3200);
                   });
                 } catch(e) { if (console && console.warn) console.warn('WebAudio failed', e); return Promise.resolve(); }
               }
             
               function playThunder(){
                 if (isSafari) return webAudioThunder();
                 if (audioEl){
                   try {
                     audioEl.currentTime = 0;
                     var p = audioEl.play();
                     if (p && p.then) return p.catch(function(){ return webAudioThunder(); });
                     return Promise.resolve();
                   } catch(_){ return webAudioThunder(); }
                 }
                 return webAudioThunder();
               }
             
               btn.addEventListener('click', function(e){
                 e.preventDefault();
                 window.thunderOn = !window.thunderOn;
                 if (window.updateLabel) window.updateLabel();
                 if (window.thunderOn) { playThunder(); }
                 else { try { audioEl && (audioEl.pause(), audioEl.currentTime=0); } catch(_){} }
               });
             
               if (window.updateLabel) window.updateLabel();
             })();
  </script>
  <style id="blob-vivace-smooth-override">
    /* Blob vivace ma fluido */
    .articles-blob {
      animation: blobMorphSmooth 12s cubic-bezier(.55, .2, .45, .8) infinite !important;
      will-change: transform, border-radius;
    }

    @keyframes blobMorphSmooth {
      0% {
        transform: scale(1) translateY(0);
        border-radius: 45% 55% 50% 50%/55% 45% 55% 45%;
      }

      33% {
        transform: scale(1.03) translateY(-4px);
        border-radius: 55% 45% 47% 53%/47% 53% 47% 53%;
      }

      66% {
        transform: scale(0.97) translateY(4px);
        border-radius: 50% 50% 53% 47%/53% 47% 53% 47%;
      }

      100% {
        transform: scale(1) translateY(0);
        border-radius: 45% 55% 50% 50%/55% 45% 55% 45%;
      }
    }
  </style>
  <style id="speed-label-css">
    /* Testo sopra alla barra di velocità con variabili regolabili */
    #slider-controls .speed-label-text {
      font-size: var(--speed-label-size, 0.80rem);
      /* testo più piccolo/più grande */
      line-height: 1.2;
      position: relative;
      top: var(--speed-label-offset, -3px);
      /* su/giù */
      left: var(--speed-label-x, 40px);
      /* sinistra/destra */
      margin-bottom: var(--speed-label-gap, 6px);
      /* spazio dal cursore */
      color: var(--speed-label-color, #d4af37);
      /* colore testo (default dorato) */
    }

    /* opzionale: default per il contenitore controlli */
    #slider-controls {
      --speed-label-size: 0.80rem;
      --speed-label-offset: -3px;
      /* valori negativi = più su; positivi = più giù */
      --speed-label-x: 30px;
      /* negativo = verso sinistra; positivo = verso destra */
      --speed-label-gap: 6px;
      --speed-label-color: #d4af37;
      /* dorato coerente col sito */
    }

    /* Mantieni il label come blocco per avere il testo sopra lo slider */
    #slider-controls .speed-label {
      display: block;
    }
  </style>
  <style id="search-suggest-style">
    #search-suggest-box {
      position: absolute;
      background: rgba(15, 15, 30, .98);
      border: 1px solid rgba(120, 120, 140, .5);
      border-radius: 8px;
      padding: 6px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
      backdrop-filter: blur(6px);
      z-index: 9999;
      display: none;
    }

    #search-suggest-box.show {
      display: block;
    }

    #search-suggest-box .section {
      font-size: 12px;
      opacity: .75;
      padding: 4px 6px;
      margin-bottom: 4px;
      color: #c6d3ff;
    }

    #search-suggest-box .item {
      display: block;
      padding: 6px 8px;
      text-decoration: none;
      color: #dbe7ff;
      border-radius: 6px;
    }

    #search-suggest-box .item:hover {
      color: #fff;
      background: rgba(255, 255, 255, .05);
    }
  </style>
  <script type="application/ld+json" id="seo-website">
    { "@context": "https://schema.org", "@type": "WebSite", "name": "Echi di Sofia", "url": "https://www.echidisofia.org/", "description": "Portale di filosofia antica, moderna e contemporanea", "inLanguage": "it" }
  </script>
  <style>
    /* Foto fluttuante come particella */
    .particle.float-person {
      position: absolute;
      top: 0;
      left: 0;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 0 18px rgba(212, 175, 55, .35);
      border: 2px solid rgba(212, 175, 55, .6);
      pointer-events: none;
      z-index: 40;
      will-change: transform;
    }
  </style>

<style id="planet-off">
  /* Disable all planet elements site-wide */
  .planet{ display: none !important; }
</style>

<style data-mobile-drawer-cse="">
/* Drawer mobile per #cse-suggest */
@media (max-width: 980px){
  #cse-suggest{
    position: fixed !important;
    left: 0 !important;
    right: 0 !important;
    width: 100vw !important;
    top: var(--topbar-height, 64px) !important;
    max-height: min(60vh, 480px);
    overflow: auto;
    border-radius: 0 0 16px 16px;
    padding: 10px 12px;
    z-index: 11050; /* sopra i menu */
    box-shadow: 0 12px 30px rgba(0,0,0,.45);
  }
  /* Evita scroll di sfondo quando la tendina è aperta su alcuni browser */
  body.drawer-open{
    overscroll-behavior: contain;
  }
}

/* Focus visibile: mega menu + risultati tendina */
.mega-menu a:focus-visible,
#cse-suggest .item:focus-visible{
  outline: 2px solid #d4af37;
  outline-offset: 2px;
  border-radius: 8px;
}

/* Scroll armonizzato: ripristina scroll verticale sicuro */
html, body { overflow-y: auto !important; }

/* Modalità "soft" per i layer cosmici (riduzione animazioni se serve) */
@media (prefers-reduced-motion: reduce){
  #philoParticles, #particles-js, #stars-canvas, .meteors, .comets {
    animation: none !important;
    transition: none !important;
  }
  #philoParticles { opacity: .7; }
}

/* Piccolo alleggerimento su schermi molto piccoli */
@media (max-width: 480px){
  :root{ --cosmo-opacity:.85; }
  #philoParticles{ opacity: var(--cosmo-opacity, 1); }
}
</style>


<style data-cse-drawer-anim="">
/* Animazione drawer mobile per #cse-suggest */
@media (max-width: 980px){
  #cse-suggest{
    /* Mantieni il drawer sempre "in flusso" su mobile per permettere la transizione */
    display: block !important;
    opacity: 0;
    transform: translateY(-8px);
    visibility: hidden;
    pointer-events: none;
    will-change: transform, opacity;
    transition: opacity .22s ease, transform .26s ease;
  }
  #cse-suggest.show{
    opacity: 1;
    transform: none;
    visibility: visible;
    pointer-events: auto;
  }
}
@media (prefers-reduced-motion: reduce){
  #cse-suggest{ transition: none !important; }
}
</style>


<style data-cse-drawer-anim-enhance="">
@media (max-width: 980px){
  /* Transizioni più morbide e shadow più soffice quando aperto */
  #cse-suggest{
    transition:
      opacity .26s cubic-bezier(.16,1,.3,1),
      transform .34s cubic-bezier(.16,1,.3,1),
      box-shadow .28s ease-out;
    box-shadow: 0 8px 24px rgba(0,0,0,.35);
  }
  #cse-suggest.show{
    /* Ombra più diffusa e leggera aurea interna coerente col tema */
    box-shadow:
      0 18px 48px rgba(0,0,0,.55),
      0 0 0 1px rgba(212,175,55,.18) inset;
  }
}
@media (prefers-reduced-motion: reduce){
  #cse-suggest{ transition: none !important; }
}
</style>


<style id="no-cosmos-clean">
  body { background: var(--bg, #0a0a1a) !important; overflow-x: hidden; }
  #nebula, #star-canvas, #lightning, .bolt,
  .galaxy, .stars, .stardust, .meteor-shower,
  .planet, .planet-ring, .star, .meteor, .supernova, .particle,
  canvas {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }
</style>

</head>

<body>
  <div class="slider-vertical">
    <div class="slider-inner">
      <div class="slide-vertical">
        <img alt="Socrate" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Socrates_Louvre.jpg" loading="eager" decoding="async" width="260" height="340" />
        <p>Socrate</p>
      </div>
      <div class="slide-vertical">
        <img alt="Platone" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/platone.png" loading="lazy" decoding="async" width="260" height="340" />
        <p>Platone</p>
      </div>
      <div class="slide-vertical">
        <img alt="Aristotele" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Aristotle_.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Aristotele</p>
      </div>
      <div class="slide-vertical">
        <img alt="Maria Teresa" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/maria_teresa.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>🕯️Maria Teresa: virtù e bellezza in armonia✝️</p>
      </div>
      <div class="slide-vertical">
        <img alt="Livia" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Livia.jpeg" loading="lazy" decoding="async" width="260" height="340" />
        <p>👑🦌Livia🦅DEA egizia🔱</p>
      </div>
      <div class="slide-vertical">
        <img alt="Cartesio" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/cartesio.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Cartesio</p>
      </div>
      <div class="slide-vertical">
        <img alt="Kant" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/kant.webp" loading="lazy" decoding="async" width="260" height="340" />
        <p>Kant - il più zoppo tra gli storpi del concetto</p>
      </div>
      <div class="slide-vertical">
        <img alt="Gadamer" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/gadamer.webp" loading="lazy" decoding="async" width="260" height="340" />
        <p>H.G.Gadamer</p>
      </div>
      <div class="slide-vertical">
        <img alt="Polpetta" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/polpetta.webp" loading="lazy" decoding="async" width="260" height="340" />
        <p>🏹 Polpetta🦸: guerriera celtica</p>
      </div>
      <div class="slide-vertical">
        <img alt="Ricoeur" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/ricoeur.webp" loading="lazy" decoding="async" width="260" height="340" />
        <p>P. Ricoeur</p>
      </div>
      <div class="slide-vertical">
        <img alt="Levinas" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/levinas.webp" loading="lazy" decoding="async" width="260" height="340" />
        <p>E. Lévinas</p>
      </div>
      <div class="slide-vertical">
        <img alt="San Tommaso" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/s.Tommaso.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>San Tommaso</p>
      </div>
      <div class="slide-vertical">
        <img alt="Cerbero" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/cerbero.webp" loading="lazy" decoding="async" width="260" height="340" />
        <p>Cerbero - Guardiano dell'Ade</p>
      </div>
      <div class="slide-vertical">
        <img alt="Nietzsche" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/friedrich-nietzsche.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Nietzsche</p>
      </div>
      <div class="slide-vertical">
        <img alt="Dea" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/dea.jpeg" loading="lazy" decoding="async" width="260" height="340" />
        <p>𓍝Divinità mesopotamica⚯</p>
      </div>
      <div class="slide-vertical">
        <img alt="Gianni Vattimo" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/vattimo.png" loading="lazy" decoding="async" width="260" height="340" />
        <p>Gianni Vattimo</p>
      </div>
      <div class="slide-vertical">
        <img alt="Testa di..." src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/krk.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Testa di ...</p>
      </div>
      <div class="slide-vertical">
        <img alt="Democrito" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Democritus.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Democrito</p>
      </div>
      <div class="slide-vertical">
        <img alt="Talete" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Talete.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Talete</p>
      </div>
      <div class="slide-vertical">
        <img alt="Aristippo" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/aristippo.webp" loading="lazy" decoding="async" width="260" height="340" />
        <p>Aristippo</p>
      </div>
      <div class="slide-vertical">
        <img alt="Massimo Cacciari" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/cacciari.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Massimo Cacciari</p>
      </div>
      <div class="slide-vertical">
        <img alt="Cicerone" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/cicerone.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Cicerone</p>
      </div>
      <div class="slide-vertical">
        <img alt="Dante Alighieri" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/dante.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Dante Alighieri - la iena che fa poesia nelle tombe</p>
      </div>
      <div class="slide-vertical">
        <img alt="Gilles Deleuze" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/deleuze.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Gilles Deleuze</p>
      </div>
      <div class="slide-vertical">
        <img alt="Jacques Derrida" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/derrida.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Jacques Derrida</p>
      </div>
      <div class="slide-vertical">
        <img alt="John Dewey" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/dewey.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>John Dewey</p>
      </div>
      <div class="slide-vertical">
        <img alt="Michel Foucault" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/foucault.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Michel Foucault</p>
      </div>
      <div class="slide-vertical">
        <img alt="G.W.F. Hegel" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/hegel.avif" loading="lazy" decoding="async" width="260" height="340" />
        <p>G.W.F. Hegel</p>
      </div>
      <div class="slide-vertical">
        <img alt="Martin Heidegger" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/heidegger.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Martin Heidegger</p>
      </div>
      <div class="slide-vertical">
        <img alt="Max Horkheimer" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/horkheimer.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Max Horkheimer</p>
      </div>
      <div class="slide-vertical">
        <img alt="Edmund Husserl" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/husserl.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Edmund Husserl</p>
      </div>
      <div class="slide-vertical">
        <img alt="Maurice Merleau-Ponty" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/merleau-ponty.avif" loading="lazy" decoding="async" width="260" height="340" />
        <p>Maurice Merleau-Ponty</p>
      </div>
      <div class="slide-vertical">
        <img alt="Charles Sanders Peirce" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/peirce.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Charles S. Peirce</p>
      </div>
      <div class="slide-vertical">
        <img alt="Pirrone" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/pirrone.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Pirrone</p>
      </div>
      <div class="slide-vertical">
        <img alt="Pitagora" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/pitagora.avif" loading="lazy" decoding="async" width="260" height="340" />
        <p>Pitagora</p>
      </div>
      <div class="slide-vertical">
        <img alt="Richard Rorty" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/richard_rorty.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Richard Rorty</p>
      </div>
      <div class="slide-vertical">
        <img alt="Bertrand Russell" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/russell.jpeg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Bertrand Russell</p>
      </div>
      <div class="slide-vertical">
        <img alt="Emanuele Severino" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Severino.png" loading="lazy" decoding="async" width="260" height="340" />
        <p>Emanuele Severino</p>
      </div>
      <div class="slide-vertical">
        <img alt="Michail Bulgakov" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/bulgakov.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Michail Bulgakov</p>
      </div>
      <div class="slide-vertical">
        <img alt="Fëdor Dostoevskij" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/dostoevskij.gif" loading="lazy" decoding="async" width="260" height="340" />
        <p>Fëdor Dostoevskij</p>
      </div>
      <div class="slide-vertical">
        <img alt="Umberto Galimberti" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/galimberti.png" loading="lazy" decoding="async" width="260" height="340" />
        <p>Umberto Galimberti</p>
      </div>
      <div class="slide-vertical">
        <img alt="Max Weber" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/max%20weber.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Max Weber</p>
      </div>
      <div class="slide-vertical">
        <img alt="Lev Šestov" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/sestov.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Lev Šestov</p>
      </div>
      <div class="slide-vertical">
        <img alt="F.W.J. Schelling" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/schelling.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>F.W.J. Schelling</p>
      </div>
      <div class="slide-vertical">
        <img alt="Ludwig Wittgenstein" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/wittgenstein.jpg" loading="lazy" decoding="async" width="260" height="340" />
        <p>Ludwig Wittgenstein</p>
      </div>
    </div>
  </div>
  <span aria-hidden="true" class="const-symbol" data-repel-item=""></span>
  <canvas id="shooting-stars"></canvas>

  <body>
    <!-- GALASSIA dietro -->
    <canvas id="nebula"></canvas>
    <!-- Stelle + Comete sopra la galassia -->
    <canvas id="star-canvas"></canvas>
    <!-- Lightning overlay -->
    <div id="lightning"></div>
    <div aria-hidden="true" class="bolt" id="bolt"></div>
    <!-- Top bar -->
    <div class="top-bar">
      <a aria-label="Home" class="brand" href="#">
        <svg aria-hidden="true" role="img" viewbox="0 0 64 64">
          <circle cx="32" cy="32" fill="none" r="30" stroke="#ffd700" stroke-width="2"></circle>
          <path d="M18 40 Q32 12 46 40" fill="none" stroke="#ffd700" stroke-width="2"></path>
          <circle cx="32" cy="28" fill="#ffd700" r="3"></circle>
        </svg>
        <span>Echi di Sofia</span>
      </a>
      <!-- ⬇️ BARRA DESTRA (traduttore + cerca + pulsanti) -->
      <div class="bar-right">
        <div class="translate-box">
          <span>🌐</span>
          <select aria-label="Traduci pagina" class="translate-select" id="customTranslate">
            <option value="it">Italiano</option>
            <option value="en">English</option>
            <option value="fr">Français</option>
            <option value="de">Deutsch</option>
            <option value="es">Español</option>
            <option value="pl">Polski</option>
            <option value="pt">Português</option>
            <option value="ru">Русский</option>
            <option value="ja">日本語</option>
            <option value="zh-CN">中文 (简体)</option>
            <option value="ar">العربية</option>
          </select>
          <div aria-hidden="true" id="google_translate_element" style="position:absolute;left:-9999px;top:-9999px;height:0;width:0;overflow:hidden"></div>
        </div>
        <!-- BOX CERCA (UI tua, non Google) -->
        <div class="search-container" role="search">
          <input aria-label="Cerca" id="site-search" placeholder="Cerca nel sito..." type="search" />
          <i aria-hidden="true" class="fa-solid fa-magnifying-glass search-icon"></i>
        </div>
        <!-- Pulsanti -->
        <button class="ctrl-btn" id="btn-thunder" title="Riproduci tuono">⚡ Tuono</button>
        <button class="ctrl-btn" id="btn-explode" title="Esplodi testo">💥 Esplodi</button>
      </div>
    </div>
    <!-- CONTENITORE RISULTATI CSE (comparirà dopo la ricerca) -->
    <!-- Loader Google CSE (inserisci UNA SOLA volta per pagina) -->
    <!-- Script integrazione CSE con il tuo input -->
    <!-- Stile scuro per i risultati CSE -->
    <style>
      .gsc-control-cse,
      .gsc-control-cse .gsc-table-result {
        background: transparent !important;
      }

      input.gsc-input {
        background: #0b0c10 !important;
        color: #f0f0f0 !important;
      }

      .gsc-search-button-v2 {
        background: #1f2937 !important;
        border: 1px solid #334155 !important;
        border-radius: 8px !important;
      }

      .gsc-webResult.gsc-result {
        background: rgba(255, 255, 255, 0.03) !important;
        border: 1px solid rgba(255, 255, 255, 0.08) !important;
        border-radius: 10px !important;
        padding: 8px !important;
        margin-bottom: 8px !important;
      }

      .gs-title,
      .gs-snippet {
        color: #eaeaea !important;
      }

      .cookie-modal.force-open {
        display: flex !important;
      }
    </style>
    <!-- 
      <div class="bar-right">
        <div id="google_translate_element" title="Traduci pagina"></div>
        <div class="search-container" role="search">
          <input type="search" id="site-search" placeholder="Cerca nel sito..." aria-label="Cerca" />
          <i class="fa-solid fa-magnifying-glass search-icon" aria-hidden="true"></i>
        </div>
        <button id="btn-thunder" class="ctrl-btn" title="Riproduci tuono">⚡ Tuono</button>
        <button id="btn-explode" class="ctrl-btn" title="Esplodi testo">💥 Esplodi</button>
      </div>
      </div>
      -->
    <!-- Header & Mega Menu -->
    <header>
      <!-- ===== ANIMAZIONI/COSMO ===== -->
<!-- RIMOSSO: cosmo dinamico (galaxy, stars, meteors, stardust, planets) -->
      <div class="menu-container">
        <nav class="menu-desktop" aria-label="Menu principale">
          <ul role="menu">
            <li class="dropdown">
              <a class="menu-btn underline-effect" href="https://casi0048.github.io/pagine/benvenuti.html" role="menuitem"> 🗝️ INCIPIT</a>
            </li>
            <li class="dropdown">
              <button aria-expanded="false" aria-haspopup="true" class="menu-btn underline-effect" role="menuitem">
                🏛️Filosofia antica <span class="arrow">▼</span>
              </button>
              <div aria-label="Sottomenu Filosofia antica" class="mega-menu columns-4" role="menu">
                <div>
                  <h4>Presocratici</h4>
                  <a href="Presocratici/talete.html" role="menuitem">Talete</a>
                  <a href="Presocratici/anassimandro.html" role="menuitem">Anassimandro</a>
                  <a href="Presocratici/anassimene.html" role="menuitem">Anassimene</a>
                  <a href="articoli/eraclito.html" role="menuitem">Eraclito</a>
                </div>
                <div>
                  <h4>Eleatismo</h4>
                  <a href="Presocratici/senofane.html" role="menuitem">Senofane</a>
                  <a href="Presocratici/parmenide.html" role="menuitem">Parmenide</a>
                  <a href="articoli/zenone.html" role="menuitem">Zenone</a>
                  <a href="articoli/melisso.html" role="menuitem">Melisso</a>
                </div>
                <div>
                  <h4>Sofisti</h4>
                  <a href="articoli/gorgia.html" role="menuitem">Gorgia</a>
                  <a href="articoli/ippia.html" role="menuitem">Ippia</a>
                  <a href="articoli/prodico.html" role="menuitem">Prodico</a>
                </div>
                <div>
                  <h4>Pitagorici</h4>
                  <a href="articoli/pitagora.html" role="menuitem">Pitagora</a>
                  <a href="articoli/filolao.html" role="menuitem">Filolao</a>
                  <a href="articoli/alcmeone.html" role="menuitem">Alcmeone</a>
                  <a href="articoli/archita.html" role="menuitem">Archita</a>
                  <a href="articoli/ippaso.html" role="menuitem">Ippaso</a>
                </div>
                <div>
                  <h4>Scuola cinica</h4>
                  <a href="articoli/antistene.html" role="menuitem">Antistene</a>
                  <a href="articoli/diogene.html" role="menuitem">Diogene di Sinope</a>
                  <a href="articoli/cratete.html" role="menuitem">Cratete di Tebe</a>
                  <a href="articoli/iparchia.html" role="menuitem">Ipparchia</a>
                  <a href="articoli/metrocle.html" role="menuitem">Metrocle di Maronea</a>
                </div>
                <div>
                  <h4>Scuola atomistica</h4>
                  <a href="articoli/leucippo.html" role="menuitem">Leucippo di Mileto</a>
                  <a href="articoli/democrito.html" role="menuitem">Democrito di Abdera</a>
                  <a href="articoli/scuola-vai%C5%9Be%E1%B9%A3ika.html" role="menuitem">Scuola Vaiśeṣika</a>
                </div>
                <div>
                  <h4>Storiografia greca antica</h4>
                  <a href="articoli/erodoto.html" role="menuitem">Erodoto</a>
                  <a href="articoli/tucidide.html" role="menuitem">Tucidide </a>
                  <a href="articoli/senofonte.html" role="menuitem">Senofonte</a>
                  <a href="articoli/polibio.html" role="menuitem">Polibio</a>
                </div>
                <div>
                  <h4>🚀Approfondimenti</h4>
                  <a href="https://www.worldhistory.org/trans/it/1-13310/democrazia-ateniese/" role="menuitem">Democrazia Ateniese</a>
                  <a href="https://www.worldhistory.org/trans/it/2-927/donne-nellantica-grecia/" role="menuitem">Donne nell'Antica Grecia</a>
                  <a href="https://www.worldhistory.org/trans/it/1-11373/magna-grecia/" role="menuitem">Magna Grecia</a>
                  <a href="https://www.worldhistory.org/trans/it/1-14956/il-teatro-dellantica-grecia/" role="menuitem">Il teatro dell'antica Grecia</a>
                  <a href="https://www.worldhistory.org/trans/it/1-10553/la-religione-nellantica-grecia/" role="menuitem">La religione nell'antica Grecia</a>
                  <a href="https://www.worldhistory.org/trans/it/1-19269/la-danza-nellantica-grecia/" role="menuitem">La danza nell'Antica Grecia</a>
                </div>
              </div>
            </li>
            <li class="dropdown">
              <button aria-expanded="false" aria-haspopup="true" class="menu-btn underline-effect" role="menuitem">
                📜Filosofia classica <span class="arrow">▼</span>
              </button>
              <div aria-label="Sottomenu Filosofia classica" class="mega-menu columns-4" role="menu">
                <div>
                  <h4>Socrate e Scuola</h4>
                  <a href="articoli/socrate.html" role="menuitem">Socrate</a>
                  <a href="articoli/senofonte.html" role="menuitem">Senofonte</a>
                  <a href="articoli/antistene.html" role="menuitem">Antistene</a>
                </div>
                <div>
                  <h4>Platone e Accademia</h4>
                  <a href="articoli/platone.html" role="menuitem">Platone</a>
                  <a href="articoli/aristippo.html" role="menuitem">Aristippo</a>
                  <a href="articoli/diotima.html" role="menuitem">Diotima</a>
                </div>
                <div>
                  <h4>Aristotele e Peripatetici</h4>
                  <a href="articoli/aristotele.html" role="menuitem">Aristotele</a>
                  <a href="articoli/teofrasto.html" role="menuitem">Teofrasto</a>
                  <a href="articoli/eudemo.html" role="menuitem">Eudemo di Rodi </a>
                  <a href="articoli/stratone.html" role="menuitem">Stratone di Lampsaco</a>
                  <a href="articoli/demetrio.html" role="menuitem">Demetrio Falereo</a>
                  <a href="articoli/andronico.html" role="menuitem">Andronico di Rodi</a>
                  <a href="articoli/alessandro-afrodisia.html" role="menuitem">Alessandro di Afrodisia </a>
                </div>
                <div>
                  <h4>Stoicismo</h4>
                  <a href="articoli/zenone.html" role="menuitem">Zenone di Cizio</a>
                  <a href="articoli/epitteto.html" role="menuitem">Epitteto</a>
                  <a href="articoli/seneca.html" role="menuitem">Seneca</a>
                  <a href="articoli/cleante.html" role="menuitem">Cleante di Asso </a>
                  <a href="articoli/crisippo.html" role="menuitem">Crisippo di Soli </a>
                  <a href="articoli/panezio.html" role="menuitem">Panezio di Rodi</a>
                  <a href="articoli/posidonio.html" role="menuitem">Posidonio di Apamea </a>
                </div>
                <div>
                  <h4>Epicureismo</h4>
                  <a href="articoli/epicuro.html" role="menuitem">Epicuro</a>
                  <a href="articoli/lucrezio.html" role="menuitem">Lucrezio</a>
                  <a href="articoli/cicerone.html" role="menuitem">Cicerone</a>
                  <a href="articoli/ermarco.html" role="menuitem">Ermarco di Mitilene</a>
                  <a href="articoli/colote.html" role="menuitem">Colote di Lampsaco</a>
                  <a href="articoli/zenone_di_sidone.html " role="menuitem">Zenone di Sidone </a>
                </div>
                <div>
                  <h4>Neoplatonismo</h4>
                  <a href="articoli/plotino.html" role="menuitem">Plotino</a>
                  <a href="articoli/giamblico.html" role="menuitem">Giamblico di Calcide </a>
                  <a href="articoli/proclo.html" role="menuitem">Proclo</a>
                  <a href="articoli/ipazia.html" role="menuitem">Ipatia di Alessandria</a>
                  <a href="articoli/simplicio.html" role="menuitem">Simplicio di Cilicia </a>
                  <a href="articoli/orfismo.html" role="menuitem">Orfismo</a>
                  <a href="articoli/eleusi.html" role="menuitem">Misteri Eleusini</a>
                </div>
                <div>
                  <h4>Drammaturgia greca antica</h4>
                  <a href="articoli/eschilo.html" role="menuitem">Eschilo</a>
                  <a href="articoli/sofocle.html" role="menuitem">Sofocle</a>
                  <a href="articoli/euripide.html" role="menuitem">Euripide</a>
                </div>
                <div>
                  <h4>Commedia greca antica</h4>
                  <a href="articoli/aristofane.html" role="menuitem">Aristofane</a>
                  <a href="articoli/menandro.html" role="menuitem">Menandro</a>
                </div>
              </div>
            </li>
            <li class="dropdown">
              <button aria-expanded="false" aria-haspopup="true" class="menu-btn underline-effect" role="menuitem">
                ⛪Filosofia medievale<span class="arrow">▼</span>
              </button>
              <div aria-label="Sottomenu Filosofia medievale" class="mega-menu columns-4" role="menu">
                <div>
                  <h4>Filosofia Medievale</h4>
                  <a href="articoli/eriugena.html" role="menuitem">Giovanni Scoto Eriugena</a>
                  <a href="articoli/anselmo.html" role="menuitem">Sant'Anselmo d'Aosta</a>
                  <a href="articoli/abelardo.html" role="menuitem">Pietro Abelardo</a>
                  <a href="articoli/alberto-m.html" role="menuitem">Alberto Magno</a>
                  <a href="articoli/tommaso%20d'aquino.html" role="menuitem">Tommaso d'Aquino</a>
                  <a href="articoli/bonaventura.html" role="menuitem">Bonaventura da Bagnoregio</a>
                  <a href="articoli/duns%20scoto.html" role="menuitem">Duns Scoto</a>
                  <a href="articoli/guglielmo-di-ockham.html" role="menuitem">Guglielmo di Ockham</a>
                  <a href="articoli/buridano.html" role="menuitem">Giovanni Buridano</a>
                  <a href="articoli/oresome.html" role="menuitem">Nicola d'Oresme</a>
                </div>
                <div>
                  <h4>Patristica</h4>
                  <a href="articoli/clemente.html" role="menuitem">Clemente Alessandrino</a>
                  <a href="articoli/tertulliano.html" role="menuitem">Tertulliano</a>
                  <a href="articoli/origene.html" role="menuitem">Origene</a>
                  <a href="articoli/cipriano.html" role="menuitem">Cipriano di Cartagine</a>
                  <a href="articoli/atanasio.html" role="menuitem">Atanasio di Alessandria</a>
                  <a href="articoli/basilio.html" role="menuitem">Basilio di Cesarea</a>
                  <a href="articoli/gregorio-di-nazianzo.html" role="menuitem">Gregorio di Nazianzo</a>
                  <a href="articoli/gregorio-di-nizza.html" role="menuitem">Gregorio di Nissa</a>
                  <a href="articoli/ambrogio.html" role="menuitem">Ambrogio di Milano</a>
                  <a href="articoli/girolamo.html" role="menuitem">Girolamo</a>
                  <a href="articoli/agostino.html" role="menuitem">Agostino</a>
                  <a href="articoli/pseudo-dionigi.html" role="menuitem">Pseudo-Dionigi Areopagita</a>
                  <a href="articoli/boezio.html" role="menuitem">Boezio</a>
                  <a href="articoli/alberto-m.html" role="menuitem">Gregorio Magno</a>
                </div>
                <div>
                  <h4>Filosofia Islamica</h4>
                  <a href="articoli/avicenna.html" role="menuitem">Avicenna</a>
                  <a href="articoli/averroe.html" role="menuitem">Averroè</a>
                  <a href="articoli/al-farabi.html" role="menuitem">Al-Farabi</a>
                  <a href="articoli/al-ghazali.html" role="menuitem">Al-Ghazali</a>
                </div>
                <div>
                  <h4>Filosofia Ebraica</h4>
                  <a href="articoli/maimonide.html" role="menuitem">Maimonide</a>
                  <a href="articoli/saadia%20goan.html" role="menuitem">Saadia Gaon</a>
                  <a href="articoli/gersonide.html" role="menuitem">Gersonide</a>
                  <a href="articoli/hasdai%20crescas.html" role="menuitem">Hasdai Crescas</a>
                </div>
              </div>
            </li>
            <li class="dropdown">
              <button aria-expanded="false" aria-haspopup="true" class="menu-btn underline-effect" role="menuitem">
                💡Filosofia moderna <span class="arrow">▼</span>
              </button>
              <div aria-label="Sottomenu Filosofia moderna" class="mega-menu columns-4" role="menu">
                <div>
                  <h4>Razionalismo</h4>
                  <a href="articoli/cartesio.html" role="menuitem">Cartesio</a>
                  <a href="articoli/spinoza.html" role="menuitem">Spinoza</a>
                  <a href="articoli/leibniz.html" role="menuitem">Leibniz</a>
                </div>
                <div>
                  <h4>Empirismo</h4>
                  <a href="articoli/locke.html" role="menuitem">Locke</a>
                  <a href="articoli/hume.html" role="menuitem">Hume</a>
                  <a href="articoli/berkeley.html" role="menuitem">Berkeley</a>
                </div>
                <div>
                  <h4>Illuminismo</h4>
                  <a href="articoli/rousseau.html" role="menuitem">Rousseau</a>
                  <a href="articoli/montesquieu.html" role="menuitem">Montesquieu</a>
                  <a href="articoli/voltaire.html" role="menuitem">Voltaire</a>
                </div>
                <div>
                  <h4>Idealismo</h4>
                  <a href="articoli/hegel.html" role="menuitem">Hegel</a>
                  <a href="articoli/kant.html" role="menuitem">Kant</a>
                  <a href="articoli/fichte.html" role="menuitem">Fichte</a>
                  <a href="articoli/schelling.html" role="menuitem">Schelling</a>
                </div>
                <div>
                  <h4>Positivismo</h4>
                  <a href="articoli/comte.html" role="menuitem">Auguste Comte </a>
                  <a href="articoli/mill.html" role="menuitem">John Stuart Mill </a>
                  <a href="articoli/spencer.html" role="menuitem">Herbert Spencer</a>
                  <a href="articoli/mach.html" role="menuitem">Ernst Mach</a>
                  <a href="articoli/adrig%C3%B2.html" role="menuitem">Roberto Ardigò</a>
                </div>
                <div>
                  <h4>Gnoseologia</h4>
                  <a href="articoli/bacon.html" role="menuitem">Francis Bacon</a>
                  <a href="articoli/mill.html" role="menuitem">John Stuart Mill </a>
                  <a href="articoli/spencer.html" role="menuitem">Herbert Spencer</a>
                </div>
                <div>
                  <h4>Metafisica/Ontologia</h4>
                  <a href="articoli/spinoza.html" role="menuitem">Spinoza</a>
                  <a href="articoli/heidegger.html" role="menuitem">Heidegger</a>
                  <a href="articoli/severino.html" role="menuitem">Emmanuele Severino</a>
                  <a href="articoli/quine.html" role="menuitem">Willard Van Orme Quine</a>
                  <a href="articoli/lewis.html" role="menuitem">David Lewis</a>
                </div>
                <div>
                  <h4>Filosofia russa</h4>
                  <a href="articoli/dostoevskij.html" role="menuitem">Fëdor Dostoevskij</a>
                  <a href="articoli/solov'%C3%ABv.html" role="menuitem">Vladimir Solov'ëv </a>
                  <a href="articoli/rozanov.html" role="menuitem">Vasilij Rozanov </a>
                  <a href="articoli/sestov.html" role="menuitem">Lev Šestov</a>
                  <a href="articoli/bulgakov.html" role="menuitem">Sergej Bulgakov</a>
                </div>
              </div>
            </li>
            <li class="dropdown">
              <button aria-expanded="false" aria-haspopup="true" class="menu-btn underline-effect" role="menuitem">
                🌀Filosofia contemporanea <span class="arrow">▼</span>
              </button>
              <div aria-label="Sottomenu Filosofia contemporanea" class="mega-menu columns-4" role="menu">
                <div>
                  <h4>Filosofia analitica</h4>
                  <a href="articoli/frege.html" role="menuitem">Frege</a>
                  <a href="articoli/russell.html" role="menuitem">Russell</a>
                  <a href="articoli/wittgenstein.html" role="menuitem">Wittgenstein</a>
                  <a href="articoli/moore.html" role="menuitem">G.E. Moore</a>
                </div>
                <div>
                  <h4>Filosofia Continentale</h4>
                  <a href="articoli/husserl.html" role="menuitem">Husserl</a>
                  <a href="articoli/merleau-ponty.html" role="menuitem">Merleau-Ponty</a>
                  <a href="articoli/l%C3%A9vi-strauss.html" role="menuitem">Claude Lévi-Strauss</a>
                  <a href="articoli/bergson1.html" role="menuitem">Henri-Louis Bergson</a>
                  <a href="articoli/althusser.html" role="menuitem">Louis Althusser</a>
                  <a href="articoli/dreyfus.html" role="menuitem">Dina Dreyfus</a>
                  <a href="articoli/sartre.html" role="menuitem">Sartre</a>
                  <a href="articoli/adorno.html" role="menuitem">Adorno</a>
                </div>
                <div>
                  <h4>Ermeneutica</h4>
                  <a href="articoli/schleiermacher.html" role="menuitem">Friedrich Schleiermacher</a>
                  <a href="articoli/dilthey.html" role="menuitem">Wilhelm Dilthey</a>
                  <a href="articoli/heidegger.html" role="menuitem">Heidegger</a>
                  <a href="articoli/gadamer.html" role="menuitem">Hans-Georg Gadamer</a>
                  <a href="/articoli/ricoeur.html" role="menuitem">Paul Ricoeur</a>
                  <a href="articoli/habermas.html" role="menuitem">Jürgen Habermas</a>
                  <a href="articoli/horkheimer.html" role="menuitem">Horkheimer</a>
                </div>
                <div>
                  <h4>Filosofia del linguaggio</h4>
                  <a href="articoli/wittgenstein.html" role="menuitem">Ludwig Wittgenstein</a>
                  <a href="articoli/austin.html" role="menuitem">J.L. Austin</a>
                  <a href="articoli/searle.html" role="menuitem">John Searle</a>
                  <a href="articoli/quine.html" role="menuitem">Willard Van Orme Quine</a>
                </div>
                <div>
                  <h4>Pragmatismo Americano</h4>
                  <a href="articoli/peirce.html" role="menuitem">Peirce</a>
                  <a href="articoli/james.html" role="menuitem">W. James</a>
                  <a href="articoli/dewey.html" role="menuitem">Dewey</a>
                  <a href="articoli/rorty.html" role="menuitem">R. Rorty</a>
                </div>
                <div>
                  <h4>Filosofia postmoderna</h4>
                  <a href="articoli/derrida.html" role="menuitem">Derrida</a>
                  <a href="articoli/foucault.html" role="menuitem">Foucault</a>
                  <a href="articoli/lyotard.html" role="menuitem">Lyotard</a>
                  <a href="articoli/deleuze.html" role="menuitem">Deleuze</a>
                  <a href="articoli/butler.html" role="menuitem">Butler</a>
                </div>
                <div>
                  <h4>Filosofia italiana</h4>
                  <a href="articoli/severino.html" role="menuitem">Emmanuele Severino</a>
                  <a href="articoli/eco.html" role="menuitem">Umberto Eco</a>
                  <a href="articoli/vattimo.html" role="menuitem">Gianni Vattimo</a>
                  <a href="articoli/bodei.html" role="menuitem">Remo Bodei</a>
                  <a href="articoli/cacciari.html" role="menuitem">Massimo Cacciari</a>
                  <a href="articoli/galimberti.html" role="menuitem">Umberto Galimberti</a>
                </div>
                <div>
                  <h4>Socioetica</h4>
                  <a href="articoli/rawls.html" role="menuitem">John Rawls:</a>
                  <a href="articoli/nozick.html" role="menuitem">Robert Nozick</a>
                  <a href="articoli/singer.html" role="menuitem">Peter Singer</a>
                  <a href="articoli/jonas.html" role="menuitem">Hans Jonas</a>
                  <a href="articoli/beauvoir.html" role="menuitem">Simone de Beauvoir</a>
                  <a href="articoli/fraser.html" role="menuitem">Nancy Fraser</a>
                  <a href="articoli/said.html" role="menuitem">Edward Said</a>
                </div>
              </div>
            </li>
            <li class="dropdown">
              <button aria-expanded="false" aria-haspopup="true" class="menu-btn underline-effect" role="menuitem">
                🇵🇱 Filosofia polacca <span class="arrow">▼</span>
              </button>
              <div aria-label="Sottomenu Filosofia polacca" class="mega-menu columns-4" role="menu">
                <div>
                  <h4>Romanticismo</h4>
                  <a href="articoli/wronski.html" role="menuitem">Józef Hoene-Wroński</a>
                  <a href="articoli/cieszkowski.html" role="menuitem">August Cieszkowski</a>
                  <a href="articoli/mickiewicz.html" role="menuitem">Adam Mickiewicz</a>
                  <a href="articoli/rzewuski.html" role="menuitem">Henryk Rzewuski</a>
                  <a href="articoli/potocki.html" role="menuitem">Stanisław Kostka Potocki</a>
                </div>
                <div>
                  <h4>Logica e Analitica</h4>
                  <a href="articoli/twardowski.html" role="menuitem">Kazimierz Twardowski</a>
                  <a href="articoli/lukasiewicz.html" role="menuitem">Jan Łukasiewicz</a>
                  <a href="articoli/tarski.html" role="menuitem">Alfred Tarski</a>
                  <a href="articoli/kotarbinski.html" role="menuitem">Tadeusz Kotarbiński</a>
                  <a href="articoli/ingarden.html" role="menuitem">Roman Ingarden</a>
                </div>
                <div>
                  <h4>Periodo comunista</h4>
                  <a href="articoli/malinowski.html" role="menuitem">Bronisław Malinowski</a>
                  <a href="articoli/kolakowski.html" role="menuitem">Leszek Kołakowski</a>
                  <a href="articoli/wojtyla.html" role="menuitem">Karol Wojtyła<br />(Papa Giovanni Paolo II)</a>
                </div>
                <div>
                  <h4>Post-Comunista</h4>
                  <a href="articoli/tischner.html" role="menuitem">Józef Tischner</a>
                  <a href="articoli/bauman.html" role="menuitem">Zygmunt Bauman</a>
                </div>
              </div>
            </li>
            <li class="dropdown">
              <a class="menu-btn underline-effect" href="https://casi0048.github.io/pagine/pagina-contatti.html" role="menuitem">📧Contatti</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <main aria-label="Contenuto principale" role="main" id="main-content" tabindex="-1">
      <!-- QUOTES BAR sotto la barra del menu -->
      <div aria-live="polite" class="quotes-bar" id="quotesBar">
        <span class="quote-text" id="quotesText"></span>
        <span class="author" id="quotesAuthor"></span>
      </div>
      <!-- ===== SLIDER VERTICALE SINISTRA ===== -->
      <!-- ===== CONTROLLI SLIDER VERTICALE ===== -->
      <div class="slider-controls" id="slider-controls">
        <button class="ctrl-btn" id="slider-toggle" title="Avvia/Ferma scorrimento">⏯️ Avvia / Ferma</button>
        <button class="ctrl-btn" id="slider-invert" title="Inverti direzione">🔄 Inverti</button>
        <label class="speed-label" for="slider-speed">
          <span class="speed-label-text">Regola velocità</span>
          <input id="slider-speed" max="12" min="1" type="range" value="8" />
        </label>
      </div>
      <!-- ===== BLOB ANIMATO DESTRA (Ultimi articoli) ===== -->
      <aside aria-label="Ultimi articoli" class="articles-blob">
        <h3>📰 Ultimi articoli</h3>
        <ul>
          <li><a href="articoli/circolo_di_vienna.html">Circolo di Vienna</a></li>
          <li><a href="articoli/ipazia.html">Ipazia di Alessandria</a></li>
          <li><a href="articoli/platone_mito_caverna.html">Il Mito della Caverna di Platone</a></li>
          <li><a href="articoli/parmenide1.html">Parmenide di Elea: L'Enigma dell'Essere</a></li>
          <li><a href="articoli/2nietzsche.html">Nietzsche filosofo folgorante</a></li>
          <li><a href="articoli/marco%20aurelio.html">Marco Aurelio</a></li>
          <li><a href="articoli/heidegger.html">Martin Heidegger</a></li>
          <li><a href="articoli/battaglio_maratona.html">Battaglia di Maratona (490 a.C.)</a></li>
          <li><a href="articoli/schelling.html">Friedrich Schelling</a></li>
        </ul>
      </aside>
      <!-- Main -->
      <main>
        <!-- ===Inizio Exploding text (HTML) === -->
        <section class="welcome-section">
          <h1 class="welcome-title" id="title">Benvenuto<br />in Echi di Sofia</h1>
          <p class="welcome-subtitle" id="subtitle">Un viaggio tra storia e pensiero</p>
          <div class="typing-wrap">
            <div class="typing-effect"></div>
            <span aria-hidden="true" class="caret"></span>
          </div>
          <!-- Testo esplosivo con ritorno -->
          <div class="exploding-text" id="exploding" title="Clicca per esplodere">
            ⏳ Pensare, dunque è ancora possibile 🧘
          </div>
        </section>
        <!-- === Exploding text (CSS) === -->
        <style>
          .exploding-text {
            display: inline-block;
            cursor: pointer;
            user-select: none;
            will-change: transform, opacity;
          }

          .exploding-text span {
            display: inline-block;
            will-change: transform, opacity;
          }

          .exploding-text {
            font-family: 'Cinzel', serif;
            /* o altro font coerente col sito */
            font-size: 1.1rem;
            /* grandezza regolabile */
            font-weight: 700;
            /* valori comuni: 300, 400, 500, 600, 700, 900 */
            letter-spacing: 0.5px;
            /* spaziatura tra lettere */
            color: #ffd86a;
            /* colore dorato, a tema */
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
          }
        </style>
        <!-- === Exploding text (JS) === -->
        <script>
          (function(){
              // Carica GSAP solo se manca
              function ensureGSAP(cb){
                if (window.gsap) return cb();
                var s = document.createElement('script');
                s.src = "https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js";
                s.onload = cb;
                document.head.appendChild(s);
              }
            
              function setupExploding(){
                const exploding = document.getElementById("exploding");
                if (!exploding) return;
            
                // prepara lo split in span una sola volta
                if (!exploding.__prepared){
                  const text = exploding.textContent;
                  exploding.textContent = "";
                  const frag = document.createDocumentFragment();
                  for (const ch of text){
                    const span = document.createElement("span");
                    span.textContent = ch;
                    frag.appendChild(span);
                  }
                  exploding.appendChild(frag);
                  exploding.__prepared = true;
                }
            
                const letters = Array.from(exploding.querySelectorAll("span"));
            
                function explodeAndReturn(){
                  // evita re-entrance mentre l'animazione è in corso
                  if (explodeAndReturn.__busy) return;
                  explodeAndReturn.__busy = true;
            
                  gsap.to(letters, {
                    duration: 0.8,
                    x: () => (Math.random() - 0.5) * 400,
                    y: () => (Math.random() - 0.5) * 300,
                    rotation: () => (Math.random() - 0.5) * 720,
                    opacity: 0,
                    ease: "power3.out",
                    stagger: 0.02,
                    onComplete: () => {
                      gsap.to(letters, {
                        duration: 1.2,
                        x: 0,
                        y: 0,
                        rotation: 0,
                        opacity: 1,
                        ease: "elastic.out(1, 0.5)",
                        stagger: 0.02,
                        onComplete: () => { explodeAndReturn.__busy = false; }
                      });
                    }
                  });
                }
            
                exploding.addEventListener("click", explodeAndReturn);
              }
            
              // init
              if (document.readyState === "loading"){
                document.addEventListener("DOMContentLoaded", () => ensureGSAP(setupExploding));
              } else {
                ensureGSAP(setupExploding);
              }
            })();
        </script>
        <!--INIZIO AGGIUNTA JS EXPLODING TEXT-->
        <script>
          (function(){
              // Carica GSAP se manca
              function ensureGSAP(cb){
                if (window.gsap) return cb();
                var s = document.createElement('script');
                s.src = "https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js";
                s.onload = cb;
                document.head.appendChild(s);
              }
            
              function setupExploding(){
                const exploding = document.getElementById("exploding");
                if (!exploding) return;
            
                // prepara gli span una sola volta
                if (!exploding.__prepared){
                  const text = exploding.textContent;
                  exploding.textContent = "";
                  const frag = document.createDocumentFragment();
                  for (const ch of text){
                    const span = document.createElement("span");
                    span.textContent = ch;
                    span.style.display = "inline-block";
                    frag.appendChild(span);
                  }
                  exploding.appendChild(frag);
                  exploding.__prepared = true;
                }
            
                const letters = Array.from(exploding.querySelectorAll("span"));
            
                function explodeAndReturn(){
                  if (explodeAndReturn.__busy) return;
                  explodeAndReturn.__busy = true;
            
                  gsap.to(letters, {
                    duration: 0.8,
                    x: () => (Math.random() - 0.5) * 400,
                    y: () => (Math.random() - 0.5) * 300,
                    rotation: () => (Math.random() - 0.5) * 720,
                    opacity: 0,
                    ease: "power3.out",
                    stagger: 0.02,
                    onComplete: () => {
                      gsap.to(letters, {
                        duration: 1.2,
                        x: 0, y: 0, rotation: 0, opacity: 1,
                        ease: "elastic.out(1, 0.5)",
                        stagger: 0.02,
                        onComplete: () => { explodeAndReturn.__busy = false; }
                      });
                    }
                  });
                }
            
                // 1) Esplosione automatica al caricamento (una volta)
                explodeAndReturn();
            
                // 2) Esplosioni successive al click
                exploding.addEventListener("click", explodeAndReturn);
              }
            
              if (document.readyState === "loading"){
                document.addEventListener("DOMContentLoaded", () => ensureGSAP(setupExploding));
              } else {
                ensureGSAP(setupExploding);
              }
            })();
        </script>
        <!--FINE AGGIUNTA JS EXPLODING TEXT-->
        <!-- ===Fine Exploding text (HTML) === -->
      </main>
      <!-- Particelle layer -->
      <div aria-hidden="true" id="philoParticles"></div>
      <!-- Footer -->
      <footer>
        <div class="footer-wrap">
          <div class="footer-columns">
            <div class="col about">
              <h3>Echi di Sofia</h3>
              <p>Tra pensiero e stelle: un percorso tra scuole, autori e temi della filosofia, dalla classicità al contemporaneo.</p>
            </div>
            <!-- Sezioni (indicizzate per la ricerca) -->
            <div class="search-sections">
              <h4>Sezioni</h4>
              <ul>
                <li><a data-search="include" data-title="Incipit" href="pagine/benvenuti.html">Incipit</a></li>
                <li><a data-search="include" data-title="Cinismo" href="articoli/cinismo.html">Cinismo</a></li>
                <li><a data-search="include" data-title="Epicureismo" href="articoli/epicureismo.html">Epicureismo</a></li>
                <li><a data-search="include" data-title="Filosofia indiana" href="articoli/filosofia-indiana.html">Filosofia indiana</a></li>
                <li><a data-search="include" data-title="Platonismo" href="articoli/platonismo.html">Platonismo</a></li>
                <li><a data-search="include" data-title="Scetticismo" href="articoli/scetticismo.html">Scetticismo</a></li>
                <li><a data-search="include" data-title="Stoicismo" href="articoli/stoicismo.html">Stoicismo</a></li>
              </ul>
            </div>
            <div class="col contact">
              <h4>Contatti</h4>
              <ul>
                <li><a href="mailto:info@echidisofia.example">info@echidisofia.example</a></li>
                <li><a href="https://casi0048.github.io/pagine/pagina-contatti.html">Modulo contatti</a></li>
              </ul>
              <div class="social">
                <a aria-label="Instagram" href="#"><i class="fa-brands fa-instagram"></i></a>
                <a aria-label="YouTube" href="#"><i class="fa-brands fa-youtube"></i></a>
                <a aria-label="X/Twitter" href="#"><i class="fa-brands fa-x-twitter"></i></a>
              </div>
            </div>
          </div>
          <div class="footer-legal">
            <span>© <span id="year"></span> Echi di Sofia</span>
            <span class="dot">•</span>
            <a href="https://casi0048.github.io/pagine/privacy-policy.html">Privacy</a>
            <span class="dot">•</span>
            <a href="https://casi0048.github.io/pagine/credits.html">Crediti</a>
            <span class="dot">•</span>
          </div>
        </div>
      </footer>
      <!-- GALASSIA (canvas particelle colorate) -->
      <script>
        (function(){
            const canvas = document.getElementById('nebula');
            const ctx = canvas.getContext('2d');
            function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
            resize();
          
            const nebulaParticles = [];
            const colors = ['#3a0ca3', '#7209b7', '#f72585', '#4cc9f0', '#4895ef'];
          
            class Particle {
              constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 3 + 1;
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.speedX = Math.random() * 2 - 1;
                this.speedY = Math.random() * 2 - 1;
              }
              update() {
                this.x += this.speedX; this.y += this.speedY;
                if (this.size > 0.2) this.size -= 0.01;
              }
              draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
              }
            }
          
            function init() { for (let i = 0; i < 120; i++) nebulaParticles.push(new Particle()); }
            function animate() {
              ctx.fillStyle = 'rgba(10, 10, 20, 0.14)';
              ctx.fillRect(0, 0, canvas.width, canvas.height);
              for (let i = 0; i < nebulaParticles.length; i++) {
                nebulaParticles[i].update(); nebulaParticles[i].draw();
                if (nebulaParticles[i].size <= 0.2 ||
                    nebulaParticles[i].x < 0 || nebulaParticles[i].x > canvas.width ||
                    nebulaParticles[i].y < 0 || nebulaParticles[i].y > canvas.height) {
                  nebulaParticles.splice(i, 1); i--;
                }
              }
              if (nebulaParticles.length < 120 && Math.random() < 0.12) nebulaParticles.push(new Particle());
              requestAnimationFrame(animate);
            }
            init(); animate();
            addEventListener('resize', resize);
          })();
      </script>
      <!-- STELLE + COMETE -->
      <script>
        (function starComets(){
            const canvas = document.getElementById('star-canvas');
            const ctx = canvas.getContext('2d');
            let w, h, stars = [], comets = [];
            function resize(){
              w = canvas.width = innerWidth; h = canvas.height = innerHeight;
              stars = Array.from({length: Math.min(360, Math.floor(w*h/4500))}, () => ({
                x: Math.random()*w, y: Math.random()*h, r: Math.random()*1.4 + 0.2, s: Math.random()*0.6 + 0.1, a: Math.random()*Math.PI*2
              }));
            }
            function spawnComet(){
              const x = -50, y = Math.random()*h*0.8;
              const speed = 2 + Math.random()*2.2;
              const angle = (12 + Math.random()*22) * Math.PI/180;
              const vx = Math.cos(angle)*speed, vy = Math.sin(angle)*speed;
              comets.push({ x, y, vx, vy, life: 0, maxLife: 220 + Math.random()*160, trail: [] });
            }
            function draw(){
              ctx.clearRect(0,0,w,h);
              // stars
              for(const st of stars){
                st.a += 0.02;
                const op = 0.2 + Math.abs(Math.sin(st.a))*0.8;
                st.x += st.s*0.08; if(st.x > w) st.x = 0;
                ctx.globalAlpha = op;
                ctx.beginPath(); ctx.arc(st.x, st.y, st.r, 0, Math.PI*2);
                ctx.fillStyle = '#ffffff'; ctx.fill();
              }
              // comets
              for(let i=comets.length-1;i>=0;i--){
                const c = comets[i];
                c.x += c.vx; c.y += c.vy; c.life++;
                c.trail.push({x: c.x, y: c.y});
                if (c.trail.length > 24) c.trail.shift();
                for(let t=0; t<c.trail.length; t++){
                  const p = c.trail[t];
                  const alpha = t / c.trail.length;
                  ctx.globalAlpha = alpha*0.6;
                  ctx.beginPath(); ctx.arc(p.x, p.y, 1.2, 0, Math.PI*2);
                  ctx.fillStyle = '#cfe8ff'; ctx.fill();
                }
                ctx.globalAlpha = 1;
                ctx.beginPath(); ctx.arc(c.x, c.y, 1.8, 0, Math.PI*2);
                ctx.fillStyle = '#ffffff'; ctx.fill();
                if (c.x > w+60 || c.y > h+60 || c.life > c.maxLife){ comets.splice(i,1); }
              }
              if (Math.random() < 0.02 && comets.length < 3) spawnComet();
              requestAnimationFrame(draw);
            }
            addEventListener('resize', resize);
            resize(); draw();
          })();
      </script>
      <!-- SLIDER VERTICALE: autoplay continuo con pausa on-hover -->
      <script>
        (function initVerticalSlider(){
            const wrap = document.querySelector('.slider-vertical');
            if(!wrap) return;
            const inner = wrap.querySelector('.slider-inner');
            // Duplica contenuto per loop infinito
            inner.innerHTML = inner.innerHTML + inner.innerHTML;
            let y = 0, paused = false;
            const speed = 0.35; // px/frame
            wrap.addEventListener('mouseenter', ()=> paused = true);
            wrap.addEventListener('mouseleave', ()=> paused = false);
            function step(){
              if(!paused){
                y += speed;
                if(y >= inner.scrollHeight/2) y = 0;
                inner.style.transform = `translateY(-${y}px)`;
              }
              requestAnimationFrame(step);
            }
            step();
          })();
      </script>
      <!-- Lightning + Thunder -->
      <script>
        (function lightning(){
            const overlay = document.getElementById('lightning');
            const bolt    = document.getElementById('bolt');
            const audio   = document.getElementById('thunder-sound');
          
            // --- stato solo per l'AUDIO ---
            if (typeof window.__thOn === 'undefined') window.__thOn = false;
          const thunderOnRef = () => window.__thOn;
          const setThunderOn = v => (window.__thOn = !!v);
          
            function playThunder(){
              if (!thunderOn || !audio) return;
              try { audio.currentTime = 0; audio.play().catch(()=>{}); } catch(e){}
            }
          
            function stopThunderAudio(){
              if (!audio) return;
              try { audio.pause(); audio.currentTime = 0; } catch(e){}
            }
          
            function flash(){
              // posizione/parametri casuali
              const xPerc = 15 + Math.random()*70;
              const yPerc = 10 + Math.random()*65;
              const angle  = -25 + Math.random()*50;
              const scaleY = 0.8 + Math.random()*1.2;
          
              // overlay
              overlay.style.transition = 'none'; overlay.offsetHeight;
              overlay.style.background = `radial-gradient(circle at ${xPerc}% ${yPerc}%, rgba(255,255,255,.95), rgba(255,255,255,.22) 40%, transparent 65%)`;
              overlay.style.opacity = '1';
              overlay.style.transition = 'opacity 80ms ease-out';
              setTimeout(()=> overlay.style.opacity = '0', 140);
          
              // saetta
              bolt.style.left = xPerc + '%';
              bolt.style.top  = yPerc + '%';
              bolt.style.transform = `translate(-50%,-50%) rotate(${angle}deg) scaleY(${scaleY})`;
              bolt.style.transition = 'transform 90ms ease-out, opacity 280ms ease-out';
              bolt.style.opacity = '1';
              setTimeout(()=> bolt.style.opacity = '0', 180);
          
              // audio (solo se ON)
              setTimeout(playThunder, 120);
            }
          
            // --- loop VISIVO sempre attivo (cambia qui gli intervalli) ---
            const MIN = 30000, MAX = 40000; // 30–40s
            let flashTimer = null;
            (function schedule(){
              const delay = MIN + Math.random()*(MAX-MIN);
              flashTimer = setTimeout(()=>{ flash(); schedule(); }, delay);
            })();
          
            // --- API per il bottone: solo audio ---
            function updateBtn(){
              const btn = document.getElementById('btn-thunder');
              if (!btn) return;
              btn.classList.toggle('active', thunderOn);
              btn.setAttribute('aria-pressed', thunderOn ? 'true' : 'false');
            }
          
            
          
          
          // --- toggle audio tuono (ON/OFF) ---
          
          
          function updateThunderBtn(on){
            const b = document.getElementById('btn-thunder');
            if (b){
              b.textContent = on ? '⚡ Tuono: ON' : '⚡ Tuono';
              b.setAttribute('aria-pressed', on ? 'true' : 'false');
            }
          }
          
          
          
          })();
      </script>
      <!-- Buttons binding -->
      <script>
        document.getElementById('btn-thunder')
            .addEventListener('click', ()=> window.toggleThunder && window.toggleThunder());
          
          
          
              document.getElementById('btn-explode').addEventListener('click', ()=> window.triggerExplosion && window.triggerExplosion());
              document.getElementById('year').textContent = new Date().getFullYear();
      </script>
      <!-- QUOTES BAR: lista fornita -->
      <script>
        (function quotesBar(){
            const QUOTES = [
              { text: "Conosci te stesso e conoscerai l'universo e gli dei.", author: "Socrate" },
              { text: "Il sapere è l'unico bene che aumenta condividendolo.", author: "Pitagora" },
              { text: "La meraviglia è il principio di ogni conoscenza.", author: "Aristotele" },
              { text: "Non è forte colui che non cade mai, ma colui che cadendo si rialza.", author: "Confucio" },
              { text: "Penso, dunque sono.", author: "Cartesio" },
              { text: "L'uomo è condannato ad essere libero.", author: "Jean-Paul Sartre" },
              { text: "La vita senza esame non è degna di essere vissuta.", author: "Socrate" },
              { text: "Il dubbio è il principio della saggezza.", author: "René Descartes" },
              { text: "La felicità è reale solo se condivisa.", author: "Christopher McCandless" },
              { text: "L'essenza della filosofia è la ricerca incessante.", author: "Immanuel Kant" },
              { text: "Non si vede bene che col cuore.", author: "Antoine de Saint-Exupéry" },
              { text: "Il coraggio è sapere che non puoi vincere e provare lo stesso.", author: "Tom Krause" },
              { text: "L'ignoranza è la notte della mente.", author: "Immanuel Kant" },
              { text: "La libertà è la possibilità di essere ciò che siamo.", author: "Jean-Paul Sartre" },
              { text: "La verità è figlia del tempo, non dell'autorità.", author: "Galileo Galilei" },
              { text: "Il tempo è un fiume che mi porta, ma io sono il fiume.", author: "Jorge Luis Borges" },
              { text: "Chi non conosce il passato è condannato a ripeterlo.", author: "George Santayana" },
              { text: "L'uomo è misura di tutte le cose.", author: "Protagora" },
              { text: "La saggezza comincia nella meraviglia.", author: "Platone" },
              { text: "La mente è tutto. Ciò che pensi, diventi.", author: "Buddha" },
              { text: "Tutto scorre, niente permane.", author: "Eraclito" },
              { text: "L'arte di vivere è più simile a combattere che a danzare.", author: "Marco Aurelio" },
              { text: "Non è libero chi non domina se stesso.", author: "Seneca" },
              { text: "Non fare agli altri ciò che non vuoi sia fatto a te.", author: "Confucio" },
              { text: "La semplicità è la più alta sofisticazione.", author: "Leonardo da Vinci" },
              { text: "La conoscenza parla, ma la saggezza ascolta.", author: "Jimi Hendrix" },
              { text: "Il segreto della felicità è la libertà, il segreto della libertà è il coraggio.", author: "Carrie Jones" },
              { text: "Chi ha un perché per vivere può sopportare quasi ogni come.", author: "Friedrich Nietzsche" },
              { text: "L'essere umano è ciò che fa di sé.", author: "Jean-Paul Sartre" },
              { text: "L'uomo è un animale simbolico.", author: "Ernst Cassirer" },
              { text: "La filosofia è il sapere che cerca senza mai trovare.", author: "Karl Jaspers" },
              { text: "Il dubbio è il sale della conoscenza.", author: "Giovanni Papini" },
              { text: "La cultura è la chiave della libertà.", author: "Albert Camus" },
              { text: "L'immaginazione è più importante della conoscenza.", author: "Albert Einstein" },
              { text: "La pace inizia con un sorriso.", author: "Madre Teresa" },
              { text: "Il presente è il punto in cui passato e futuro si incontrano.", author: "Haruki Murakami" },
              { text: "L'uomo è l'unico animale che arrossisce.", author: "Mark Twain" },
              { text: "Vivi come se dovessi morire domani, impara come se dovessi vivere per sempre.", author: "Mahatma Gandhi" },
              { text: "La vera libertà consiste nell'essere padroni di se stessi.", author: "Epitteto" },
              { text: "Chi non ha mai commesso un errore non ha mai provato nulla di nuovo.", author: "Albert Einstein" },
              { text: "Il pensiero è l'ombra dell'essere.", author: "Georg Wilhelm Friedrich Hegel" },
              { text: "Il vero viaggio di scoperta non consiste nel cercare nuove terre, ma nell'avere nuovi occhi.", author: "Marcel Proust" }
            ];
            const tEl = document.getElementById('quotesText');
            const aEl = document.getElementById('quotesAuthor');
            let i = 0;
            function next(){
              const q = QUOTES[i]; i = (i+1) % QUOTES.length;
              tEl.style.opacity = '0'; aEl.style.opacity = '0';
              setTimeout(()=>{
                tEl.textContent = q.text; aEl.textContent = '— ' + q.author;
                tEl.style.opacity = '1'; aEl.style.opacity = '1';
              }, 200);
            }
            next(); setInterval(next, 5000);
          })();
      </script>
      <!-- Exploding text -->
      <script>
        (function explodingText(){
            const host = document.getElementById('exploding');
            const text = host.textContent.trim();
            host.textContent = '';
            const chars = [];
            for(const c of text){
              const span = document.createElement('span');
              span.className = 'ch';
              span.textContent = c === ' ' ? '\u00A0' : c;
              host.appendChild(span);
              chars.push(span);
            }
            function burst(){
              chars.forEach((el, i) => {
                const ang = Math.random()*Math.PI*2;
                const dist = 40 + Math.random()*140;
                if (window.gsap){
                  gsap.fromTo(el, {opacity:1, x:0, y:0}, {
                    duration: 0.9 + Math.random()*0.6,
                    x: Math.cos(ang)*dist,
                    y: Math.sin(ang)*dist,
                    opacity: 0,
                    ease: 'power3.out',
                    delay: i * 0.006
                  });
                } else {
                  el.style.opacity=0;
                }
              });
            }
            window.triggerExplosion = function(){
              try{
                const ex = document.getElementById('explosionSound');
                if (ex){ ex.currentTime = 0; ex.play().catch(()=>{}); }
              }catch(e){}
              burst();
            };
            addEventListener('load', burst);
            host.addEventListener('click', () => {
              try{
                const ex = document.getElementById('explosionSound');
                if (ex){ ex.currentTime = 0; ex.play().catch(()=>{}); }
              }catch(e){}
              chars.forEach(el => { el.style.opacity=1; el.style.transform='translate(0,0)'; });
              burst();
            });
          })();
      </script>
      <!-- Typing sotto titolo -->
      <script>
        document.addEventListener("DOMContentLoaded", function() {
            const el = document.querySelector(".typing-effect");
            const texts = [
              "Φιλοσοφία: l'arte di cercare appigli nel vuoto.",
              "Pensare è camminare senza mappa.",
              "La verità è un equilibrio mobile.",
              "La domanda giusta vale più di mille risposte.",
              "L’inquietudine è il motore della ricerca."
            ];
          function reserveTypingSpace(target, texts){
          try{
          if(!target || !texts || !texts.length) return;
          var wrap = target.closest('.typing-wrap') || target.parentElement || document.body;
          var ghost = document.createElement('div');
          var cs = getComputedStyle(target);
          ghost.style.position = 'absolute';
          ghost.style.visibility = 'hidden';
          ghost.style.whiteSpace = 'normal';
          ghost.style.pointerEvents = 'none';
          ghost.style.fontFamily = cs.fontFamily;
          ghost.style.fontSize   = cs.fontSize;
          ghost.style.fontWeight = cs.fontWeight;
          ghost.style.fontStyle  = cs.fontStyle;
          ghost.style.lineHeight = cs.lineHeight;
          try{
          var w = wrap.getBoundingClientRect().width;
          if(!isNaN(w) && w > 0) ghost.style.maxWidth = w + 'px';
          }catch(e){}
          document.body.appendChild(ghost);
          var maxH = 0;
          for(var i=0;i<texts.length;i++){
          ghost.textContent = texts[i];
          var r = ghost.getBoundingClientRect();
          if(r.height > maxH) maxH = r.height;
          }
          ghost.remove();
          if(maxH > 0) wrap.style.minHeight = Math.ceil(maxH) + 'px';
          }catch(e){}
          }
          reserveTypingSpace(el, texts);
          
            let textIndex = 0, index = 0, forward = true, delay = 0, stepCounter = 0;
            const writeSpeed = 3, deleteSpeed = 2;
            function animate() {
              stepCounter++;
              const speed = forward ? writeSpeed : deleteSpeed;
              if (stepCounter >= speed) {
                stepCounter = 0;
                if (delay > 0) { delay--; }
                else {
                  const currentText = texts[textIndex];
                  if (forward) {
                    index++;
                    if (index > currentText.length) { forward = false; delay = 60; }
                  } else {
                    index--;
                    if (index < 0) { forward = true; textIndex = (textIndex + 1) % texts.length; delay = 20; }
                  }
                  el.textContent = currentText.substring(0, Math.max(0,index));
                }
              }
              requestAnimationFrame(animate);
            }
            animate();
          });
      </script>
      <!-- INIZIO Box Bertrand Russell -->
      <div id="russell-box">
        <button id="russell-btn" title="Clicca per ascoltare la citazione">
          🎵 “Se un filosofo è un uomo cieco, in una stanza buia, che cerca un gatto nero che non c’è, un teologo è l’uomo che riesce a trovare quel gatto.”
          <br /><strong>– Bertrand Russell</strong>
        </button>
      </div>
      <div id="russell-hint">Clicca per ascoltare la chitarra 🎸</div>
      <audio id="russell-audio" preload="auto" src="https://casi0048.github.io/suoni/gitarra.mp3"></audio>
      <style>
        #russell-box {
          position: fixed;
          bottom: 30px;
          left: 30px;
          z-index: 9999;
          max-width: 220px;
          font-size: 1.05rem;
        }

        #russell-btn {
          background-color: #1c1c57;
          color: #ffffff;
          border: 2px solid #00d9ff;
          padding: 1rem 1.1rem;
          border-radius: 15px;
          cursor: pointer;
          text-align: left;
          line-height: 1.35;
          box-shadow: 0 0 10px rgba(0, 217, 255, 0.7);
          width: 100%;
          transition: all 0.3s ease;
          font-family: 'Georgia', serif;
        }

        #russell-btn:hover {
          background-color: #00d9ff;
          color: #0a0a3c;
          box-shadow: 0 0 25px rgba(0, 255, 255, 1);
        }

        #russell-hint {
          margin-top: 6px;
          font-size: 0.8rem;
          color: #aadfff;
          text-align: left;
          max-width: 320px;
          position: fixed;
          bottom: 180px;
          left: 50px;
          user-select: none;
          font-style: italic;
          font-family: 'Segoe UI', sans-serif;
          z-index: 9998;
        }

        @media (max-width: 980px) {

          #russell-box,
          #russell-hint {
            display: none;
          }
        }

        .cookie-modal.force-open {
          display: flex !important;
        }
      </style>
      <script>
        window.addEventListener("load", () => {
            if (window.gsap) {
              gsap.from("#russell-box", { x: -150, opacity: 0, duration: 1.2, ease: "power3.out" });
              gsap.from("#russell-hint", { x: -150, opacity: 0, duration: 1.2, delay: 0.35, ease: "power3.out" });
              gsap.to("#russell-btn", { scale: 1.05, duration: 2, repeat: -1, yoyo: true, ease: "power1.inOut" });
            }
          });
          document.addEventListener("click", function (e) {
            const btn = document.getElementById("russell-btn");
            if (!btn) return;
            if (btn.contains(e.target)) {
              const audio = document.getElementById("russell-audio");
              try {
                audio.currentTime = 0;
                audio.play();
              } catch (err) {}
            }
          });
      </script>
      <!-- FINE Box Bertrand Russell -->
      <script>
        window.addEventListener('load', () => {
            if (window.gsap) {
              try {
                gsap.from(".articles-blob li", {
                  x: -40,
                  opacity: 0,
                  duration: 0.6,
                  ease: "power2.out",
                  stagger: 0.09,
                  delay: 0.3
                });
              } catch(e){}
            }
          });
      </script>
      <style>
        footer {
          background: #06060d;
          color: #e9eef5;
          margin-top: 45px;
          /* 👈 spazio fisso sopra il footer */
          position: relative;
          z-index: 0;
        }

        footer::before {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 1px;
          background: linear-gradient(90deg,
              transparent,
              rgba(255, 215, 0, 0.4),
              transparent);
        }

        .footer-wrap {
          max-width: 1200px;
          margin: 0 auto;
          padding: 28px 16px;
        }

        .footer-columns {
          display: grid;
          grid-template-columns: 2fr 1fr 1fr;
          gap: 22px;
          align-items: start;
          text-align: left;
          /* Allineamento a sinistra */
        }

        .footer-columns h3,
        .footer-columns h4 {
          margin: 0.2rem 0 0.6rem;
          color: #ffd86a;
          font-family: 'Cinzel', serif;
          letter-spacing: 0.3px;
        }

        .footer-columns p {
          margin: 0.2rem 0;
          color: #00bb2d;
          /* e/o #cfe8ff se serve doppio colore */
          line-height: 1.6;
        }

        .footer-columns ul {
          list-style: none;
          margin: 0;
          padding: 0;
        }

        .footer-columns li {
          margin: 0.25rem 0;
        }

        .footer-columns a {
          color: #9ad0ff;
          font-weight: 700;
          text-decoration: none;
        }

        .footer-columns a:hover {
          color: #ffffff;
        }

        .social {
          margin-top: 0.6rem;
          display: flex;
          gap: 10px;
        }

        .social a {
          display: inline-flex;
          width: 36px;
          height: 36px;
          align-items: center;
          justify-content: center;
          border: 1px solid rgba(255, 215, 0, 0.25);
          border-radius: 50%;
          background: rgba(0, 0, 0, 0.25);
        }

        .social a:hover {
          box-shadow: 0 0 12px rgba(255, 215, 0, 0.25);
        }

        .footer-legal {
          margin-top: 16px;
          display: flex;
          gap: 10px;
          align-items: center;
          flex-wrap: wrap;
          opacity: 0.9;
        }

        .footer-legal .dot {
          opacity: 0.5;
        }

        @media (max-width: 980px) {
          .footer-columns {
            grid-template-columns: 1fr;
            gap: 14px;
          }
        }

        .cookie-modal.force-open {
          display: flex !important;
        }
      </style>
      <!-- 🎬 INIZIO PLAYER (destro) -->
      <div class="video-container" id="video-right">
        <!-- DIZIONARIO FILOSOFICO (MINIMAL INLINE, FIXED HEIGHT + INPUT)-->
        <style>
          .edx-dict {
            background: rgba(10, 10, 30, .9);
            border: 1px solid rgba(255, 215, 0, .35);
            border-radius: 10px;
            box-shadow: 0 6px 14px rgba(0, 0, 0, .28);
            margin: 8px 0;
          }

          .edx-dict__head {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 4px 8px;
            cursor: pointer;
            user-select: none;
            min-height: 24Px;
          }

          .edx-dict__title {
            font-family: 'Cinzel', serif;
            color: #ffd86a;
            font-weight: 700;
            font-size: 1.1rem;
            letter-spacing: .2px;
            line-height: 1;
          }

          .edx-dict__chev {
            margin-left: auto;
            transition: transform .2s ease;
            color: #e9eef5;
            font-size: .85rem;
          }

          .edx-dict.is-open .edx-dict__chev {
            transform: rotate(180deg);
          }

          .edx-dict__body {
            display: none;
            border-top: 1px solid rgba(255, 255, 255, .08);
          }

          .edx-dict.is-open .edx-dict__body {
            display: block;
            animation: edxIn .14s ease;
          }

          @keyframes edxIn {
            from {
              opacity: .95;
              transform: translateY(-2px)
            }

            to {
              opacity: 1;
              transform: none
            }
          }

          /* Controls compatti */
          .edx-dict__controls {
            display: flex;
            gap: 6px;
            padding: 6px 8px;
            align-items: center;
          }

          /* Input basso */
          .edx-dict .edx-dict__input {
            flex: 1;
            min-width: 120px;
            height: 24px !important;
            line-height: 24px !important;
            padding: 0 .55rem !important;
            background: rgba(20, 20, 40, .78);
            border: 1px solid rgba(255, 215, 0, .28);
            border-radius: 7px;
            color: #e9eef5;
            font-size: .88rem;
            box-sizing: border-box;
          }

          /* Bottone davvero basso */
          .edx-dict .edx-dict__btn {
            appearance: none;
            -webkit-appearance: none;
            box-sizing: border-box;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 24px !important;
            /* prevale su qualsiasi 26px !important precedente */
            padding: 0 .45rem;
            /* niente padding verticale */
            padding-block: 0 !important;
            /* difesa contro regole globali */
            line-height: 1 !important;
            font-size: .82rem;
            border: 1px solid rgba(255, 215, 0, .28);
            background: rgba(255, 255, 255, .06);
            color: #e9eef5;
            border-radius: 6px;
            cursor: pointer;
          }

          /* Iframe compatto */
          .edx-dict .edx-dict__frame {
            width: 100%;
            height: 220px;
            border: 0;
            background: rgba(0, 0, 0, .2);
          }

          @media (max-width:980px) {
            .edx-dict {
              display: none;
            }
          }
        </style>
        <script>
          (function(){
              const root = document.getElementById('edx-dict');
              if(!root) return;
              const toggle = root.querySelector('#edx-dict-toggle');
              const input = root.querySelector('#edx-dict-input');
              const goBtn = root.querySelector('#edx-dict-go');
              const frame = root.querySelector('#edx-dict-frame');
              const buildURL = q => `https://plato.stanford.edu/search/searcher.py?query=${encodeURIComponent(q)}`; // SEP
            
              function setOpen(open){ root.classList.toggle('is-open', open); toggle.setAttribute('aria-expanded', String(open)); }
              function submit(ev){
                if(ev){ ev.preventDefault && ev.preventDefault(); ev.stopPropagation && ev.stopPropagation(); }
                const q = input.value.trim(); if(!q) return;
                frame.src = buildURL(q);
                if(!root.classList.contains('is-open')) setOpen(true);
              }
              toggle.addEventListener('click', e=>{ e.preventDefault(); setOpen(!root.classList.contains('is-open')); });
              goBtn.addEventListener('click', submit);
              input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ submit(e); } });
            
              // CHIUSO di default
              setOpen(false);
            })();
        </script>
        <!-- ============= /DIZIONARIO FILOSOFICO (MINIMAL INLINE, FIXED HEIGHT + INPUT) ============= -->
        <!-- === WIDGET: Dizionario filosofico (multi-fonte) === -->
        <!-- === WIDGET: Dizionario filosofico (multi-fonte) — versione migliorata === -->
        <style>
          .edx-dict__select {
            background: rgba(20, 20, 40, .85);
            color: #ffd86a;
            border: 1px solid rgba(255, 215, 0, .35);
          }

          .edx-dict__select option {
            background: rgba(10, 10, 30, .95);
            color: #e9eef5;
          }

          .edx-dict__input:focus,
          .edx-dict__select:focus,
          .edx-dict__btn:focus {
            outline: 2px solid #ffd86a;
            outline-offset: 2px;
          }

          .edx-dict[open]+iframe {
            pointer-events: none;
            margin-top: 12px;
            filter: opacity(.85);
          }
        </style>
        <details class="edx-dict" id="edx-dict">
          <summary class="edx-dict__head">
            <span class="edx-dict__title">Dizionario filosofico</span>
            <span class="edx-dict__chev">▾</span>
          </summary>
          <div class="edx-dict__body">
            <form class="edx-dict__controls" id="edx-dict-form" onsubmit="return false;">
              <select class="edx-dict__select" id="edx-source" title="Fonte">
                <option selected="" value="sep">SEP (Stanford)</option>
                <option value="iep">IEP</option>
                <option value="treccani">Treccani</option>
                <option value="philosophica">Philosophica</option>
                <option value="wiki-it">Wikipedia (IT)</option>
              </select>
              <input class="edx-dict__input" id="edx-q" name="query" placeholder="Cerca concetti, autori, scuole…" type="search" />
              <button class="edx-dict__btn" id="edx-go" type="button">Cerca</button>
            </form>
          </div>
        </details>
        <script>
          (function(){
              const build = {
                sep:          q => 'https://plato.stanford.edu/search/searcher.py?query=' + encodeURIComponent(q),
                iep:          q => 'https://iep.utm.edu/?s=' + encodeURIComponent(q),
                treccani:     q => 'https://www.treccani.it/enciclopedia/ricerca/' + encodeURIComponent(q) + '/',
                philosophica: q => 'https://www.philosophica.info/?s=' + encodeURIComponent(q),
                'wiki-it':    q => 'https://it.wikipedia.org/w/index.php?search=' + encodeURIComponent(q)
              };
            
              const form  = document.getElementById('edx-dict-form');
              const sel   = document.getElementById('edx-source');
              const input = document.getElementById('edx-q');
              const btn   = document.getElementById('edx-go');
              if(!form || !sel || !input || !btn) return;
            
              (function rememberSource(){
                const KEY = 'edx-dict-source';
                const saved = localStorage.getItem(KEY);
                if(saved && [...sel.options].some(o => o.value === saved)) sel.value = saved;
                sel.addEventListener('change', () => localStorage.setItem(KEY, sel.value));
              })();
            
              (function dynamicPlaceholder(){
                const hints = {
                  'sep':'es. “noumeno”, “Aristotle”',
                  'iep':'es. “virtue ethics”',
                  'treccani':'es. “ermeneutica”, “Leibniz”',
                  'philosophica':'es. “metafisica”',
                  'wiki-it':'es. “positivismo logico”'
                };
                function update(){ input.placeholder = 'Cerca… ' + (hints[sel.value] || ''); }
                sel.addEventListener('change', update);
                update();
              })();
            
              let busy = false;
              function go(){
                if(busy) return;
                busy = true; setTimeout(() => busy = false, 600);
                const q = (input.value || '').trim(); if(!q) return;
                const src = sel.value || 'sep';
                const url = (build[src] || build.sep)(q);
                window.open(url, '_blank', 'noopener');
              }
            
              btn.addEventListener('click', go);
              input.addEventListener('keydown', e => {
                if(e.key === 'Enter'){ e.preventDefault(); e.stopPropagation(); go(); }
              });
            
              try{
                form.removeAttribute('action');
                form.setAttribute('onsubmit','return false;');
                form.addEventListener('submit', e => { e.preventDefault(); e.stopImmediatePropagation(); return false; }, true);
                const obs = new MutationObserver(() => {
                  form.removeAttribute('action');
                  form.setAttribute('onsubmit','return false;');
                });
                obs.observe(form, { attributes:true, attributeFilter:['action','onsubmit'] });
              }catch(_){}
            })();
        </script>
         <!-- ===== Enciclopedia Filosofica Internet ===== -->
<div class="edx-encyclo" style="margin:20px 0; text-align:center;">
  <a href="https://iep-utm-edu.translate.goog/a/?_x_tr_sl=auto&_x_tr_tl=it&_x_tr_hl=uk&_x_tr_pto=wapp" 
     target="_blank" rel="noopener noreferrer"
     style="display:inline-block; padding:10px 12px; font-family:'Cinzel',serif; font-size:1.1rem;
            color:#ffd700; background:rgba(20,20,40,.85); border:1px solid rgba(255,215,0,.35);
            border-radius:8px; text-decoration:none; transition:background .3s;">
    Enciclopedia filosofica 
  </a>
</div>
        <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="264" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/G_REgkOuQfw" title="Schopenhauer e Nietzsche (Hans-Georg Gadamer) - 3x4" width="280"></iframe>
      </div>
      <style>
        .video-container {
          position: fixed;
          bottom: 60px;
          right: 80px;
          width: 280px;
          z-index: 99;
          padding: 8px;
          border-radius: 12px;
          background-color: rgba(14, 14, 14, 0.4);
          backdrop-filter: blur(8px);
          -webkit-backdrop-filter: blur(8px);
          box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
          transition: transform 0.3s ease;
        }

        .video-container:hover {
          transform: scale(1.02);
        }

        .video-container iframe {
          width: 100%;
          height: 180px;
          border: none;
          border-radius: 8px;
        }

        /* PLAYER sinistra (sotto lo slider) */
        .video-container-left {
          position: fixed;
          left: 12px;
          top: 460px;
          /* sotto lo slider: 120(top) + 320(height) + ~20 margine */
          width: 200px;
          z-index: 99;
          padding: 6px;
          border-radius: 12px;
          background-color: rgba(14, 14, 14, 0.4);
          backdrop-filter: blur(8px);
          -webkit-backdrop-filter: blur(8px);
          box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
          transition: transform 0.3s ease;
        }

        .video-container-left:hover {
          transform: scale(1.02);
        }

        .video-container-left iframe {
          width: 100%;
          height: 110px;
          border: none;
          border-radius: 8px;
        }

        @media (max-width: 980px) {
          .video-container-left {
            display: none;
          }

          /* su mobile lo slider è nascosto, nascondo anche il player sinistro */
          .video-container {
            right: 12px;
            bottom: 12px;
            width: 70vw;
          }
        }

        .cookie-modal.force-open {
          display: flex !important;
        }
      </style>
      <!-- 🎬 FINE PLAYER (destro) -->
      <!-- INIZIO MINI PLAYER (sinistra) -->
      <div class="audio-title">🎹 Musica classica 🎺</div>
      <div class="audio-player" id="audio-player" Musica>
        <audio id="myAudio" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/suoni/Strauss.mp3"></audio>
        <div class="controls">
          <button id="playPause" title="Riproduci/Pausa">▶️</button>
          <span id="time">0:00 / 0:00</span>
          <input id="volume" max="1" min="0" step="0.01" title="Volume" type="range">
          </input>
        </div>
      </div>
      <style>
        /* Mini player */
        .audio-player {
          position: fixed;
          bottom: 210px;
          left: 45px;
          width: 190px;
          background: rgba(10, 10, 30, 0.85);
          color: #aef;
          border: 1px solid #3cf;
          border-radius: 12px;
          padding: 10px 16px;
          font-family: 'Georgia', serif;
          font-size: 14px;
          z-index: 1200;
          /* ↑ sopra blob/slider */
          box-shadow: 0 0 12px #3cf;
          display: flex;
          align-items: center;
          gap: 10px;
          /* se non lo animi via JS, assicurati che sia visibile: */
          opacity: 1;
          transform: none;
        }

        /* Titolo sopra il player */
        .audio-title {
          position: fixed;
          left: 80px;
          bottom: calc(210px + 50px);
          /* ~36px sopra il player: regola se serve */
          font-family: 'Georgia', serif;
          font-size: 13px;
          color: #ffd700;
          text-shadow: 0 0 6px rgba(0, 0, 0, 0.6);
          z-index: 1201;
          /* ↑ un gradino sopra al player */
          pointer-events: none;
          /* non intercetta click */
        }

        /* Compattezza bottoni */
        #audio-player,
        .audio-player {
          --btn-size: 28px;
          --gap: 6px;
          --pad-y: 6px;
          --pad-x: 10px;
          gap: var(--gap);
          padding: var(--pad-y) var(--pad-x);
        }

        #audio-player button,
        .audio-player button {
          display: inline-grid;
          place-items: center;
          width: var(--btn-size);
          height: var(--btn-size);
          padding: 0;
          line-height: 1;
          font-size: calc(var(--btn-size) * 0.65);
        }

        .audio-player button:hover {
          transform: none;
        }

        /* Controlli */
        .audio-player .controls {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .audio-player input[type="range"] {
          width: 70px;
        }

        /* Mobile: nascondi il player */
        @media (max-width: 980px) {

          #audio-player,
          .audio-title {
            display: none;
          }
        }
      </style>
      <script>
        // Inizializzazione mini player
          window.addEventListener('load', () => {
            const box = document.getElementById('audio-player');
            const audio = document.getElementById('myAudio');
            const btn = document.getElementById('playPause');
            const time = document.getElementById('time');
            const vol = document.getElementById('volume');
          
            // Appare con GSAP se disponibile
            try{
              if (window.gsap) {
                gsap.to(box, { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out', delay: 0.4 });
              } else {
                box.style.opacity = '1';
                box.style.transform = 'none';
              }
            }catch(e){ box.style.opacity = '1'; box.style.transform = 'none'; }
          
            function fmt(s){
              if (!isFinite(s)) return '0:00';
              const m = Math.floor(s/60);
              const sec = Math.floor(s%60);
              return m + ':' + (sec<10 ? '0'+sec : sec);
            }
            function updateTime(){
              time.textContent = `${fmt(audio.currentTime)} / ${fmt(audio.duration)}`;
            }
            // Volume di partenza
            vol.value = 0.8;
            audio.volume = parseFloat(vol.value);
          
            // Eventi
            btn.addEventListener('click', () => {
              if (audio.paused){
                audio.play().catch(()=>{});
                btn.textContent = '⏸️';
              } else {
                audio.pause();
                btn.textContent = '▶️';
              }
            });
            vol.addEventListener('input', () => audio.volume = parseFloat(vol.value));
            audio.addEventListener('timeupdate', updateTime);
            audio.addEventListener('loadedmetadata', updateTime);
            audio.addEventListener('ended', () => { btn.textContent = '▶️'; });
          });
      </script>
      <!-- FINE MINI PLAYER (sinistra) -->
      <script>
        window.addEventListener('load', () => {
            if (window.gsap){
              try{
                gsap.from("#video-right", { x: 60, opacity: 0, duration: 0.8, ease: "power2.out", delay: 0.35 });
              }catch(e){}
            }
          });
      </script>
      <!-- Audio effetti -->
      <audio id="thunder-sound" preload="auto" playsinline>
        <source src="/suoni/thunder-sound.mp3" type="audio/mpeg">
        <source src="https://casi0048.github.io/suoni/thunder-sound.mp3" type="audio/mpeg">
      </audio>
      <audio id="explosionSound" preload="auto" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/suoni/explosion-1.mp3"></audio>
      <script>
        (() => {
            // --- RIFERIMENTI ---
            const btnThunder = document.getElementById('btn-thunder');   // ⚡ Tuono
            const btnExplode = document.getElementById('explode-btn');   // 💥 Esplodi
            const thunder    = document.getElementById('thunder-sound'); // <audio>
            const explosion  = document.getElementById('explosionSound');// <audio>
          
            // --- 1) UNLOCK al primo gesto (play→pause invisibile) ---
            let unlocked = false;
            async function unlockOnce() {
              if (unlocked) return;
              unlocked = true;
              for (const a of [thunder, explosion]) {
                if (!a) continue;
                try {
                  a.muted = false;
                  await a.play();
                  a.pause(); a.currentTime = 0;
                } catch (_) {}
              }
              window.removeEventListener('pointerdown', unlockOnce, {capture:true});
              window.removeEventListener('keydown', unlockOnce, {capture:true});
            }
            window.addEventListener('pointerdown', unlockOnce, {once:true, capture:true, passive:true});
            window.addEventListener('keydown', unlockOnce, {once:true, capture:true});
          
            // --- 2) PLAY con FALLBACK MULTIPLO ---
            // Chrome a volte non passa automaticamente al <source> successivo:
            // settiamo le sorgenti a mano e proviamo in sequenza.
            async function playWithFallback(audioEl, sources) {
              for (let i = 0; i < sources.length; i++) {
                const src = sources[i];
                try {
                  // riassegna la sorgente "pulita"
                  audioEl.pause();
                  audioEl.removeAttribute('src');               // reset
                  while (audioEl.firstChild) audioEl.removeChild(audioEl.firstChild);
                  const s = document.createElement('source');
                  s.src = src;
                  s.type = 'audio/mpeg';
                  audioEl.appendChild(s);
                  audioEl.load();
          
                  // aspetta che sia caricabile
                  await new Promise((res, rej) => {
                    const onCan = () => { cleanup(); res(); };
                    const onErr = () => { cleanup(); rej(new Error('error')); };
                    const onStl = () => { cleanup(); rej(new Error('stalled')); };
                    const cleanup = () => {
                      audioEl.removeEventListener('canplaythrough', onCan);
                      audioEl.removeEventListener('error', onErr);
                      audioEl.removeEventListener('stalled', onStl);
                    };
                    audioEl.addEventListener('canplaythrough', onCan, {once:true});
                    audioEl.addEventListener('error', onErr, {once:true});
                    audioEl.addEventListener('stalled', onStl, {once:true});
                    // timeout di sicurezza
                    setTimeout(() => { cleanup(); rej(new Error('timeout')); }, 4000);
                  });
          
                  audioEl.currentTime = 0;
                  await audioEl.play();
                  console.log('[AUDIO OK]', src);
                  return true; // riprodotto
                } catch (e) {
                  console.warn('[AUDIO FALLBACK]', src, e.message || e);
                  continue; // prova il prossimo
                }
              }
              console.error('[AUDIO KO] tutte le sorgenti hanno fallito');
              return false;
            }
          
            // --- 3) LISTENER UNICI sui bottoni (evita conflitti) ---
            if (btnThunder && !btnThunder._bound) {
              btnThunder._bound = true;
              btnThunder.addEventListener('click', async (e) => {
                e.preventDefault();
                const ok = await playWithFallback(thunder, [
                  '/suoni/thunder-sound.mp3',
                  'https://casi0048.github.io/suoni/thunder-sound.mp3'
                ]);
                if (!ok) alert('Audio tuono non disponibile.');
              });
            }
          
            if (btnExplode && !btnExplode._bound) {
              btnExplode._bound = true;
              btnExplode.addEventListener('click', async (e) => {
                e.preventDefault();
                const ok = await playWithFallback(explosion, [
                  '/suoni/explosion-1.mp3',
                  'https://casi0048.github.io/suoni/explosion-1.mp3',
                  // fallback ulteriore: RAW GitHub (può servire in locale/file://)
                  'https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/suoni/explosion-1.mp3'
                ]);
                if (!ok) alert('Audio esplosione non disponibile.');
              });
            }
          
            // --- 4) LOG diagnostico utile in console ---
            [thunder, explosion].forEach((a) => {
              if (!a) return;
              a.addEventListener('error', () => console.warn('[AUDIO error]', a.id));
              a.addEventListener('stalled', () => console.warn('[AUDIO stalled]', a.id));
              a.addEventListener('loadedmetadata', () => console.log('[AUDIO loadedmetadata]', a.id, a.duration));
              a.addEventListener('canplaythrough', () => console.log('[AUDIO canplaythrough]', a.id));
            });
          })();
      </script>
      <!-- COOKIE BANNER -->
      <div aria-label="Consenso cookie" class="cookie-banner" hidden="" id="cookie-banner" role="region">
        <div class="cookie-text">
          <strong>Cookie.</strong> Usiamo cookie tecnici e, con il tuo consenso, analitici e di profilazione per migliorare l’esperienza.
          <a href="https://casi0048.github.io/pagine/privacy-policy.html" rel="noopener" target="_blank">Scopri di più</a>.
        </div>
        <div class="cookie-actions">
          <button class="btn ghost" id="cookie-decline">Rifiuta</button>
          <button class="btn outline" id="cookie-customize">Personalizza</button>
          <button class="btn solid" id="cookie-accept">Accetta</button>
        </div>
      </div>
      <!-- MODAL PREFERENZE -->
      <div aria-hidden="true" aria-labelledby="cookie-modal-title" aria-modal="true" class="cookie-modal" id="cookie-modal" role="dialog">
        <div class="cookie-modal__panel">
          <button aria-label="Chiudi" class="cookie-close" id="cookie-close">×</button>
          <h3 id="cookie-modal-title">Preferenze cookie</h3>
          <p class="muted">Puoi modificare le tue scelte in qualsiasi momento.</p>
          <ul class="cookie-list">
            <li>
              <label>
                <input checked="" disabled="" type="checkbox"> Essenziali (sempre attivi)</input>
              </label>
            </li>
            <li>
              <label>
                <input id="consent-analytics" type="checkbox" /> Analitici</label>
              <small>Ci aiutano a capire come usi il sito.</small>
            </li>
            <li>
              <label>
                <input id="consent-preferences" type="checkbox" /> Preferenze</label>
              <small>Ricordano impostazioni e scelte.</small>
            </li>
            <li>
              <label>
                <input id="consent-marketing" type="checkbox" /> Marketing</label>
              <small>Contenuti e misurazioni personalizzate.</small>
            </li>
          </ul>
          <div class="cookie-modal__actions">
            <button class="btn outline" id="cookie-cancel">Annulla</button>
            <button class="btn solid" id="cookie-save">Salva preferenze</button>
          </div>
        </div>
      </div>
      <!-- Pulsante per riaprire -->
      <button class="ctrl-btn btn-link" id="manage-cookies" title="Gestisci consenso cookie" type="button">
        
      </button>
      <script>
        (function(){
            
          // Global opener: works even if other listeners fail
          window.openCookiePrefs = function(){
          try { if (typeof openModal === 'function') { openModal(); return; } } catch(e){}
          try {
          var m = document.getElementById('cookie-modal');
          if (m){
          m.setAttribute('aria-hidden','false');
          m.style.display = 'flex';
          }
          } catch(_) {}
          };
          // Delegated click for the cookie badge (works even if badge is injected after this script)
          document.addEventListener('click', function(ev){
          var btn = ev.target && ev.target.closest ? ev.target.closest('#cookie-fab') : null;
          if (!btn) return;
          try { openModal(); }
          catch(e){
          try { var m = document.getElementById('cookie-modal'); if (m) m.setAttribute('aria-hidden','false'); } catch(_) {}
          }
          });
          const $banner = document.getElementById('cookie-banner');
            const $modal  = document.getElementById('cookie-modal');
            const $manage = document.getElementById('manage-cookies') || document.getElementById('cookie-manage');
          const $fab = document.getElementById('cookie-fab');
          if ($manage) $manage.hidden = true; // replace text link with floating badge
          
            const $accept = document.getElementById('cookie-accept');
            const $decline = document.getElementById('cookie-decline');
            const $customize = document.getElementById('cookie-customize');
          
            const $save = document.getElementById('cookie-save');
            const $cancel = document.getElementById('cookie-cancel');
            const $close = document.getElementById('cookie-close');
          
            const $an = document.getElementById('consent-analytics');
            const $pr = document.getElementById('consent-preferences');
            const $mk = document.getElementById('consent-marketing');
          
            function getConsent(){
              try{ return JSON.parse(localStorage.getItem(KEY)); }catch(e){ return null; }
            }
            function setConsent(c){
              localStorage.setItem(KEY, JSON.stringify(c));
              applyConsent(c);
            }
            function applyConsent(c){
              // Qui puoi caricare/fermare script in base al consenso.
              // Esempi (da implementare solo se ti servono):
              // if(c.analytics){ loadAnalytics(); } else { disableAnalytics(); }
              // if(c.marketing){ loadMarketing(); } else { disableMarketing(); }
            }
          
            function showBanner(){
          $banner.hidden = false;
          try{
          const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          if (!reduce && window.gsap){
          gsap.fromTo($banner, {y:24, opacity:0}, {y:0, opacity:1, duration:.55, ease:'power3.out'});
          }
          }catch(e){}
          }
            function hideBanner(){
          try{
          const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          if (!reduce && window.gsap){
          gsap.to($banner, {y:16, opacity:0, duration:.35, ease:'power2.in', onComplete(){ $banner.hidden = true; }});
          return;
          }
          }catch(e){}
          $banner.hidden = true;
          }
            function openModal(){
          try{
          const c = getConsent() || {};
          if ($an) $an.checked = !!c.analytics;
          if ($pr) $pr.checked = !!c.preferences;
          if ($mk) $mk.checked = !!c.marketing;
          }catch(e){}
          try{
          $modal.removeAttribute('hidden');
          $modal.setAttribute('aria-hidden','false');
          $modal.style.display = 'flex';
          $modal.classList.add('force-open');
          const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          const panel = $modal.querySelector ? $modal.querySelector('.cookie-modal__panel') : null;
          if (!reduce && window.gsap && panel){
          gsap.fromTo($modal, {opacity:0}, {opacity:1, duration:.25, ease:'power2.out'});
          gsap.fromTo(panel, {y:20, opacity:0}, {y:0, opacity:1, duration:.4, ease:'power3.out'});
          }
          }catch(e){}
          }
          }catch(_){}
          const c = getConsent() || {};
          $an.checked = !!c.analytics;
          $pr.checked = !!c.preferences;
          $mk.checked = !!c.marketing;
          $modal.setAttribute('aria-hidden','false');
          try{
          const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          if (!reduce && window.gsap){
          const panel = $modal.querySelector('.cookie-modal__panel');
          gsap.fromTo($modal, {opacity:0}, {opacity:1, duration:.25, ease:'power2.out'});
          gsap.fromTo(panel, {y:20, opacity:0}, {y:0, opacity:1, duration:.4, ease:'power3.out'});
          }
          }catch(e){}
          };
              $an.checked = !!c.analytics;
              $pr.checked = !!c.preferences;
              $mk.checked = !!c.marketing;
              $modal.setAttribute('aria-hidden','false');
            }
            function closeModal(){
          try{
          if ($modal){
          const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          const panel = $modal.querySelector ? $modal.querySelector('.cookie-modal__panel') : null;
          if (!reduce && window.gsap && panel){
            gsap.to(panel, {y:10, opacity:0, duration:.22, ease:'power2.in'});
            gsap.to($modal, {opacity:0, duration:.22, ease:'power2.in', onComplete(){
              $modal.setAttribute('aria-hidden','true');
              $modal.classList.remove('force-open');
              $modal.style.display = 'none';
              $modal.setAttribute('hidden','');
            }});
          } else {
            $modal.setAttribute('aria-hidden','true');
            $modal.classList.remove('force-open');
            $modal.style.display = 'none';
            $modal.setAttribute('hidden','');
          }
          }
          }catch(e){}
          }
          }catch(_){}
          try{
          const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          if (!reduce && window.gsap){
          const panel = $modal.querySelector('.cookie-modal__panel');
          gsap.to(panel, {y:10, opacity:0, duration:.22, ease:'power2.in'});
          gsap.to($modal, {opacity:0, duration:.22, ease:'power2.in', onComplete(){ $modal.setAttribute('aria-hidden','true'); }});
          return;
          }
          }catch(e){}
          $modal.setAttribute('aria-hidden','true');
          }
          
            // Pulsanti banner
            $accept.addEventListener('click', ()=>{
              setConsent({ essential:true, analytics:true, preferences:true, marketing:true, date:Date.now() });
              hideBanner(); if ($manage) if ($manage) $manage.hidden = true; // keep text button hidden (badge replaces it)
            });
            $decline.addEventListener('click', ()=>{
              setConsent({ essential:true, analytics:false, preferences:false, marketing:false, date:Date.now() });
              hideBanner(); if ($manage) if ($manage) $manage.hidden = true; // keep text button hidden (badge replaces it)
            });
            $customize.addEventListener('click', openModal);
          
            // Modal
          document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ closeModal(); }});
          $save.addEventListener('click', ()=>{
          setConsent({
          essential:true,
          analytics:$an && $an.checked,
          preferences:$pr && $pr.checked,
          marketing:$mk && $mk.checked,
          date:Date.now()
          });
          closeModal();
          hideBanner();
          if ($manage) $manage.hidden = true;
          });
          closeModal(); hideBanner(); if ($manage) if ($manage) $manage.hidden = true; // keep text button hidden (badge replaces it)
            });
            [$cancel,$close].filter(Boolean).forEach(btn=> btn.addEventListener('click', closeModal));
            if ($modal) $modal.addEventListener('click', (e)=>{ if(e.target === $modal) closeModal(); });
            document.addEventListener('keydown', (e)=>{ try{ if(e.key==='Escape') closeModal(); }catch(_){}});
          
            // Riapertura
            if ($manage) $manage.addEventListener('click', openModal);
          
            // Init
            const consent = getConsent();
            if(consent){ hideBanner(); if ($manage) if ($manage) $manage.hidden = true; // keep text button hidden (badge replaces it) applyConsent(consent); }
            else { showBanner(); }
          })();
      </script>
      <!-- injected: universal thunder + lightning + cookie controller -->
      <script>
        (function(){
            // avoid double-injection
            if (window.__echiThunder) return;
            window.__echiThunder = true;
          
            // ---------- helpers
            function $(sel, ctx){ return (ctx||document).querySelector(sel); }
            function $all(sel, ctx){ return Array.prototype.slice.call((ctx||document).querySelectorAll(sel)); }
            function createEl(tag, attrs, css){
              var el = document.createElement(tag);
              if (attrs) for (var k in attrs){ try{ el.setAttribute(k, attrs[k]); }catch(e){} }
              if (css) el.style.cssText = css;
              return el;
            }
            function containsText(el, words){
              if (!el) return false;
              var t = (el.innerText || el.textContent || '').toLowerCase();
              return words.some(function(w){ return t.indexOf(w) !== -1; });
            }
          
            // ---------- audio
            var audio = document.getElementById('thunder-sound');
            if (!audio){
              audio = createEl('audio', { id:'thunder-sound', preload:'auto', crossorigin:'anonymous' });
              var src = createEl('source', { src:'https://casi0048.github.io/suoni/thunder-sound.mp3', type:'audio/mpeg' });
              audio.appendChild(src);
              audio.style.display = 'none';
              document.body.appendChild(audio);
            }
          
            var thunderOn = false;
            function playThunder(){
              if (!thunderOn || !audio) return;
              try { audio.currentTime = 0; audio.play().catch(function(){}); } catch(e){}
            }
            function stopThunder(){
              if (!audio) return;
              try { audio.pause(); audio.currentTime = 0; } catch(e){}
            }
            function setBtnState(btn, on){
              if (!btn) return;
              btn.classList.toggle('active', on);
              btn.setAttribute('aria-pressed', on ? 'true':'false');
              if (!btn.dataset._label) btn.dataset._label = (btn.innerText||btn.textContent||'⚡ Tuono').trim();
              btn.textContent = on ? '⚡ Tuono: ON' : (btn.dataset._label || '⚡ Tuono');
            }
          
            // Find candidate thunder buttons (various heuristics: id/class/name contains thunder/tuono/fulmine; or text has ⚡/tuono)
            function findThunderButtons(){
              var candidates = $all('button, a, [role="button"], .btn, .button');
              return candidates.filter(function(el){
                var idc = (el.id||'') + ' ' + (el.className||'') + ' ' + (el.getAttribute('name')||'');
                idc = idc.toLowerCase();
                var hitsAttr = /thunder|tuono|fulmine|lightning|saetta/.test(idc);
                var hitsText = containsText(el, ['⚡','tuono']);
                return hitsAttr || hitsText;
              });
            }
          
            // Wire up buttons (and re-run after a delay to catch late DOM)
            function wireButtons(){
              findThunderButtons().forEach(function(btn){
                if (btn._thBound) return;
                btn.addEventListener('click', function(ev){
                  // don't steal clicks meant for navigation if it's an <a> without #
                  if (btn.tagName === 'A' && btn.getAttribute('href') && btn.getAttribute('href').trim().charAt(0) !== '#') return;
                  ev.preventDefault();
                  setThunderOn(!thunderOnRef());
                  if (thunderOn) playThunder(); else stopThunder();
                  setBtnState(btn, thunderOn);
                }, false);
                btn._thBound = true;
                // initial paint
                setBtnState(btn, thunderOn);
              });
            }
            wireButtons();
            setTimeout(wireButtons, 800); // catch late-rendered UI
            setTimeout(wireButtons, 2000);
          
            // Also expose a global toggle for any existing handlers
            
          
            // ---------- lightning (10–15s), always on
            var overlay = document.getElementById('lightning');
            if (!overlay){
              overlay = createEl('div', { id:'lightning' }, 'position:fixed;inset:0;pointer-events:none;opacity:0;z-index:5;background:transparent;');
              document.body.appendChild(overlay);
            }
            var bolt = document.getElementById('bolt');
            if (!bolt){
              bolt = createEl('div', { id:'bolt' }, 'position:fixed;left:50%;top:50%;width:3px;height:56vh;background:linear-gradient(#fff,rgba(255,255,255,0));box-shadow:0 0 16px rgba(255,255,255,.9),0 0 32px rgba(255,255,255,.6);opacity:0;pointer-events:none;z-index:6;transform-origin:top;');
              document.body.appendChild(bolt);
            }
            function flash(){
              var xPerc = 15 + Math.random()*70;
              var yPerc = 10 + Math.random()*65;
              var angle  = -25 + Math.random()*50;
              var scaleY = 0.8 + Math.random()*1.2;
          
              overlay.style.transition = 'none'; overlay.offsetHeight;
              overlay.style.background = 'radial-gradient(circle at '+xPerc+'% '+yPerc+'%, rgba(255,255,255,.95), rgba(255,255,255,.22) 40%, transparent 65%)';
              overlay.style.opacity = '1';
              overlay.style.transition = 'opacity 80ms ease-out';
              setTimeout(function(){ overlay.style.opacity = '0'; }, 140);
          
              bolt.style.left = xPerc + '%';
              bolt.style.top  = yPerc + '%';
              bolt.style.transform = 'translate(-50%,-50%) rotate('+angle+'deg) scaleY('+scaleY+')';
              bolt.style.transition = 'transform 90ms ease-out, opacity 280ms ease-out';
              bolt.style.opacity = '1';
              setTimeout(function(){ bolt.style.opacity = '0'; }, 180);
          
              setTimeout(playThunder, 120);
            }
            (function schedule(){
              var MIN = 10000, MAX = 15000; // 10–15s
              setTimeout(function(){ flash(); schedule(); }, MIN + Math.random()*(MAX-MIN));
            })();
          
            // ---------- cookie banner compatibility
            (function(){
              function hideAll(){
                var b = document.getElementById('cookie-banner'); if (b) b.style.display = 'none';
                var m = document.querySelector('.cookie-modal, #cookie-modal'); if (m) m.style.display = 'none';
              }
              function setConsent(v){ try{ localStorage.setItem('cookieConsent', JSON.stringify({ v:v, at: Date.now() })); }catch(e){} }
              function getConsent(){ try{ return JSON.parse(localStorage.getItem('cookieConsent')||'null'); }catch(e){ return null; } }
              var c = getConsent(); if (c && (c.v==='accepted'||c.v==='rejected')) hideAll();
              function bind(sel, fn){
                document.querySelectorAll(sel).forEach(function(el){
                  if (el._ckBound) return;
                  el.addEventListener('click', function(ev){ ev.preventDefault(); fn(); }, false);
                  el._ckBound = true;
                });
              }
              bind('#cookie-accept, #btn-accept-cookies, [data-consent=\"accepted\"]', function(){ setConsent('accepted'); hideAll(); });
              bind('#cookie-reject, #btn-reject-cookies, [data-consent=\"rejected\"]', function(){ setConsent('rejected'); hideAll(); });
              bind('#cookie-save', function(){ setConsent('accepted'); hideAll(); });
              bind('[data-open=\"cookie-modal\"]', function(){ var m = document.querySelector('.cookie-modal, #cookie-modal'); if (m) m.style.display='block'; });
              bind('[data-close=\"cookie-modal\"]', function(){ var m = document.querySelector('.cookie-modal, #cookie-modal'); if (m) m.style.display='none'; });
            })();
          })();
      </script>
      <script>
        (function(){
            // Prendi elementi
            const btn = document.getElementById('btn-thunder');
            const audio = document.getElementById('thunder-sound');
            if (!btn || !audio) return;
          
            // Normalizza audio (alcuni browser sono schizzinosi)
            audio.preload = 'auto';
            audio.muted = false;
            audio.volume = 1.0;
            audio.setAttribute('playsinline',''); // iOS
            audio.setAttribute('type','audio/mpeg');
          
            // Rimuovi eventuali vecchi event listener attaccati al bottone
            const clone = btn.cloneNode(true);
            btn.parentNode.replaceChild(clone, btn);
            const thBtn = document.getElementById('btn-thunder');
          
            // Stato ON/OFF solo per il suono (i lampi restano indipendenti)
            
          
            function updateLabel(){
              thBtn.classList.toggle('active', thunderOn);
              thBtn.setAttribute('aria-pressed', thunderOn ? 'true' : 'false');
              thBtn.textContent = thunderOn ? '⚡ Tuono: ON' : '⚡ Tuono';
            }
          
            async function playOnce(){
              try {
                audio.currentTime = 0;
                await audio.play();      // dentro il click => sbloccato ovunque
              } catch(e) {
                console.warn('Playback bloccato:', e);
              }
            }
          
            function stopNow(){
              try { audio.pause(); audio.currentTime = 0; } catch(e){}
            }
          
            // Toggle ON/OFF al click
            thBtn.addEventListener('click', async function(ev){
              ev.preventDefault();
              setThunderOn(!thunderOnRef());
              if (thunderOn) await playOnce(); else stopNow();
              updateLabel();
            });
          
            // (Opzionale) se hai uno script di lampi che chiama il tuono, usa questo hook globale:
            window.playThunderIfOn = function(){
              if (thunderOn) { try { audio.currentTime = 0; audio.play().catch(()=>{}); } catch(e){} }
            };
          
            updateLabel();
          })();
      </script>
      <script>
        document.getElementById('manage-cookies')?.addEventListener('click', () => {
            const modal  = document.querySelector('.cookie-modal, #cookie-modal');
            const banner = document.getElementById('cookie-banner');
            if (modal) {
              modal.style.display = 'block';      // apre le preferenze
            } else if (banner) {
              localStorage.removeItem('cookieConsent');
              banner.style.display = 'block';     // ripropone il banner
            }
          });
      </script>
      <script>
        function loadGoogleTranslate() {
              new google.translate.TranslateElement({
                  pageLanguage: 'it',
                  includedLanguages: 'en,fr,de,es,pl',
                  layout: google.translate.TranslateElement.InlineLayout.SIMPLE
              }, 'google_translate_element');
          }
          
          window.addEventListener('pageshow', function(event) {
              if (event.persisted) { // se viene dalla cache del browser (Back/Forward)
                  loadGoogleTranslate();
              }
          });
      </script>
      <div aria-hidden="true" id="cse-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.55);backdrop-filter: blur(2px);z-index:9998;"></div>
      <div aria-labelledby="cse-title" aria-modal="true" id="cse-panel" role="dialog" style="display:none;position:fixed;top:6vh;right:4vw;width:88vw;max-width:980px;height:88vh;z-index:9999;background:rgba(10,10,26,0.9);border:1px solid rgba(120,140,220,0.3);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.6);overflow:hidden;">
        <div id="cse-header" style="display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 14px;border-bottom:1px solid rgba(120,140,220,0.2);">
          <h3 id="cse-title" style="margin:0;font-size:1rem;color:#eaf2ff;letter-spacing:.3px;">Risultati di ricerca</h3>
          <div id="cse-controls" style="display:flex;align-items:center;gap:10px;">
            <button id="cse-theme-toggle" style="padding:6px 10px;border-radius:10px;border:1px solid rgba(120,140,220,0.4);background:rgba(120,140,220,0.15);color:#e6f0f3;cursor:pointer;font-size:.9rem;" type="button">Tema: Scuro</button>
            <button aria-label="Chiudi risultati" id="cse-close" style="padding:6px 10px;border-radius:10px;border:1px solid rgba(220,120,120,0.5);background:rgba(220,120,120,0.15);color:#ffdede;cursor:pointer;font-size:.9rem;" type="button">✕ Chiudi</button>
          </div>
        </div>
        <div id="cse-content" style="position:absolute;inset:52px 0 0 0;overflow:auto;padding:10px 12px;">
          <div id="cse-results" style="display:none;max-width:900px;margin:20px auto;">
            <div class="gcse-searchresults-only" data-gname="results" data-linktarget="_self" data-queryparametername="q"></div>
          </div>
        </div>
      </div>
      <style>
        /* === CSE Panel Themes & High Contrast === */
        :root {
          --cse-bg: #0a0a1a;
          --cse-panel: #0a0a1a;
          --cse-card: #141628;
          --cse-txt: #eaf2ff;
          --cse-sub: #cfd8ff;
          --cse-url: #96ffa6;
        }

        .cse-light {
          --cse-bg: #f7f9ff;
          --cse-panel: #ffffff;
          --cse-card: #f3f6ff;
          --cse-txt: #0b0e19;
          --cse-sub: #2b3550;
          --cse-url: #0e6b2c;
        }

        #cse-panel {
          background: var(--cse-panel) !important;
        }

        #cse-results {
          background: color-mix(in oklab, var(--cse-panel), transparent 20%) !important;
        }

        .gsc-control-cse,
        .gsc-control-cse .gsc-table-result,
        .gsc-results-wrapper-visible {
          background: transparent !important;
        }

        .gsc-result,
        .gsc-webResult.gsc-result,
        .gsc-results .gsc-imageResult {
          background: var(--cse-card) !important;
          border: 1px solid color-mix(in oklab, var(--cse-txt), transparent 70%) !important;
          border-radius: 10px !important;
          padding: 10px !important;
        }

        .gsc-webResult.gsc-result:hover {
          background: color-mix(in oklab, var(--cse-card), white 6%) !important;
        }

        .gsc-result .gs-title,
        .gsc-result .gs-title * {
          color: var(--cse-txt) !important;
          text-decoration: none !important;
        }

        .gsc-result .gs-snippet {
          color: var(--cse-sub) !important;
        }

        .gsc-url-top,
        .gsc-url-bottom,
        .gsc-url-top * {
          color: var(--cse-url) !important;
        }

        .gsc-cursor-page {
          color: var(--cse-txt) !important;
          border-color: color-mix(in oklab, var(--cse-txt), transparent 70%) !important;
        }

        .gsc-results .gsc-cursor-box .gsc-cursor-page.gsc-cursor-current-page {
          background: color-mix(in oklab, var(--cse-txt), transparent 85%) !important;
          color: var(--cse-bg) !important;
        }

        .gcsc-find-more-on-google,
        .gcsc-find-more-on-google-root {
          background: transparent !important;
        }

        input.gsc-input,
        .gsc-input-box,
        .gsc-input-box-hover,
        .gsc-input-box-focus {
          background: color-mix(in oklab, var(--cse-card), transparent 5%) !important;
          color: var(--cse-txt) !important;
          border-color: color-mix(in oklab, var(--cse-txt), transparent 75%) !important;
        }

        .gsc-selected-option-container {
          color: var(--cse-txt) !important;
        }

        .cookie-modal.force-open {
          display: flex !important;
        }
      </style>
      <script>
        (function(){
            var CSE_CX = '87b07564ab3cb462a'; // cambia se hai un altro ID
            var input    = document.getElementById('site-search');
            var icon     = document.querySelector('.search-icon');
            var box      = document.getElementById('cse-results');
            var overlay  = document.getElementById('cse-overlay');
            var panel    = document.getElementById('cse-panel');
            var closeBtn = document.getElementById('cse-close');
            var themeBtn = document.getElementById('cse-theme-toggle');
          
            function ensureCSELoaded(cb){
              if (window.google && google.search && google.search.cse && google.search.cse.element){ cb(); return; }
              var done = false;
              window.__gcse = { callback: function(){ if (!done){ done = true; cb(); } } };
              if (!document.querySelector('script[data-cse-loader]')){
                var s = document.createElement('script');
                s.src = 'https://cse.google.com/cse.js?cx=' + encodeURIComponent(CSE_CX);
                s.async = true; s.defer = true; s.setAttribute('data-cse-loader','1');
                document.head.appendChild(s);
              }
            }
          
            function renderInline(){
              try {
                google.search.cse.element.render({
                  div: 'cse-results',
                  tag: 'searchresults-only',
                  gname: 'results'
                });
              } catch(e){}
            }
          
            function getResultsElement(){
              if (!(window.google && google.search && google.search.cse && google.search.cse.element)) return null;
              var el = google.search.cse.element.getElement('results');
              if (!el){ renderInline(); el = google.search.cse.element.getElement('results'); }
              return el;
            }
          
            function openPanel(){
              if (overlay) overlay.style.display = 'block';
              if (panel)   panel.style.display   = 'block';
            }
            function closePanel(){
              if (overlay) overlay.style.display = 'none';
              if (panel)   panel.style.display   = 'none';
            }
            if (overlay) overlay.addEventListener('click', closePanel);
            if (closeBtn) closeBtn.addEventListener('click', closePanel);
          
            if (themeBtn){
              var light = false;
              themeBtn.addEventListener('click', function(){
                light = !light;
                document.body.classList.toggle('cse-light', light);
                themeBtn.textContent = light ? 'Tema: Chiaro' : 'Tema: Scuro';
              });
            }
          
            function executeQuery(q){
            if (!q) return;
            const siteRestrict = '(site:echidisofia.org OR site:casi0048.github.io)';
            ensureCSELoaded(function(){
              var tries = 0;
              (function waitReady(){
                try{
                  var el = (google && google.search && google.search.cse && google.search.cse.element)
                    ? google.search.cse.element.getElement('SEARCH_RESULTS')
                    : (typeof getResultsElement === 'function' ? getResultsElement() : null);
                  if (el && typeof el.execute === 'function'){
                    el.execute(`${q} ${siteRestrict}`);
                    if (typeof openPanel === 'function') openPanel();
                    if (typeof box !== 'undefined' && box) box.style.display = 'block';
                  } else if (tries++ < 100){
                    setTimeout(waitReady, 100);
                  }
                }catch(e){
                  if (tries++ < 100) setTimeout(waitReady, 120);
                }
              })();
            });
          } /* else-if removed (cleanup) */ {
                    setTimeout(waitReady, 100);
                  }
                })();
              });
            }
          
            function submitFromInput(){
            try{
              var term = (input && input.value) ? input.value.trim() : '';
              if (!term) return;
              executeQuery(term);
            }catch(e){}
          }
          
            if (input){
              input.addEventListener('keydown', function(e){
                if (e.key === 'Enter'){
                  e.preventDefault();
                  submitFromInput();
                }
              });
            }
            if (icon){
              icon.addEventListener('click', function(e){
                e.preventDefault();
                submitFromInput();
              });
            }
          })();
      </script>
      <script>
        (function(){
            function setCookie(name, value){
              var domain = location.hostname.replace(/^www\./,'');
              var exp = "; expires=" + new Date(Date.now()+365*24*60*60*1000).toUTCString();
              document.cookie = name + "=" + value + exp + "; path=/";
              document.cookie = name + "=" + value + exp + "; path=/; domain=." + domain;
            }
            function getCookie(name){
              return (document.cookie.match('(^|;)\s*'+name+'\s*=\s*([^;]+)')||[])[2] || "";
            }
            window.__initGoogleTranslate = function(){
              if (window.google && google.translate && google.translate.TranslateElement) {
                var host = document.getElementById('google_translate_element');
                if (!host) {
                  host = document.createElement('div'); host.id='google_translate_element';
                  host.setAttribute('aria-hidden','true');
                  host.style.cssText="position:absolute;left:-9999px;top:-9999px;height:0;width:0;overflow:hidden";
                  document.body.appendChild(host);
                } else { host.innerHTML = ""; }
                new google.translate.TranslateElement({
                  pageLanguage: 'it',
                  includedLanguages: 'it,en,fr,de,es,pl,pt,ru,ja,zh-CN,ar',
                  autoDisplay: false
                }, 'google_translate_element');
                var c = getCookie("googtrans");
                var lang = (c.split("/")[2] || "it");
                var internal = document.querySelector(".goog-te-combo");
                if (internal && lang) { internal.value = lang; internal.dispatchEvent(new Event('change')); }
              } else {
                setTimeout(window.__initGoogleTranslate, 120);
              }
            };
            (function injectOnce(){
              if (document.querySelector('script[data-gtr]')) return;
              var s = document.createElement('script');
              s.src = "https://translate.google.com/translate_a/element.js?cb=__initGoogleTranslate";
              s.async = true; s.defer = true; s.setAttribute('data-gtr','1');
              document.head.appendChild(s);
            })();
            function applyLang(lang){
              var val = (lang && lang !== 'it') ? ("/it/"+lang) : "/it/it";
              setCookie("googtrans", val);
              var internal = document.querySelector(".goog-te-combo");
              if (internal) { internal.value = lang; internal.dispatchEvent(new Event('change')); }
              else { location.reload(); }
            }
            function syncUI(){
              var sel = document.getElementById('customTranslate');
              if (!sel) return;
              var c = getCookie("googtrans");
              var current = (c.split("/")[2] || "it");
              for (var i=0;i<sel.options.length;i++){ if (sel.options[i].value === current) { sel.selectedIndex = i; break; } }
            }
            document.addEventListener('change', function(e){
              if (e.target && e.target.id === 'customTranslate') {
                applyLang(e.target.value);
              }
            });
            window.addEventListener('pageshow', syncUI);
            document.addEventListener('visibilitychange', function(){ if (!document.hidden) syncUI(); });
            syncUI();
          })();
      </script>
      <script>
        (function(){
            try{
              var searchBtn = document.getElementById('cse-search-btn') || document.querySelector('[data-cse-search-btn]');
              if (typeof input !== 'undefined' && input && !input.__cseBound){
                input.addEventListener('keydown', function(e){
                  if (e.key === 'Enter'){ e.preventDefault(); submitFromInput(); }
                });
                input.__cseBound = true;
              }
              if (searchBtn && !searchBtn.__cseBound){
                searchBtn.addEventListener('click', function(e){
                  e.preventDefault(); submitFromInput();
                });
                searchBtn.__cseBound = true;
              }
            }catch(e){}
          })();
      </script>
      <button aria-label="Gestisci cookie" class="cookie-fab" id="cookie-fab" onclick="window.openCookiePrefs &amp;&amp; window.openCookiePrefs()" title="Gestisci cookie"><span class="emoji">🍪</span><span class="label">Cookie</span></button>
      <script>
        (function(){
            function openPrefsHard(){
              try {
                var m = document.getElementById('cookie-modal');
                if (!m) return;
                m.removeAttribute('hidden');
                m.setAttribute('aria-hidden', 'false');
                m.style.display = 'flex';
                m.classList.add('force-open');
                // focus first close or save button for accessibility
                setTimeout(function(){
                  var f = m.querySelector('#cookie-close, #cookie-save, button');
                  if (f && f.focus) try{ f.focus(); }catch(e){}
                }, 30);
              } catch(e){}
            }
            window.openCookiePrefs = function(){
              try { if (typeof openModal === 'function') { openModal(); return; } } catch(e){}
              openPrefsHard();
            };
            function bind(){
              var b = document.getElementById('cookie-fab');
              if (!b) return;
              b.addEventListener('click', function(e){
                e.preventDefault();
                window.openCookiePrefs();
              });
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', bind);
            } else { bind(); }
          })();
      </script>
      <script>
        // === FINAL FAIL-SAFE CLOSER (binds at end, takes precedence) ===
          (function(){
            function closeCookieModalHard(){
              try{
                var m = document.getElementById('cookie-modal');
                if (!m) return;
                m.setAttribute('aria-hidden','true');
                m.classList.remove('force-open');
                m.style.display = 'none';
                m.setAttribute('hidden','');
              }catch(e){}
            }
            // Bind to buttons (capture to pre-empt other handlers if needed)
            ['cookie-close','cookie-cancel'].forEach(function(id){
              var b = document.getElementById(id);
              if (b) b.addEventListener('click', function(ev){ ev.preventDefault(); closeCookieModalHard(); }, {capture:true});
            });
            var saveBtn = document.getElementById('cookie-save');
            if (saveBtn){
              saveBtn.addEventListener('click', function(){ setTimeout(closeCookieModalHard, 10); }, {capture:true});
            }
            // Click outside & ESC
            var modal = document.getElementById('cookie-modal');
            if (modal){
              modal.addEventListener('click', function(e){ if (e.target === modal) closeCookieModalHard(); }, {capture:true});
            }
            document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeCookieModalHard(); }, {capture:true});
            // Expose globally too
            window.closeCookieModalHard = closeCookieModalHard;
          })();
      </script>
      <!-- Improved Uniform Google Search: both ENTER & LENS open Google (site-restricted, exact term) -->
      <script>
        (function(){
            // Try to locate the main search input conservatively
            var input = document.getElementById('cse-input')
                   || (document.querySelector('header input[type="search"]'))
                   || document.querySelector('input[type="search"]')
                   || document.querySelector('input[name="q"], input[name="s"]');
          
            function normalizeTerm(raw){
              var t = (raw || '').trim();
              if (!t) return '';
              var hasQuote = /["]/.test(t);
              var hasOp = /(site:|intitle:|inurl:|OR|AND|NOT)/i.test(t);
              if (!hasQuote && !hasOp){
                t = '"' + t.replace(/"/g, '') + '"';
              }
              return t;
            }
            function googleUrl(q){
              var site = 'site:echidisofia.org OR site:casi0048.github.io';
              var term = normalizeTerm(q);
              return 'https://www.google.com/search?q=' + encodeURIComponent(term + ' ' + site) + '&hl=it';
            }
            function openGoogleFromInput(){
              var term = (input && input.value) ? input.value.trim() : '';
              if (!term) return;
              var url = googleUrl(term);
              try{
                var w = window.open(url, '_blank', 'noopener');
                if(!w){ location.href = url; }
              }catch(_){ location.href = url; }
            }
          
            // ENTER on the input (capture to beat other listeners)
            document.addEventListener('keydown', function(e){
              if (!input) return;
              var isTarget = (e.target === input) || (input.contains && input.contains(e.target));
              if (isTarget && e.key === 'Enter'){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                openGoogleFromInput();
              }
            }, true);
          
            // Delegated click for search buttons (lens/submit)
            document.addEventListener('click', function(e){
              var sel = '#cse-search-btn, [data-cse-search-btn], .cse-search-btn, button[type=submit], .search button';
              var btn = e.target && e.target.closest ? e.target.closest(sel) : null;
              if (!btn) return;
              // If the button is not part of a search bar, ignore
              var scope = btn.closest && btn.closest('form, header, .search, .searchbar') || document;
              var relatedInput = scope.querySelector && (scope.querySelector('#cse-input') || scope.querySelector('input[type="search"]') || scope.querySelector('input[name="q"], input[name="s"]'));
              if (relatedInput) input = relatedInput;
              e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
              openGoogleFromInput();
            }, true);
          
            // Intercept form submit around the input
            var form = input ? (input.form || (input.closest && input.closest('form'))) : null;
            if (form){
              form.addEventListener('submit', function(e){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                openGoogleFromInput();
              }, true);
            }
          })();
      </script>
      <!--  inizio script stelle cadenti  da dx a sx-->
      <script>
        const canvas = document.getElementById("shooting-stars");
          const ctx = canvas.getContext("2d");
          
          let w, h;
          function resizeCanvas() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
          }
          window.addEventListener("resize", resizeCanvas);
          resizeCanvas();
          
          class ShootingStar {
            constructor() {
              this.reset();
            }
            reset() {
              this.x = Math.random() * w;
              this.y = Math.random() * h * 0.5;
              this.len = Math.random() * 80 + 10;
              this.speed = Math.random() * 4 + 2;
              this.size = Math.random() * 2 + 1;
              this.opacity = Math.random() * 0.5 + 0.5;
            }
            update() {
              this.x -= this.speed;
          this.y += this.speed * 0.5; // meno discesa
          
              if (this.x < -this.len || this.y > h + this.len) {
                this.reset();
                this.x = Math.random() * w + w;
                this.y = Math.random() * h * 0.7;
              }
            }
            draw() {
              ctx.beginPath();
              const grad = ctx.createLinearGradient(this.x, this.y, this.x + this.len, this.y - this.len);
              grad.addColorStop(0, `rgba(255,255,255,${this.opacity})`);
              grad.addColorStop(1, "rgba(255,255,255,0)");
              ctx.strokeStyle = grad;
              ctx.lineWidth = this.size;
              ctx.moveTo(this.x, this.y);
              ctx.lineTo(this.x + this.len, this.y - this.len);
              ctx.stroke();
            }
          }
          
          let stars = [];
          for (let i = 0; i < 20; i++) {
            stars.push(new ShootingStar());
          }
          
          function animate() {
            ctx.clearRect(0, 0, w, h);
            stars.forEach(star => {
              star.update();
              star.draw();
            });
            requestAnimationFrame(animate);
          }
          animate();
          
          let minSpeed = 4;
          let maxSpeed = 12;
          this.speed = Math.random() * (maxSpeed - minSpeed) + minSpeed;
      </script>
      <!--  fine script stelle cadenti-->
      <script>
        (() => {
            const canvas = document.getElementById("shooting-stars");
            const ctx = canvas.getContext("2d");
          
            // HiDPI/Retina fix: scala il canvas in base al devicePixelRatio
            const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
            let W = 0, H = 0;
            function resize() {
              W = canvas.clientWidth  = window.innerWidth;
              H = canvas.clientHeight = window.innerHeight;
              canvas.width  = W * dpr;
              canvas.height = H * dpr;
              ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // disegna in coordinate CSS
            }
            window.addEventListener("resize", resize, { passive: true });
            resize();
          
            // Parametri regolabili
            const COUNT     = 7;     // quante stelle simultanee
          
          
          const MIN_SPEED = 1;
          const MAX_SPEED = 2;
          
           const MIN_LEN   = 30;     // lunghezza scia (min)
            const MAX_LEN   = 110;    // lunghezza scia (max)
            const MIN_SIZE  = 1.2;    // spessore linea (min)
            const MAX_SIZE  = 2.2;    // spessore linea (max)
          
            class ShootingStar {
              constructor() { this.reset(true); }
              rand(min, max) { return Math.random() * (max - min) + min; }
          
              reset(init = false) {
                // punto di partenza: parte alta/destra per traiettoria diagonale ↘
                this.x = init ? this.rand(0, W * 1.2) : W + this.rand(0, 200);
                this.y = this.rand(0, H * 0.5);
          
                this.len   = this.rand(MIN_LEN, MAX_LEN);
                this.speed = this.rand(MIN_SPEED, MAX_SPEED);
                this.size  = this.rand(MIN_SIZE, MAX_SIZE);
                this.opacity = this.rand(0.5, 1);
          
                // Colore casuale per la singola stella (fisso finché non viene resettata)
                this.hue = Math.floor(Math.random() * 360);
                this.startColor = `hsla(${this.hue}, 100%, 70%, ${this.opacity})`;
                this.endColor   = `hsla(${this.hue}, 100%, 70%, 0)`;
              }
          
              update() {
                // Movimento diagonale: verso sinistra e verso il basso
                this.x -= this.speed;
                this.y += this.speed;
          
                // Se esce dallo schermo, ricomincia da destra/alto
                if (this.x < -this.len || this.y > H + this.len) this.reset();
              }
          
              draw() {
                ctx.beginPath();
                const grad = ctx.createLinearGradient(
                  this.x, this.y,
                  this.x + this.len, this.y - this.len
                );
                grad.addColorStop(0, this.startColor); // testa
                grad.addColorStop(1, this.endColor);   // scia
          
                ctx.strokeStyle = grad;
                ctx.lineWidth = this.size;
                ctx.lineCap = "round";
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x + this.len, this.y - this.len);
                ctx.stroke();
              }
            }
          
            const stars = Array.from({ length: COUNT }, () => new ShootingStar());
          
            // opzionale: scie più morbide usando un velo semitrasparente anziché clearRect pieno
            function fadeBackground() {
              ctx.fillStyle = "rgba(0,0,0,0.2)"; // aumenta opacità se vuoi scie più corte
              ctx.fillRect(0, 0, W, H);
            }
          
            function loop() {
              // Se preferisci niente scie persistenti, usa clearRect.
              // ctx.clearRect(0, 0, W, H);
              fadeBackground();
              for (const s of stars) { s.update(); s.draw(); }
              requestAnimationFrame(loop);
            }
          
            // Imposta un fondo iniziale nero (utile quando si usa fadeBackground)
            ctx.fillStyle = "black"; ctx.fillRect(0, 0, W, H);
            loop();
          })();
      </script>
      <!--  fine script stelle cadentin da dx a sx-->
      <!--  INIZIO Particelle filosofiche — distribuzione su tutta pagina + repulsione -->
      <script>
        document.addEventListener('DOMContentLoaded', function(){
            // Container
            let container = document.getElementById('philoParticles');
            if (!container) {
              container = document.createElement('div');
              container.id = 'philoParticles';
              document.body.appendChild(container);
            } else {
              document.body.appendChild(container);
            }
          
            // CSS (una sola volta)
            const STYLE_ID = 'philoParticles-style';
            if (!document.getElementById(STYLE_ID)){
              const st = document.createElement('style'); st.id = STYLE_ID;
              st.textContent = `
                #philoParticles{
                  position: fixed; inset: 0;
                  z-index: 60;
                  pointer-events: none;
                }
                #philoParticles .particle{
                  position: absolute;
                  transform: translate3d(0,0,0);
                  will-change: transform;
                  white-space: nowrap;
                  line-height: 1;
                  text-shadow: 0 0 8px rgba(255,255,255,.45);
                  opacity: .98;
                  /* abilito hover solo se serve: qui resta tutto pass-through */
                  pointer-events: none;
                }
              `;
              document.head.appendChild(st)
            }
          
            // Sorgente simboli/parole
            const symbols = [
              '∞','Φ','Ψ','Λ','Δ','Ω','π','∑','∏','√',
              '≡','≈','∴','∀','∃','∈','∧','∨','⊕','⊗',
              'Σ','Θ','Ξ','ℵ','∂','∇','∫',
              'Sapienza','Verità','Logos','Thanatos','Mito','Essere','Divenire',
              'Idee','Archè','Armonia','Principio','Destino','Libertà','Giustizia',
              'Virtù','Pensiero','Domanda','Risposta','Silenzio','Samsara','Nirvana',
              'Epicuro','Parmenide','Dialogo','Socratico','Platone','Sostanza',
              'Aristotele','Stoà','Eraclito','Nous','Anima','Cosmo',
              'Ipazia','😸Livia','Maria Teresa','Gesù Nazareno','Demetrio Falereo','😺 Polpetta','Casimiro','Guido','Francesco',
              '✨','⚖️','🌎','🛸 ','📚','🪐','🌌','💭','🧠','🗣️','📝','💡','👨‍🚀','🌓','🌕',
              '🌠','☄️','🪐','🌙','🌍 ','🌞','🚀','📗','📙','📕','🔬','☀️',
              '🧭','⌛','🌗','🛸','🌏 ','🌖','🌔','💫 ','🕳️','♾️'
            ];
          
            // Utilità
            const shuffle = a => { for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; };
            const rand = (a,b)=> Math.random()*(b-a)+a;
            const rndInt = n => Math.floor(Math.random()*n);
            const randHSL = ()=> `hsl(${Math.floor(Math.random()*360)} 100% 70%)`;
          
            // Config
            const cfg = {
              count: 160,          // quante particelle
              minSize: 0.5,        // rem
              maxSize: 1,          // rem
              floatDist: 100,      // raggio di oscillazione
              minSpeed: 0.003,
              maxSpeed: 0.009,
              useRandomHSL: true,
          
          
              // distribuzione
              padding: 16,         // px: margine dai bordi
              jitter: 0.65,        // 0..1: “disordine” dentro la cella
          
              // repulsione
              repelRadius: 120,    // px
              repelStrength: 28    // px
            };
          
            const palette = ['#FFD700','#40E0D0','#FF6347','#9370DB','#00BFFF','#7CFC00','#FF69B4','#FF8C00','#DA70D6','#1E90FF'];
          
            // Stato
            const particles = [];
            let order = [];        // ordine simboli garantito (copertura completa)
            let mx = -1e6, my = -1e6, mouseActive = false;
          
            // Prepara una lista di simboli lunga almeno quanto count e mescolata
            function buildSymbolOrder(){
              order.length = 0;
              // ripeti l’array finché superi count
              while(order.length < cfg.count) order.push(...symbols);
              order = order.slice(0, cfg.count);
              shuffle(order);
            }
          
            // Crea una griglia proporzionata all’aspect-ratio della finestra:
            // celle ~quadrate ⇒ copertura omogenea su tutta la pagina
            function gridLayout(w, h, n){
              const aspect = w / h;
              let cols = Math.max(1, Math.round(Math.sqrt(n * aspect)));
              let rows = Math.max(1, Math.ceil(n / cols));
              // ricalibra per coprire esattamente n
              while(cols*rows < n) rows++;
              return { cols, rows };
            }
          
            function makeParticles(){
              container.innerHTML = "";
              particles.length = 0;
              buildSymbolOrder();
          
              const w = innerWidth  - cfg.padding*2;
              const h = innerHeight - cfg.padding*2;
              const { cols, rows } = gridLayout(w, h, cfg.count);
          
              // Pre-calcola centri cella
              const cells = [];
              for(let r=0; r<rows; r++){
                for(let c=0; c<cols; c++){
                  const cx = cfg.padding + (c + 0.5) * (w / cols);
                  const cy = cfg.padding + (r + 0.5) * (h / rows);
                  cells.push({cx, cy});
                }
              }
              shuffle(cells); // sparpaglia le celle utilizzate
          
              for (let i=0; i<cfg.count; i++){
                const el = document.createElement('div');
                el.className = 'particle';
                el.textContent = order[i];
          
                const size = rand(cfg.minSize, cfg.maxSize);
                el.style.fontSize = size + 'rem';
                el.style.color = cfg.useRandomHSL ? randHSL() : palette[rndInt(palette.length)];
                container.appendChild(el);
          
                const {cx, cy} = cells[i];
          
                // jitter naturale dentro la cella (niente “soldatini”)
                const cellW = w / cols, cellH = h / rows;
                const jx = (Math.random() - 0.5) * cellW * cfg.jitter;
                const jy = (Math.random() - 0.5) * cellH * cfg.jitter;
          
                particles.push({
                  el, size,
                  x: cx + jx,
                  y: cy + jy,
                  ang: Math.random()*Math.PI*2,
                  speed: rand(cfg.minSpeed, cfg.maxSpeed),
                  radius: rand(10, 10 + cfg.floatDist)
                ,
          // rotazione dolce avanti/indietro
          spinAmp:  rand(24, 36),
          spinPhase: Math.random()*Math.PI*2,
          spinFreq:  rand(0.6, 1.4)
          });
              }
            }
          
            // Repulsione (solo mouse/desktop)
            window.addEventListener('pointermove', (e)=>{
              if(e.pointerType && e.pointerType !== 'mouse') return;
              mx = e.clientX; my = e.clientY;
              mouseActive = true;
            }, {passive:true});
            window.addEventListener('pointerleave', ()=>{
              mouseActive = false;
              mx = my = -1e6;
            }, {passive:true});
          
            // Animazione
            function render(){
              for (const p of particles){
                p.ang += p.speed;
                // oscillazione “fluttuante”
                let bx = p.x + Math.cos(p.ang)*p.radius;
                let by = p.y + Math.sin(p.ang*0.7)*p.radius;
                const rot = Math.sin(p.ang * p.spinFreq + p.spinPhase) * p.spinAmp;
          
                // repulsione dolce
                if(mouseActive){
                  const dx = bx - mx, dy = by - my;
                  const d  = Math.hypot(dx, dy);
                  if(d < cfg.repelRadius){
                    const t = 1 - d / cfg.repelRadius;
                    const push = cfg.repelStrength * t * t;
                    const ux = dx / (d || 1), uy = dy / (d || 1);
                    bx += ux * push;
                    by += uy * push;
                  }
                }
          
                p.el.style.transform = `translate3d(${bx}px, ${by}px, 0) translate(-50%, -50%) rotate(${rot}deg)`;
              }
              requestAnimationFrame(render);
            }
          
            // Debounce resize
            let rAF = 0;
            function onResize(){
              if(rAF) cancelAnimationFrame(rAF);
              rAF = requestAnimationFrame(()=>{ makeParticles(); rAF = 0; });
            }
          
            makeParticles();
            render();
            addEventListener('resize', onResize);
          });
      </script>
      <!--  FINE SCRIPT PARTICELLE -->
      <!-- === CSE CLEAN-LOCK PATCH (single-instance, forced internal) === -->
      <style>
        #cseCL-panel {
          position: fixed;
          inset: 0;
          z-index: 20050;
          display: none
        }

        #cseCL-panel[aria-hidden="false"] {
          display: block
        }

        #cseCL-backdrop {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, .55);
          backdrop-filter: blur(2px)
        }

        #cseCL-shell {
          position: absolute;
          left: 50%;
          top: 12vh;
          transform: translateX(-50%);
          width: min(980px, 94vw);
          max-height: 76vh;
          overflow: auto;
          background: #0a1326;
          border: 1px solid rgba(255, 215, 0, .25);
          border-radius: 12px;
          padding: 12px 14px;
          color: #eaeaea
        }

        #cseCL-close {
          position: sticky;
          top: 0;
          margin: -4px -4px 8px auto;
          padding: 8px 10px;
          border-radius: 10px;
          cursor: pointer;
          background: rgba(255, 255, 255, .06);
          border: 1px solid rgba(255, 255, 255, .18)
        }

        #cseCL-title {
          margin: 6px 0 8px;
          font-family: Cinzel, serif;
          color: #ffd86a;
          font-size: 1.05rem
        }

        /* contrast fixes */
        .gsc-control-cse,
        .gsc-control-wrapper-cse {
          background: transparent !important;
        }

        .gsc-webResult.gsc-result {
          background: rgba(255, 255, 255, .04) !important;
          border: 1px solid rgba(255, 255, 255, .08) !important;
          border-radius: 10px !important;
          padding: 8px !important;
        }

        .gs-title,
        .gs-snippet {
          color: #eaeaea !important;
        }

        .gsc-result-info,
        .gsc-orderby-label {
          color: #cbd5e1 !important;
        }
      </style>
      <div aria-hidden="true" aria-label="Risultati di ricerca (interni)" aria-modal="true" id="cseCL-panel" role="dialog">
        <div id="cseCL-backdrop"></div>
        <div id="cseCL-shell">
          <button aria-label="Chiudi" id="cseCL-close" type="button">✖ Chiudi</button>
          <h3 id="cseCL-title">RISULTATI</h3>
          <div id="cseCL-results"></div>
        </div>
      </div>
      <script>
        (function(){
            // Single loader (re-add ours)
            var s = document.createElement('script');
            s.async = true; s.src = "https://cse.google.com/cse.js?cx=87b07564ab3cb462a";
            document.documentElement.appendChild(s);
          
            var panel = document.getElementById('cseCL-panel');
            var backdrop = document.getElementById('cseCL-backdrop');
            var closeBt = document.getElementById('cseCL-close');
            var resultsDiv = document.getElementById('cseCL-results');
            var RENDERED_FLAG = '__cseCL_rendered__';
          
            function openPanel(){ panel.setAttribute('aria-hidden','false'); document.documentElement.style.overflow='hidden'; }
            function closePanel(){ panel.setAttribute('aria-hidden','true'); document.documentElement.style.overflow=''; }
            closeBt.addEventListener('click', closePanel);
            backdrop.addEventListener('click', closePanel);
            document.addEventListener('keydown', function(e){ if(e.key==='Escape') closePanel(); }, true);
          
            function currentQuery(){
              var i = document.getElementById('site-search') ||
                      document.querySelector('.top-bar input[type="search"], header input[type="search"], .search input[type="search"]') ||
                      document.querySelector('.top-bar input[type="text"], header input[type="text"], .search input[type="text"]') ||
                      document.querySelector('input[type="search"]') ||
                      document.querySelector('input[type="text"]');
              return i && i.value ? i.value.trim() : '';
            }
          
            function clearDuplicateGcseInsidePanel(){
              // remove any pre-rendered gcse nodes inside our shell to avoid 30 boxes
              var nodes = resultsDiv.querySelectorAll('.gsc-control-cse, .gcse-search, .gcse-searchresults-only');
              nodes.forEach(function(n){ n.remove(); });
              // also clear the container
              resultsDiv.innerHTML = '<div id="cseCL-root"></div>';
            }
          
            function ensureRendered(){
              if (window[RENDERED_FLAG]) return true;
              try{
                if (!(window.google && google.search && google.search.cse && google.search.cse.element)) return false;
                clearDuplicateGcseInsidePanel();
                google.search.cse.element.render({
                  div: 'cseCL-root',
                  tag: 'searchresults-only',
                  gname: 'results' // use a fixed gname
                });
                window[RENDERED_FLAG] = true;
                return true;
              }catch(e){ console.error(e); return false; }
            }
          
            function execInternal(q){
              q = (q||'').trim(); if(!q) return;
              openPanel();
              var start = Date.now();
              (function tick(){
                try{
                  if (ensureRendered()){
                    var api = google.search.cse.element;
                    var el = api.getElement('results');
                    if (el && typeof el.execute === 'function'){ el.execute(q); return; }
                  }
                }catch(e){ console.error(e); }
                if (Date.now()-start < 8000){ return setTimeout(tick, 60); }
              })();
            }
          
            // Hard-neutralize external openers
            window.googleUrl = function(){ return '#'; };
            window.openGoogleFromInput = function(){ execInternal(currentQuery()); };
            window.submitFromInput = function(){ execInternal(currentQuery()); };
            window.executeQuery = function(q){ execInternal(q); };
          
            // Capture handlers to block external navigation and duplicates
            function isLens(el){
              if (!el) return false;
              if (el.matches && el.matches('.search-icon, .fa-magnifying-glass, [data-cse-search-btn], #cse-search-btn, .cse-search-btn, button[type=submit]')) return true;
              return !!(el.closest && el.closest('.search-icon, .fa-magnifying-glass, [data-cse-search-btn], #cse-search-btn, .cse-search-btn, .search button, button[type=submit]'));
            }
            function isSearchInput(el){ return el && el.tagName==='INPUT' && (el.type==='search' || el.type==='text'); }
          
            document.addEventListener('keydown', function(e){
              if (e.key!=='Enter') return;
              if (isSearchInput(e.target)){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                execInternal(currentQuery());
              }
            }, true);
          
            document.addEventListener('click', function(e){
              if (isLens(e.target)){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                execInternal(currentQuery());
              }
            }, true);
          
            document.addEventListener('submit', function(e){
              if (e && e.target && e.target.querySelector && e.target.querySelector('input[type="search"], input[type="text"]')){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                execInternal(currentQuery());
              }
            }, true);
          })();
      </script>
      <!-- === CSE CLEAN-LOCK PATCH (single-instance, forced internal) === -->
      <style>
        #cseCL-panel {
          position: fixed;
          inset: 0;
          z-index: 20050;
          display: none
        }

        #cseCL-panel[aria-hidden="false"] {
          display: block
        }

        #cseCL-backdrop {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, .55);
          backdrop-filter: blur(2px)
        }

        #cseCL-shell {
          position: absolute;
          left: 50%;
          top: 12vh;
          transform: translateX(-50%);
          width: min(980px, 94vw);
          max-height: 76vh;
          overflow: auto;
          background: #0a1326;
          border: 1px solid rgba(255, 215, 0, .25);
          border-radius: 12px;
          padding: 12px 14px;
          color: #eaeaea
        }

        #cseCL-close {
          position: sticky;
          top: 0;
          margin: -4px -4px 8px auto;
          padding: 8px 10px;
          border-radius: 10px;
          cursor: pointer;
          background: rgba(255, 255, 255, .06);
          border: 1px solid rgba(255, 255, 255, .18)
        }

        #cseCL-title {
          margin: 6px 0 8px;
          font-family: Cinzel, serif;
          color: #ffd86a;
          font-size: 1.05rem
        }

        /* contrast fixes */
        .gsc-control-cse,
        .gsc-control-wrapper-cse {
          background: transparent !important;
        }

        .gsc-webResult.gsc-result {
          background: rgba(255, 255, 255, .04) !important;
          border: 1px solid rgba(255, 255, 255, .08) !important;
          border-radius: 10px !important;
          padding: 8px !important;
        }

        .gs-title,
        .gs-snippet {
          color: #eaeaea !important;
        }

        .gsc-result-info,
        .gsc-orderby-label {
          color: #cbd5e1 !important;
        }
      </style>
      <div aria-hidden="true" aria-label="Risultati di ricerca (interni)" aria-modal="true" id="cseCL-panel" role="dialog">
        <div id="cseCL-backdrop"></div>
        <div id="cseCL-shell">
          <button aria-label="Chiudi" id="cseCL-close" type="button">✖ Chiudi</button>
          <h3 id="cseCL-title">RISULTATI</h3>
          <div id="cseCL-results"></div>
        </div>
      </div>
      <script>
        (function(){
            // Single loader (re-add ours)
            var s = document.createElement('script');
            s.async = true; s.src = "https://cse.google.com/cse.js?cx=87b07564ab3cb462a";
            document.documentElement.appendChild(s);
          
            var panel = document.getElementById('cseCL-panel');
            var backdrop = document.getElementById('cseCL-backdrop');
            var closeBt = document.getElementById('cseCL-close');
            var resultsDiv = document.getElementById('cseCL-results');
            var RENDERED_FLAG = '__cseCL_rendered__';
          
            function openPanel(){ panel.setAttribute('aria-hidden','false'); document.documentElement.style.overflow='hidden'; }
            function closePanel(){ panel.setAttribute('aria-hidden','true'); document.documentElement.style.overflow=''; }
            closeBt.addEventListener('click', closePanel);
            backdrop.addEventListener('click', closePanel);
            document.addEventListener('keydown', function(e){ if(e.key==='Escape') closePanel(); }, true);
          
            function currentQuery(){
              var i = document.getElementById('site-search') ||
                      document.querySelector('.top-bar input[type="search"], header input[type="search"], .search input[type="search"]') ||
                      document.querySelector('.top-bar input[type="text"], header input[type="text"], .search input[type="text"]') ||
                      document.querySelector('input[type="search"]') ||
                      document.querySelector('input[type="text"]');
              return i && i.value ? i.value.trim() : '';
            }
          
            function clearDuplicateGcseInsidePanel(){
              // remove any pre-rendered gcse nodes inside our shell to avoid 30 boxes
              var nodes = resultsDiv.querySelectorAll('.gsc-control-cse, .gcse-search, .gcse-searchresults-only');
              nodes.forEach(function(n){ n.remove(); });
              // also clear the container
              resultsDiv.innerHTML = '<div id="cseCL-root"></div>';
            }
          
            function ensureRendered(){
              if (window[RENDERED_FLAG]) return true;
              try{
                if (!(window.google && google.search && google.search.cse && google.search.cse.element)) return false;
                clearDuplicateGcseInsidePanel();
                google.search.cse.element.render({
                  div: 'cseCL-root',
                  tag: 'searchresults-only',
                  gname: 'results' // use a fixed gname
                });
                window[RENDERED_FLAG] = true;
                return true;
              }catch(e){ console.error(e); return false; }
            }
          
            function execInternal(q){
              q = (q||'').trim(); if(!q) return;
              openPanel();
              var start = Date.now();
              (function tick(){
                try{
                  if (ensureRendered()){
                    var api = google.search.cse.element;
                    var el = api.getElement('results');
                    if (el && typeof el.execute === 'function'){ el.execute(q); return; }
                  }
                }catch(e){ console.error(e); }
                if (Date.now()-start < 8000){ return setTimeout(tick, 60); }
              })();
            }
          
            // Hard-neutralize external openers
            window.googleUrl = function(){ return '#'; };
            window.openGoogleFromInput = function(){ execInternal(currentQuery()); };
            window.submitFromInput = function(){ execInternal(currentQuery()); };
            window.executeQuery = function(q){ execInternal(q); };
          
            // Capture handlers to block external navigation and duplicates
            function isLens(el){
              if (!el) return false;
              if (el.matches && el.matches('.search-icon, .fa-magnifying-glass, [data-cse-search-btn], #cse-search-btn, .cse-search-btn, button[type=submit]')) return true;
              return !!(el.closest && el.closest('.search-icon, .fa-magnifying-glass, [data-cse-search-btn], #cse-search-btn, .cse-search-btn, .search button, button[type=submit]'));
            }
            function isSearchInput(el){ return el && el.tagName==='INPUT' && (el.type==='search' || el.type==='text'); }
          
            document.addEventListener('keydown', function(e){
              if (e.key!=='Enter') return;
              if (isSearchInput(e.target)){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                execInternal(currentQuery());
              }
            }, true);
          
            document.addEventListener('click', function(e){
              if (isLens(e.target)){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                execInternal(currentQuery());
              }
            }, true);
          
            document.addEventListener('submit', function(e){
              if (e && e.target && e.target.querySelector && e.target.querySelector('input[type="search"], input[type="text"]')){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                execInternal(currentQuery());
              }
            }, true);
          })();
      </script>
      <!-- Aggiungi questo codice prima della chiusura 
      <!-- === CONSERVATIVE ENTER FIX + siteData (real excerpts) === -->
      <script>
        (function(){
            // 1) Site data (estratti reali dal sito)
            window.siteData = window.siteData || [
              { url: "Presocratici/talete.html", title: "Talete di Mileto", content: "Talete fu una figura poliedrica del pensiero arcaico: matematico, astronomo e politico; la sua dottrina sull’acqua come principio originario ci è nota soprattutto attraverso Aristotele." },
              { url: "Presocratici/anassimandro.html", title: "Anassimandro di Mileto", content: "Pioniere del pensiero scientifico, discepolo di Talete; introdusse l’ápeiron come principio e sviluppò una visione naturale e razionale del cosmo." },
              { url: "Presocratici/anassimene.html", title: "Anassimene di Mileto", content: "Ultimo dei milesi: identificò nell’aria l’archè di tutte le cose, proseguendo la ricerca dei presocratici sulle cause naturali." },
              { url: "Presocratici/senofane.html", title: "Senofane di Colofone", content: "Poeta‑filosofo viandante: critica radicale alla religione tradizionale e fondazione della scuola eleatica." },
              { url: "articoli/ermarco.html", title: "Ermarco di Mitilene", content: "Successore di Epicuro nel Giardino: preservò e diffuse la dottrina epicurea con fedeltà e innovazione, guidando la scuola dopo il 270 a.C." },
              { url: "articoli/seneca.html", title: "Lucio Anneo Seneca", content: "Figura eminente della filosofia romana: stoico, drammaturgo e statista; i suoi scritti mirano alla tranquillità interiore e alla virtù in un’epoca turbolenta." },
              { url: "articoli/eudemo.html", title: "Eudemo di Rodi", content: "Discepolo fedele di Aristotele e membro di spicco della scuola peripatetica; ponte tra l’insegnamento aristotelico e la tradizione successiva." },
              { url: "pagine/benvenuti.html", title: "Presentazione (Incipit)", content: "Echi di Sofia: uno spazio dedicato alla meraviglia e alla saggezza, dove il pensiero antico e moderno risuona oggi attraverso domande che attraversano il tempo." },
              { url: "articoli/tarski.html", title: "Alfred Tarski", content: "Logico e filosofo del linguaggio: teoria semantica della verità (Convenzione T), contributi a logica, geometria e teoria degli insiemi; influenze su filosofia e informatica teorica." },
              { url: "articoli/frege.html", title: "Gottlob Frege", content: "Padre della logica moderna: dal Begriffsschrift alla distinzione senso/riferimento; ha fondato la logica dei predicati e influenzato l’analitica." },
              { url: "articoli/lyotard.html", title: "Jean‑François Lyotard", content: "Teorico del postmoderno: fine delle grandi narrazioni, giochi linguistici, legittimazione performativa del sapere; opere come La condizione postmoderna e Il dissidio." },
              { url: "pagine/pagina-contatti.html", title: "Contatti", content: "Pagina di contatto per domande, suggerimenti e collaborazioni con Echi di Sofia." }
            ];
          
            // 2) ENTER = click sulla lente (nessun cambio layout/animazioni)
            function triggerSearchFrom(el){
              try{
                var input = el && (el.tagName ? el : null);
                var container = input && input.closest && (input.closest('.search-container') || input.closest('.bar-right') || input.closest('.top-bar') || input.closest('form') || document);
                var btn = container && container.querySelector && (container.querySelector('.search-icon') ||
                          container.querySelector('[data-cse-search-btn]') ||
                          container.querySelector('#cse-search-btn') ||
                          container.querySelector('.cse-search-btn') ||
                          container.querySelector('button[type="submit"]'));
                if (btn && typeof btn.click === 'function'){ btn.click(); return true; }
          
                var q = (input && input.value) ? input.value.trim() : '';
                if (typeof submitFromInput === 'function'){ submitFromInput(); return true; }
                if (typeof openGoogleFromInput === 'function'){ openGoogleFromInput(); return true; }
                if (typeof executeQuery === 'function'){ executeQuery(q); return true; }
                document.dispatchEvent(new CustomEvent('perform-site-search', { detail: { query: q } }));
                return false;
              }catch(e){ console.error(e); return false; }
            }
          
            function onEnter(e){
              if (e.key === 'Enter'){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                triggerSearchFrom(e.target);
              }
            }
          
            function bindEnterHandlers(){
              var nodes = Array.from(document.querySelectorAll('#site-search, input[type="search"]'));
              nodes.forEach(function(inp){
                if (!inp.__enterFixBound){
                  inp.addEventListener('keydown', onEnter, true);
                  inp.__enterFixBound = true;
                }
              });
            }
            bindEnterHandlers();
          
            document.addEventListener('submit', function(e){
              try{
                var target = e.target;
                if (target && target.querySelector && target.querySelector('#site-search, input[type="search"]')){
                  e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                  var inp = target.querySelector('#site-search, input[type="search"]');
                  triggerSearchFrom(inp || document.getElementById('site-search'));
                }
              }catch(_ ){}
            }, true);
          
            var mo = new MutationObserver(function(){ bindEnterHandlers(); });
            mo.observe(document.documentElement, { childList: true, subtree: true });
          })();
      </script>
      <!-- === SEARCH: stable clear icon (no duplicates) === -->
      <script>
        (function(){
            function ensureClearFor(input){
              if (!input) return;
              var wrap = (input.closest && input.closest('.search-container')) || input.parentElement;
              if (!wrap) return;
              // evita duplicati: se esiste già, riusa
              var btn = wrap.querySelector('.clear-icon');
              if (!btn){
                btn = document.createElement('span');
                btn.className = 'clear-icon';
                btn.setAttribute('role','button');
                btn.setAttribute('aria-label','Pulisci ricerca');
                btn.title = 'Pulisci';
                btn.textContent = '✖';
                wrap.appendChild(btn);
              }
              if (!btn.__bound){
                btn.addEventListener('click', function(){
                  input.value = '';
                  input.focus();
                  // notifica eventuali listener
                  input.dispatchEvent(new Event('input', { bubbles: true }));
                  input.dispatchEvent(new Event('change', { bubbles: true }));
                });
                btn.__bound = true;
              }
            }
            function initAll(){
              document.querySelectorAll('.search-container input[type="search"], .search-container input[type="text"], #site-search')
                .forEach(ensureClearFor);
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', initAll, { once:true });
            } else {
              initAll();
            }
            new MutationObserver(initAll).observe(document.documentElement, { childList:true, subtree:true });
          })();
      </script>
      <script>
        (function(){
            function playExplosion(){
              var boom = document.getElementById('explosionSound');
              if (boom){
                try{ boom.currentTime = 0; }catch(e){}
                var p = boom.play();
                if (p && typeof p.catch === 'function'){
                  p.catch(function(err){ console.warn('Audio esplosione bloccato:', err); });
                }
              }
            }
            function triggerExplodeEffect(){
              var el = document.getElementById('exploding');
              if (!el) return;
              // se esiste il listener GSAP, riusa il click
              var hadGsap = !!window.gsap && el.querySelector('span');
              if (hadGsap){
                el.dispatchEvent(new Event('click', {bubbles:true}));
              } else {
                el.classList.add('explode');
                setTimeout(function(){ el.classList.remove('explode'); }, 1200);
              }
            }
            function bind(){
              var btn = document.getElementById('btn-explode');
              if (!btn) return;
              if (btn.__explosionBound) return;
              btn.addEventListener('click', function(){
                playExplosion();
                triggerExplodeEffect();
              });
              btn.__explosionBound = true;
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', bind);
            } else {
              bind();
            }
          })();
      </script>
      <!-- Aggiungi questo codice prima della chiusura 
      <!-- === CONSERVATIVE ENTER FIX + siteData (real excerpts) === -->
      <script>
        (function(){
            // 1) Site data (estratti reali dal sito)
            window.siteData = window.siteData || [
              { url: "Presocratici/talete.html", title: "Talete di Mileto", content: "Talete fu una figura poliedrica del pensiero arcaico: matematico, astronomo e politico; la sua dottrina sull’acqua come principio originario ci è nota soprattutto attraverso Aristotele." },
              { url: "Presocratici/anassimandro.html", title: "Anassimandro di Mileto", content: "Pioniere del pensiero scientifico, discepolo di Talete; introdusse l’ápeiron come principio e sviluppò una visione naturale e razionale del cosmo." },
              { url: "Presocratici/anassimene.html", title: "Anassimene di Mileto", content: "Ultimo dei milesi: identificò nell’aria l’archè di tutte le cose, proseguendo la ricerca dei presocratici sulle cause naturali." },
              { url: "Presocratici/senofane.html", title: "Senofane di Colofone", content: "Poeta‑filosofo viandante: critica radicale alla religione tradizionale e fondazione della scuola eleatica." },
              { url: "articoli/ermarco.html", title: "Ermarco di Mitilene", content: "Successore di Epicuro nel Giardino: preservò e diffuse la dottrina epicurea con fedeltà e innovazione, guidando la scuola dopo il 270 a.C." },
              { url: "articoli/seneca.html", title: "Lucio Anneo Seneca", content: "Figura eminente della filosofia romana: stoico, drammaturgo e statista; i suoi scritti mirano alla tranquillità interiore e alla virtù in un’epoca turbolenta." },
              { url: "articoli/eudemo.html", title: "Eudemo di Rodi", content: "Discepolo fedele di Aristotele e membro di spicco della scuola peripatetica; ponte tra l’insegnamento aristotelico e la tradizione successiva." },
              { url: "pagine/benvenuti.html", title: "Presentazione (Incipit)", content: "Echi di Sofia: uno spazio dedicato alla meraviglia e alla saggezza, dove il pensiero antico e moderno risuona oggi attraverso domande che attraversano il tempo." },
              { url: "articoli/tarski.html", title: "Alfred Tarski", content: "Logico e filosofo del linguaggio: teoria semantica della verità (Convenzione T), contributi a logica, geometria e teoria degli insiemi; influenze su filosofia e informatica teorica." },
              { url: "articoli/frege.html", title: "Gottlob Frege", content: "Padre della logica moderna: dal Begriffsschrift alla distinzione senso/riferimento; ha fondato la logica dei predicati e influenzato l’analitica." },
              { url: "articoli/lyotard.html", title: "Jean‑François Lyotard", content: "Teorico del postmoderno: fine delle grandi narrazioni, giochi linguistici, legittimazione performativa del sapere; opere come La condizione postmoderna e Il dissidio." },
              { url: "pagine/pagina-contatti.html", title: "Contatti", content: "Pagina di contatto per domande, suggerimenti e collaborazioni con Echi di Sofia." }
            ];
          
            // 2) ENTER = click sulla lente (nessun cambio layout/animazioni)
            function triggerSearchFrom(el){
              try{
                var input = el && (el.tagName ? el : null);
                var container = input && input.closest && (input.closest('.search-container') || input.closest('.bar-right') || input.closest('.top-bar') || input.closest('form') || document);
                var btn = container && container.querySelector && (container.querySelector('.search-icon') ||
                          container.querySelector('[data-cse-search-btn]') ||
                          container.querySelector('#cse-search-btn') ||
                          container.querySelector('.cse-search-btn') ||
                          container.querySelector('button[type="submit"]'));
                if (btn && typeof btn.click === 'function'){ btn.click(); return true; }
          
                var q = (input && input.value) ? input.value.trim() : '';
                if (typeof submitFromInput === 'function'){ submitFromInput(); return true; }
                if (typeof openGoogleFromInput === 'function'){ openGoogleFromInput(); return true; }
                if (typeof executeQuery === 'function'){ executeQuery(q); return true; }
                document.dispatchEvent(new CustomEvent('perform-site-search', { detail: { query: q } }));
                return false;
              }catch(e){ console.error(e); return false; }
            }
          
            function onEnter(e){
              if (e.key === 'Enter'){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                triggerSearchFrom(e.target);
              }
            }
          
            function bindEnterHandlers(){
              var nodes = Array.from(document.querySelectorAll('#site-search, input[type="search"]'));
              nodes.forEach(function(inp){
                if (!inp.__enterFixBound){
                  inp.addEventListener('keydown', onEnter, true);
                  inp.__enterFixBound = true;
                }
              });
            }
            bindEnterHandlers();
          
            document.addEventListener('submit', function(e){
              try{
                var target = e.target;
                if (target && target.querySelector && target.querySelector('#site-search, input[type="search"]')){
                  e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                  var inp = target.querySelector('#site-search, input[type="search"]');
                  triggerSearchFrom(inp || document.getElementById('site-search'));
                }
              }catch(_ ){}
            }, true);
          
            var mo = new MutationObserver(function(){ bindEnterHandlers(); });
            mo.observe(document.documentElement, { childList: true, subtree: true });
          })();
      </script>
      <!-- === SEARCH: stable clear icon (no duplicates) === -->
      <script>
        (function(){
            function ensureClearFor(input){
              if (!input) return;
              var wrap = (input.closest && input.closest('.search-container')) || input.parentElement;
              if (!wrap) return;
              // evita duplicati: se esiste già, riusa
              var btn = wrap.querySelector('.clear-icon');
              if (!btn){
                btn = document.createElement('span');
                btn.className = 'clear-icon';
                btn.setAttribute('role','button');
                btn.setAttribute('aria-label','Pulisci ricerca');
                btn.title = 'Pulisci';
                btn.textContent = '✖';
                wrap.appendChild(btn);
              }
              if (!btn.__bound){
                btn.addEventListener('click', function(){
                  input.value = '';
                  input.focus();
                  // notifica eventuali listener
                  input.dispatchEvent(new Event('input', { bubbles: true }));
                  input.dispatchEvent(new Event('change', { bubbles: true }));
                });
                btn.__bound = true;
              }
            }
            function initAll(){
              document.querySelectorAll('.search-container input[type="search"], .search-container input[type="text"], #site-search')
                .forEach(ensureClearFor);
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', initAll, { once:true });
            } else {
              initAll();
            }
            new MutationObserver(initAll).observe(document.documentElement, { childList:true, subtree:true });
          })();
      </script>
      </audio>
      <script>
        (function(){
            function playExplosion(){
              var boom = document.getElementById('explosionSound');
              if (boom){
                try{ boom.currentTime = 0; }catch(e){}
                var p = boom.play();
                if (p && typeof p.catch === 'function'){
                  p.catch(function(err){ console.warn('Audio esplosione bloccato:', err); });
                }
              }
            }
            function triggerExplodeEffect(){
              var el = document.getElementById('exploding');
              if (!el) return;
              // se esiste il listener GSAP, riusa il click
              var hadGsap = !!window.gsap && el.querySelector('span');
              if (hadGsap){
                el.dispatchEvent(new Event('click', {bubbles:true}));
              } else {
                el.classList.add('explode');
                setTimeout(function(){ el.classList.remove('explode'); }, 1200);
              }
            }
            function bind(){
              var btn = document.getElementById('btn-explode');
              if (!btn) return;
              if (btn.__explosionBound) return;
              btn.addEventListener('click', function(){
                playExplosion();
                triggerExplodeEffect();
              });
              btn.__explosionBound = true;
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', bind);
            } else {
              bind();
            }
          })();
      </script>
      <div id="cse-results-container" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;padding:20px;box-sizing:border-box;">
        <div style="max-width:800px;margin:0 auto;background:#0a0a1a;padding:20px;border-radius:8px;border:1px solid var(--gold);max-height:80vh;overflow:auto;">
          <button onclick="closeSearchResults()" style="float:right;background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;">×</button>
          <h2 style="color:var(--gold);margin-top:0;">Risultati della ricerca</h2>
          <div class="gcse-searchresults-only" id="cse-results"></div>
        </div>
      </div>
      <script>
        // Inizializzazione CSE
          function initGoogleCSE() {
            var cx = '87b07564ab3cb462a'; // Sostituisci con il tuo CX
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
            
            // Cerca input e icona
            var searchInput = document.getElementById('site-search');
            var searchIcon = document.querySelector('.search-icon');
            
            if (searchInput) {
              searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                  e.preventDefault();
                  executeSearch(this.value);
                }
              });
            }
            
            if (searchIcon) {
              searchIcon.addEventListener('click', function(e) {
                e.preventDefault();
                executeSearch(searchInput.value);
              });
            }
          }
          
          // Esegui ricerca
          function executeSearch(query) {
            if (!query.trim()) return;
            
            var container = document.getElementById('cse-results-container');
            container.style.display = 'block';
            
            // Se Google CSE è già caricato
            if (window.google && google.search && google.search.cse) {
              var element = google.search.cse.element.getElement('searchresults-only0');
              if (element) {
                element.execute(query);
              } else {
                // Se l'elemento non esiste, prova a renderizzarlo
                google.search.cse.element.render({
                  div: 'cse-results',
                  tag: 'searchresults-only'
                });
                setTimeout(function() {
                  var el = google.search.cse.element.getElement('searchresults-only0');
                  if (el) el.execute(query);
                }, 500);
              }
            }
          }
          
          // Chiudi risultati
          function closeSearchResults() {
            document.getElementById('cse-results-container').style.display = 'none';
          }
          
          // Carica CSE quando la pagina è pronta
          if (document.readyState === 'complete') {
            initGoogleCSE();
          } else {
            window.addEventListener('load', initGoogleCSE);
          }
      </script>
      <style>
        /* Stili per i risultati di ricerca */
        .gsc-control-cse {
          background-color: transparent !important;
          border: none !important;
          padding: 0 !important;
        }

        .gsc-webResult.gsc-result {
          background-color: rgba(20, 20, 40, 0.8) !important;
          border: 1px solid var(--menu-border) !important;
          margin-bottom: 10px !important;
          padding: 15px !important;
          border-radius: 6px !important;
        }

        .gs-title,
        .gs-title * {
          color: #9ad0ff !important;
          text-decoration: none !important;
          font-weight: bold !important;
        }

        .gs-title:hover,
        .gs-title:hover * {
          color: #fff !important;
        }

        .gs-snippet {
          color: #cfe8ff !important;
        }

        .gsc-url-top,
        .gsc-url-bottom {
          color: var(--cyan) !important;
        }

        .gsc-cursor-box {
          margin-top: 20px;
          text-align: center;
        }

        .gsc-cursor-page {
          color: #fff !important;
          border-color: var(--gold) !important;
          background: transparent !important;
        }

        .gsc-cursor-current-page {
          background: var(--gold) !important;
          color: #000 !important;
        }
      </style>
      <!-- Aggiungi questo CODICE PRIMA del tag 
      <!-- === CONSERVATIVE ENTER FIX + siteData (real excerpts) === -->
      <script>
        (function(){
            // 1) Site data (estratti reali dal sito)
            window.siteData = window.siteData || [
              { url: "Presocratici/talete.html", title: "Talete di Mileto", content: "Talete fu una figura poliedrica del pensiero arcaico: matematico, astronomo e politico; la sua dottrina sull’acqua come principio originario ci è nota soprattutto attraverso Aristotele." },
              { url: "Presocratici/anassimandro.html", title: "Anassimandro di Mileto", content: "Pioniere del pensiero scientifico, discepolo di Talete; introdusse l’ápeiron come principio e sviluppò una visione naturale e razionale del cosmo." },
              { url: "Presocratici/anassimene.html", title: "Anassimene di Mileto", content: "Ultimo dei milesi: identificò nell’aria l’archè di tutte le cose, proseguendo la ricerca dei presocratici sulle cause naturali." },
              { url: "Presocratici/senofane.html", title: "Senofane di Colofone", content: "Poeta‑filosofo viandante: critica radicale alla religione tradizionale e fondazione della scuola eleatica." },
              { url: "articoli/ermarco.html", title: "Ermarco di Mitilene", content: "Successore di Epicuro nel Giardino: preservò e diffuse la dottrina epicurea con fedeltà e innovazione, guidando la scuola dopo il 270 a.C." },
              { url: "articoli/seneca.html", title: "Lucio Anneo Seneca", content: "Figura eminente della filosofia romana: stoico, drammaturgo e statista; i suoi scritti mirano alla tranquillità interiore e alla virtù in un’epoca turbolenta." },
              { url: "articoli/eudemo.html", title: "Eudemo di Rodi", content: "Discepolo fedele di Aristotele e membro di spicco della scuola peripatetica; ponte tra l’insegnamento aristotelico e la tradizione successiva." },
              { url: "pagine/benvenuti.html", title: "Presentazione (Incipit)", content: "Echi di Sofia: uno spazio dedicato alla meraviglia e alla saggezza, dove il pensiero antico e moderno risuona oggi attraverso domande che attraversano il tempo." },
              { url: "articoli/tarski.html", title: "Alfred Tarski", content: "Logico e filosofo del linguaggio: teoria semantica della verità (Convenzione T), contributi a logica, geometria e teoria degli insiemi; influenze su filosofia e informatica teorica." },
              { url: "articoli/frege.html", title: "Gottlob Frege", content: "Padre della logica moderna: dal Begriffsschrift alla distinzione senso/riferimento; ha fondato la logica dei predicati e influenzato l’analitica." },
              { url: "articoli/lyotard.html", title: "Jean‑François Lyotard", content: "Teorico del postmoderno: fine delle grandi narrazioni, giochi linguistici, legittimazione performativa del sapere; opere come La condizione postmoderna e Il dissidio." },
              { url: "pagine/pagina-contatti.html", title: "Contatti", content: "Pagina di contatto per domande, suggerimenti e collaborazioni con Echi di Sofia." }
            ];
          
            // 2) ENTER = click sulla lente (nessun cambio layout/animazioni)
            function triggerSearchFrom(el){
              try{
                var input = el && (el.tagName ? el : null);
                var container = input && input.closest && (input.closest('.search-container') || input.closest('.bar-right') || input.closest('.top-bar') || input.closest('form') || document);
                var btn = container && container.querySelector && (container.querySelector('.search-icon') ||
                          container.querySelector('[data-cse-search-btn]') ||
                          container.querySelector('#cse-search-btn') ||
                          container.querySelector('.cse-search-btn') ||
                          container.querySelector('button[type="submit"]'));
                if (btn && typeof btn.click === 'function'){ btn.click(); return true; }
          
                var q = (input && input.value) ? input.value.trim() : '';
                if (typeof submitFromInput === 'function'){ submitFromInput(); return true; }
                if (typeof openGoogleFromInput === 'function'){ openGoogleFromInput(); return true; }
                if (typeof executeQuery === 'function'){ executeQuery(q); return true; }
                document.dispatchEvent(new CustomEvent('perform-site-search', { detail: { query: q } }));
                return false;
              }catch(e){ console.error(e); return false; }
            }
          
            function onEnter(e){
              if (e.key === 'Enter'){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                triggerSearchFrom(e.target);
              }
            }
          
            function bindEnterHandlers(){
              var nodes = Array.from(document.querySelectorAll('#site-search, input[type="search"]'));
              nodes.forEach(function(inp){
                if (!inp.__enterFixBound){
                  inp.addEventListener('keydown', onEnter, true);
                  inp.__enterFixBound = true;
                }
              });
            }
            bindEnterHandlers();
          
            document.addEventListener('submit', function(e){
              try{
                var target = e.target;
                if (target && target.querySelector && target.querySelector('#site-search, input[type="search"]')){
                  e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                  var inp = target.querySelector('#site-search, input[type="search"]');
                  triggerSearchFrom(inp || document.getElementById('site-search'));
                }
              }catch(_ ){}
            }, true);
          
            var mo = new MutationObserver(function(){ bindEnterHandlers(); });
            mo.observe(document.documentElement, { childList: true, subtree: true });
          })();
      </script>
      <!-- === SEARCH: stable clear icon (no duplicates) === -->
      <script>
        (function(){
            function ensureClearFor(input){
              if (!input) return;
              var wrap = (input.closest && input.closest('.search-container')) || input.parentElement;
              if (!wrap) return;
              // evita duplicati: se esiste già, riusa
              var btn = wrap.querySelector('.clear-icon');
              if (!btn){
                btn = document.createElement('span');
                btn.className = 'clear-icon';
                btn.setAttribute('role','button');
                btn.setAttribute('aria-label','Pulisci ricerca');
                btn.title = 'Pulisci';
                btn.textContent = '✖';
                wrap.appendChild(btn);
              }
              if (!btn.__bound){
                btn.addEventListener('click', function(){
                  input.value = '';
                  input.focus();
                  // notifica eventuali listener
                  input.dispatchEvent(new Event('input', { bubbles: true }));
                  input.dispatchEvent(new Event('change', { bubbles: true }));
                });
                btn.__bound = true;
              }
            }
            function initAll(){
              document.querySelectorAll('.search-container input[type="search"], .search-container input[type="text"], #site-search')
                .forEach(ensureClearFor);
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', initAll, { once:true });
            } else {
              initAll();
            }
            new MutationObserver(initAll).observe(document.documentElement, { childList:true, subtree:true });
          })();
      </script>
      </audio>
      <script>
        (function(){
            function playExplosion(){
              var boom = document.getElementById('explosionSound');
              if (boom){
                try{ boom.currentTime = 0; }catch(e){}
                var p = boom.play();
                if (p && typeof p.catch === 'function'){
                  p.catch(function(err){ console.warn('Audio esplosione bloccato:', err); });
                }
              }
            }
            function triggerExplodeEffect(){
              var el = document.getElementById('exploding');
              if (!el) return;
              // se esiste il listener GSAP, riusa il click
              var hadGsap = !!window.gsap && el.querySelector('span');
              if (hadGsap){
                el.dispatchEvent(new Event('click', {bubbles:true}));
              } else {
                el.classList.add('explode');
                setTimeout(function(){ el.classList.remove('explode'); }, 1200);
              }
            }
            function bind(){
              var btn = document.getElementById('btn-explode');
              if (!btn) return;
              if (btn.__explosionBound) return;
              btn.addEventListener('click', function(){
                playExplosion();
                triggerExplodeEffect();
              });
              btn.__explosionBound = true;
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', bind);
            } else {
              bind();
            }
          })();
      </script>
      <div id="search-results-panel" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:10000;padding:40px;box-sizing:border-box;">
        <div style="max-width:800px;margin:0 auto;background:#0a0a1a;padding:20px;border-radius:8px;border:1px solid #d4af37;max-height:80vh;overflow:auto;position:relative;">
          <button onclick="closeSearchPanel()" style="position:absolute;top:10px;right:10px;background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;">×</button>
          <h2 style="color:#d4af37;margin-top:0;">Risultati della ricerca</h2>
          <div id="internal-search-results"></div>
        </div>
      </div>
      <script>
        // Variabile globale per i dati del sito
          var siteData = [];
          
          // Funzione per caricare i dati del sito
          async function loadSiteData(){
          try{
          const r = await fetch('sitemap.json', {cache:'no-store'});
          if(!r.ok) throw new Error('HTTP '+r.status);
          const ct = r.headers.get('content-type')||'';
          if(!/json/i.test(ct)) throw new Error('Not JSON');
          siteData = await r.json();
          }catch(error){
          console.error("Errore nel caricamento dei dati:", error);
          siteData = siteData && siteData.length ? siteData : [
          {url:"articoli/socrate.html", title:"Socrate", content:"Socrate è stato un filosofo greco antico."},
          {url:"articoli/platone.html", title:"Platone", content:"Platone è stato allievo di Socrate."}
          ];
          }
          },
          {url:"articoli/platone.html",  title:"Platone", content:"Platone è stato allievo di Socrate."}
          ];
          }
          }
          ror("Errore nel caricamento dei dati:", error);
              // Fallback manuale se il JSON non è disponibile
              siteData = [
                {url: "articoli/socrate.html", title: "Socrate", content: "Socrate è stato un filosofo greco antico..."},
                {url: "articoli/platone.html", title: "Platone", content: "Platone è stato allievo di Socrate..."},
                // Aggiungi tutte le pagine del tuo sito qui
              ];
            }
          }
          
          // Funzione di ricerca
          function performSearch(query) {
            if (!query.trim()) return;
            
            const resultsContainer = document.getElementById('internal-search-results');
            resultsContainer.innerHTML = '<p style="color:#fff;">Ricerca in corso...</p>';
            
            // Mostra il pannello
            document.getElementById('search-results-panel').style.display = 'block';
            
            // Simuliamo un ritardo per la ricerca
            setTimeout(() => {
              const searchTerm = query.toLowerCase();
              const results = siteData.filter(item => 
                item.title.toLowerCase().includes(searchTerm) || 
                item.content.toLowerCase().includes(searchTerm)
              );
              
              displayResults(results);
            }, 300);
          }
          
          // Mostra i risultati
          function displayResults(results) {
            const resultsContainer = document.getElementById('internal-search-results');
            
            if (results.length === 0) {
              resultsContainer.innerHTML = '<p style="color:#fff;">Nessun risultato trovato.</p>';
              return;
            }
            
            let html = '<div style="display:grid;gap:15px;">';
            results.forEach(result => {
              html += `
                <div style="background:rgba(20,20,40,0.8);padding:15px;border-radius:6px;border-left:3px solid #d4af37;">
                  <h3 style="margin-top:0;margin-bottom:10px;">
                    <a href="${result.url}" style="color:#9ad0ff;text-decoration:none;">${result.title}</a>
                  </h3>
                  <p style="color:#cfe8ff;margin:0;">${result.content.substring(0,150)}...</p>
                  <a href="${result.url}" style="color:#00ccff;display:inline-block;margin-top:10px;">Leggi tutto →</a>
                </div>
              `;
            });
            html += '</div>';
            
            resultsContainer.innerHTML = html;
          }
          
          // Chiudi il pannello
          function closeSearchPanel() {
            document.getElementById('search-results-panel').style.display = 'none';
          }
          
          // Inizializzazione
          document.addEventListener('DOMContentLoaded', function() {
            // Carica i dati del sito
            loadSiteData();
            
            // Configura la barra di ricerca
            const searchInput = document.getElementById('site-search');
            const searchIcon = document.querySelector('.search-icon');
            
            if (searchInput) {
              searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                  e.preventDefault();
                  performSearch(this.value);
                }
              });
            }
            
            if (searchIcon) {
              searchIcon.addEventListener('click', function(e) {
                e.preventDefault();
                performSearch(searchInput.value);
              });
            }
          });
      </script>
      <!-- Aggiungi questo codice prima della chiusura 
      <!-- === CONSERVATIVE ENTER FIX + siteData (real excerpts) === -->
      <script>
        (function(){
            // 1) Site data (estratti reali dal sito)
            window.siteData = window.siteData || [
              { url: "Presocratici/talete.html", title: "Talete di Mileto", content: "Talete fu una figura poliedrica del pensiero arcaico: matematico, astronomo e politico; la sua dottrina sull’acqua come principio originario ci è nota soprattutto attraverso Aristotele." },
              { url: "Presocratici/anassimandro.html", title: "Anassimandro di Mileto", content: "Pioniere del pensiero scientifico, discepolo di Talete; introdusse l’ápeiron come principio e sviluppò una visione naturale e razionale del cosmo." },
              { url: "Presocratici/anassimene.html", title: "Anassimene di Mileto", content: "Ultimo dei milesi: identificò nell’aria l’archè di tutte le cose, proseguendo la ricerca dei presocratici sulle cause naturali." },
              { url: "Presocratici/senofane.html", title: "Senofane di Colofone", content: "Poeta‑filosofo viandante: critica radicale alla religione tradizionale e fondazione della scuola eleatica." },
              { url: "articoli/ermarco.html", title: "Ermarco di Mitilene", content: "Successore di Epicuro nel Giardino: preservò e diffuse la dottrina epicurea con fedeltà e innovazione, guidando la scuola dopo il 270 a.C." },
              { url: "articoli/seneca.html", title: "Lucio Anneo Seneca", content: "Figura eminente della filosofia romana: stoico, drammaturgo e statista; i suoi scritti mirano alla tranquillità interiore e alla virtù in un’epoca turbolenta." },
              { url: "articoli/eudemo.html", title: "Eudemo di Rodi", content: "Discepolo fedele di Aristotele e membro di spicco della scuola peripatetica; ponte tra l’insegnamento aristotelico e la tradizione successiva." },
              { url: "pagine/benvenuti.html", title: "Presentazione (Incipit)", content: "Echi di Sofia: uno spazio dedicato alla meraviglia e alla saggezza, dove il pensiero antico e moderno risuona oggi attraverso domande che attraversano il tempo." },
              { url: "articoli/tarski.html", title: "Alfred Tarski", content: "Logico e filosofo del linguaggio: teoria semantica della verità (Convenzione T), contributi a logica, geometria e teoria degli insiemi; influenze su filosofia e informatica teorica." },
              { url: "articoli/frege.html", title: "Gottlob Frege", content: "Padre della logica moderna: dal Begriffsschrift alla distinzione senso/riferimento; ha fondato la logica dei predicati e influenzato l’analitica." },
              { url: "articoli/lyotard.html", title: "Jean‑François Lyotard", content: "Teorico del postmoderno: fine delle grandi narrazioni, giochi linguistici, legittimazione performativa del sapere; opere come La condizione postmoderna e Il dissidio." },
              { url: "pagine/pagina-contatti.html", title: "Contatti", content: "Pagina di contatto per domande, suggerimenti e collaborazioni con Echi di Sofia." }
            ];
          
            // 2) ENTER = click sulla lente (nessun cambio layout/animazioni)
            function triggerSearchFrom(el){
              try{
                var input = el && (el.tagName ? el : null);
                var container = input && input.closest && (input.closest('.search-container') || input.closest('.bar-right') || input.closest('.top-bar') || input.closest('form') || document);
                var btn = container && container.querySelector && (container.querySelector('.search-icon') ||
                          container.querySelector('[data-cse-search-btn]') ||
                          container.querySelector('#cse-search-btn') ||
                          container.querySelector('.cse-search-btn') ||
                          container.querySelector('button[type="submit"]'));
                if (btn && typeof btn.click === 'function'){ btn.click(); return true; }
          
                var q = (input && input.value) ? input.value.trim() : '';
                if (typeof submitFromInput === 'function'){ submitFromInput(); return true; }
                if (typeof openGoogleFromInput === 'function'){ openGoogleFromInput(); return true; }
                if (typeof executeQuery === 'function'){ executeQuery(q); return true; }
                document.dispatchEvent(new CustomEvent('perform-site-search', { detail: { query: q } }));
                return false;
              }catch(e){ console.error(e); return false; }
            }
          
            function onEnter(e){
              if (e.key === 'Enter'){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                triggerSearchFrom(e.target);
              }
            }
          
            function bindEnterHandlers(){
              var nodes = Array.from(document.querySelectorAll('#site-search, input[type="search"]'));
              nodes.forEach(function(inp){
                if (!inp.__enterFixBound){
                  inp.addEventListener('keydown', onEnter, true);
                  inp.__enterFixBound = true;
                }
              });
            }
            bindEnterHandlers();
          
            document.addEventListener('submit', function(e){
              try{
                var target = e.target;
                if (target && target.querySelector && target.querySelector('#site-search, input[type="search"]')){
                  e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                  var inp = target.querySelector('#site-search, input[type="search"]');
                  triggerSearchFrom(inp || document.getElementById('site-search'));
                }
              }catch(_ ){}
            }, true);
          
            var mo = new MutationObserver(function(){ bindEnterHandlers(); });
            mo.observe(document.documentElement, { childList: true, subtree: true });
          })();
      </script>
      <!-- === SEARCH: stable clear icon (no duplicates) === -->
      <script>
        (function(){
            function ensureClearFor(input){
              if (!input) return;
              var wrap = (input.closest && input.closest('.search-container')) || input.parentElement;
              if (!wrap) return;
              // evita duplicati: se esiste già, riusa
              var btn = wrap.querySelector('.clear-icon');
              if (!btn){
                btn = document.createElement('span');
                btn.className = 'clear-icon';
                btn.setAttribute('role','button');
                btn.setAttribute('aria-label','Pulisci ricerca');
                btn.title = 'Pulisci';
                btn.textContent = '✖';
                wrap.appendChild(btn);
              }
              if (!btn.__bound){
                btn.addEventListener('click', function(){
                  input.value = '';
                  input.focus();
                  // notifica eventuali listener
                  input.dispatchEvent(new Event('input', { bubbles: true }));
                  input.dispatchEvent(new Event('change', { bubbles: true }));
                });
                btn.__bound = true;
              }
            }
            function initAll(){
              document.querySelectorAll('.search-container input[type="search"], .search-container input[type="text"], #site-search')
                .forEach(ensureClearFor);
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', initAll, { once:true });
            } else {
              initAll();
            }
            new MutationObserver(initAll).observe(document.documentElement, { childList:true, subtree:true });
          })();
      </script>
      </audio>
      <script>
        (function(){
            function playExplosion(){
              var boom = document.getElementById('explosionSound');
              if (boom){
                try{ boom.currentTime = 0; }catch(e){}
                var p = boom.play();
                if (p && typeof p.catch === 'function'){
                  p.catch(function(err){ console.warn('Audio esplosione bloccato:', err); });
                }
              }
            }
            function triggerExplodeEffect(){
              var el = document.getElementById('exploding');
              if (!el) return;
              // se esiste il listener GSAP, riusa il click
              var hadGsap = !!window.gsap && el.querySelector('span');
              if (hadGsap){
                el.dispatchEvent(new Event('click', {bubbles:true}));
              } else {
                el.classList.add('explode');
                setTimeout(function(){ el.classList.remove('explode'); }, 1200);
              }
            }
            function bind(){
              var btn = document.getElementById('btn-explode');
              if (!btn) return;
              if (btn.__explosionBound) return;
              btn.addEventListener('click', function(){
                playExplosion();
                triggerExplodeEffect();
              });
              btn.__explosionBound = true;
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', bind);
            } else {
              bind();
            }
          })();
      </script>
      <div id="search-results-panel" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:10000;padding:40px;box-sizing:border-box;backdrop-filter:blur(5px);">
        <div style="max-width:800px;margin:0 auto;background:#0a0a1a;padding:25px;border-radius:12px;border:1px solid #d4af37;max-height:80vh;overflow:auto;position:relative;box-shadow:0 0 20px rgba(0,0,0,0.5);">
          <button onclick="closeSearchPanel()" onmouseout="this.style.transform='scale(1)'" onmouseover="this.style.transform='scale(1.2)'" style="position:absolute;top:15px;right:15px;background:none;border:none;color:#fff;font-size:1.8rem;cursor:pointer;transition:transform 0.2s;">×</button>
          <h2 style="color:#d4af37;margin-top:0;font-family:'Cinzel',serif;border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:10px;">Risultati della ricerca</h2>
          <div id="internal-search-results" style="margin-top:20px;"></div>
        </div>
      </div>
      <script>
        // Configurazione
          const SEARCH_DELAY = 300; // ms tra una ricerca e l'altra
          const MAX_RESULTS = 50;   // Numero massimo di risultati
          const MIN_QUERY_LENGTH = 3; // Lunghezza minima della query
          
          // Stato dell'applicazione
          let searchIndex = [];
          let searchTimeout = null;
          
          // Funzione per indicizzare le pagine
          async function buildSearchIndex() {
            console.log("Costruzione indice di ricerca...");
            
            // Ottieni la lista delle pagine dal menu
            const menuLinks = Array.from(document.querySelectorAll('.mega-menu a[href]'));
            const uniqueUrls = [...new Set(menuLinks.map(link => link.href))];
            
            // Per ogni URL, estrai il titolo e il contenuto
            for (const url of uniqueUrls) {
              try {
                // Evita di indicizzare pagine esterne
                if (!url.includes(window.location.hostname) && !url.startsWith('/') && !url.startsWith('.')) {
                  continue;
                }
                
                const response = await fetch(url);
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                
                const title = doc.querySelector('h1')?.textContent || 
                             doc.querySelector('title')?.textContent || 
                             url.split('/').pop().replace('.html', '');
                
                // Estrai il contenuto principale (escludi menu, footer, etc.)
                let content = '';
                const mainContent = doc.querySelector('main') || 
                                   doc.querySelector('article') || 
                                   doc.querySelector('.content') || 
                                   doc.body;
                
                // Seleziona solo i paragrafi e gli heading
                const textElements = mainContent.querySelectorAll('p, h2, h3, h4');
                textElements.forEach(el => {
                  content += ' ' + el.textContent;
                });
                
                searchIndex.push({
                  url,
                  title: title.trim(),
                  content: content.replace(/\s+/g, ' ').trim()
                });
                
              } catch (error) {
                console.warn(`Errore nell'indicizzazione di ${url}:`, error);
              }
            }
            
            console.log("Indice costruito con", searchIndex.length, "pagine");
          }
          
          // Funzione di ricerca
          function performSearch(query) {
            query = query.trim().toLowerCase();
            
            if (query.length < MIN_QUERY_LENGTH) {
              showMessage(`Inserisci almeno ${MIN_QUERY_LENGTH} caratteri`);
              return;
            }
            
            showMessage("Ricerca in corso...");
            
            // Dividi la query in termini separati
            const terms = query.split(/\s+/).filter(term => term.length >= 2);
            
            if (terms.length === 0) {
              showMessage(`Inserisci almeno ${MIN_QUERY_LENGTH} caratteri validi`);
              return;
            }
            
            // Cerca nei titoli e nel contenuto
            const results = searchIndex.map(page => {
              let score = 0;
              let matches = [];
              
              terms.forEach(term => {
                // Punteggio più alto per le corrispondenze nel titolo
                const titleMatch = page.title.toLowerCase().includes(term);
                if (titleMatch) score += 5;
                
                // Punteggio per corrispondenze nel contenuto
                const contentMatch = page.content.toLowerCase().includes(term);
                if (contentMatch) score += 1;
                
                if (titleMatch || contentMatch) {
                  matches.push(term);
                }
              });
              
              return { ...page, score, matches };
            })
            .filter(page => page.score > 0)
            .sort((a, b) => b.score - a.score)
            .slice(0, MAX_RESULTS);
            
            displayResults(results, query);
          }
          
          // Mostra i risultati
          function displayResults(results, query) {
            const resultsContainer = document.getElementById('internal-search-results');
            
            if (results.length === 0) {
              resultsContainer.innerHTML = `
                <div style="text-align:center;padding:40px 0;">
                  <p style="color:#cfe8ff;font-size:1.1rem;">Nessun risultato trovato per "${query}"</p>
                  <p style="color:#9ad0ff;">Prova con termini diversi o più specifici</p>
                </div>
              `;
              return;
            }
            
            let html = `
              <div style="margin-bottom:15px;">
                <p style="color:#9ad0ff;margin:0;">Trovati ${results.length} risultati per "${query}"</p>
              </div>
              <div style="display:grid;gap:20px;">
            `;
            
            results.forEach(result => {
              // Evidenzia i termini corrispondenti nel titolo
              let highlightedTitle = result.title;
              result.matches.forEach(term => {
                const regex = new RegExp(term, 'gi');
                highlightedTitle = highlightedTitle.replace(regex, match => 
                  `<span style="background-color:rgba(255,215,0,0.3);color:#ffd700;">${match}</span>`
                );
              });
              
              // Trova un estratto del contenuto con i termini corrispondenti
              let snippet = '';
              const contentLower = result.content.toLowerCase();
              
              // Cerca la prima occorrenza di qualsiasi termine
              for (const term of result.matches) {
                const pos = contentLower.indexOf(term);
                if (pos > -1) {
                  const start = Math.max(0, pos - 50);
                  const end = Math.min(result.content.length, pos + term.length + 100);
                  snippet = result.content.substring(start, end);
                  
                  // Evidenzia i termini nell'estratto
                  result.matches.forEach(t => {
                    const regex = new RegExp(t, 'gi');
                    snippet = snippet.replace(regex, match => 
                      `<span style="background-color:rgba(255,215,0,0.3);color:#ffd700;">${match}</span>`
                    );
                  });
                  
                  if (start > 0) snippet = '...' + snippet;
                  if (end < result.content.length) snippet += '...';
                  break;
                }
              }
              
              // Se non troviamo corrispondenze nel contenuto, usa l'inizio
              if (!snippet) {
                snippet = result.content.substring(0, 150);
                if (result.content.length > 150) snippet += '...';
              }
              
              html += `
                <div style="background:rgba(20,20,40,0.8);padding:20px;border-radius:8px;border-left:3px solid #d4af37;transition:transform 0.2s, box-shadow 0.2s;" 
                     onmouseover="this.style.transform='translateX(5px)';this.style.boxShadow='0 5px 15px rgba(0,0,0,0.3)'" 
                     onmouseout="this.style.transform='';this.style.boxShadow=''">
                  <h3 style="margin-top:0;margin-bottom:12px;font-size:1.2rem;">
                    <a href="${result.url}" style="color:#9ad0ff;text-decoration:none;">${highlightedTitle}</a>
                  </h3>
                  <p style="color:#cfe8ff;margin:0 0 10px 0;line-height:1.5;">${snippet}</p>
                  <a href="${result.url}" style="color:#00ccff;display:inline-flex;align-items:center;gap:5px;text-decoration:none;">
                    <span>Vai alla pagina</span>
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                  </a>
                </div>
              `;
            });
            
            html += `</div>`;
            resultsContainer.innerHTML = html;
          }
          
          // Mostra un messaggio nel pannello
          function showMessage(msg) {
            document.getElementById('internal-search-results').innerHTML = `
              <div style="text-align:center;padding:40px 0;color:#cfe8ff;">
                <p>${msg}</p>
              </div>
            `;
          }
          
          // Chiudi il pannello
          function closeSearchPanel() {
            document.getElementById('search-results-panel').style.display = 'none';
          }
          
          // Gestione degli eventi
          function setupSearchEvents() {
            const searchInput = document.getElementById('site-search');
            const searchIcon = document.querySelector('.search-icon');
            
            if (!searchInput) return;
            
            // Ricerca quando si preme Invio
            searchInput.addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('search-results-panel').style.display = 'block';
                clearTimeout(searchTimeout);
                performSearch(this.value);
              }
            });
            
            // Ricerca quando si clicca l'icona
            if (searchIcon) {
              searchIcon.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('search-results-panel').style.display = 'block';
                clearTimeout(searchTimeout);
                performSearch(searchInput.value);
              });
            }
            
            // Ricerca durante la digitazione (con debounce)
            searchInput.addEventListener('input', function() {
              clearTimeout(searchTimeout);
              if (this.value.trim().length >= MIN_QUERY_LENGTH) {
                searchTimeout = setTimeout(() => {
                  document.getElementById('search-results-panel').style.display = 'block';
                  performSearch(this.value);
                }, SEARCH_DELAY);
              }
            });
          }
          
          // Inizializzazione
          document.addEventListener('DOMContentLoaded', function() {
            // Costruisci l'indice dopo il caricamento della pagina
            setTimeout(buildSearchIndex, 1000);
            
            // Configura gli eventi di ricerca
            setupSearchEvents();
          });
          
          // Chiudi il pannello quando si clicca all'esterno
          document.getElementById('search-results-panel')?.addEventListener('click', function(e) {
            if (e.target === this) {
              closeSearchPanel();
            }
          });
      </script>
      <!-- === CONSERVATIVE ENTER FIX + siteData (real excerpts) === -->
      <script>
        (function(){
            // 1) Site data (estratti reali dal sito)
            window.siteData = window.siteData || [
              { url: "Presocratici/talete.html", title: "Talete di Mileto", content: "Talete fu una figura poliedrica del pensiero arcaico: matematico, astronomo e politico; la sua dottrina sull’acqua come principio originario ci è nota soprattutto attraverso Aristotele." },
              { url: "Presocratici/anassimandro.html", title: "Anassimandro di Mileto", content: "Pioniere del pensiero scientifico, discepolo di Talete; introdusse l’ápeiron come principio e sviluppò una visione naturale e razionale del cosmo." },
              { url: "Presocratici/anassimene.html", title: "Anassimene di Mileto", content: "Ultimo dei milesi: identificò nell’aria l’archè di tutte le cose, proseguendo la ricerca dei presocratici sulle cause naturali." },
              { url: "Presocratici/senofane.html", title: "Senofane di Colofone", content: "Poeta‑filosofo viandante: critica radicale alla religione tradizionale e fondazione della scuola eleatica." },
              { url: "articoli/ermarco.html", title: "Ermarco di Mitilene", content: "Successore di Epicuro nel Giardino: preservò e diffuse la dottrina epicurea con fedeltà e innovazione, guidando la scuola dopo il 270 a.C." },
              { url: "articoli/seneca.html", title: "Lucio Anneo Seneca", content: "Figura eminente della filosofia romana: stoico, drammaturgo e statista; i suoi scritti mirano alla tranquillità interiore e alla virtù in un’epoca turbolenta." },
              { url: "articoli/eudemo.html", title: "Eudemo di Rodi", content: "Discepolo fedele di Aristotele e membro di spicco della scuola peripatetica; ponte tra l’insegnamento aristotelico e la tradizione successiva." },
              { url: "pagine/benvenuti.html", title: "Presentazione (Incipit)", content: "Echi di Sofia: uno spazio dedicato alla meraviglia e alla saggezza, dove il pensiero antico e moderno risuona oggi attraverso domande che attraversano il tempo." },
              { url: "articoli/tarski.html", title: "Alfred Tarski", content: "Logico e filosofo del linguaggio: teoria semantica della verità (Convenzione T), contributi a logica, geometria e teoria degli insiemi; influenze su filosofia e informatica teorica." },
              { url: "articoli/frege.html", title: "Gottlob Frege", content: "Padre della logica moderna: dal Begriffsschrift alla distinzione senso/riferimento; ha fondato la logica dei predicati e influenzato l’analitica." },
              { url: "articoli/lyotard.html", title: "Jean‑François Lyotard", content: "Teorico del postmoderno: fine delle grandi narrazioni, giochi linguistici, legittimazione performativa del sapere; opere come La condizione postmoderna e Il dissidio." },
              { url: "pagine/pagina-contatti.html", title: "Contatti", content: "Pagina di contatto per domande, suggerimenti e collaborazioni con Echi di Sofia." }
            ];
          
            // 2) ENTER = click sulla lente (nessun cambio layout/animazioni)
            function triggerSearchFrom(el){
              try{
                var input = el && (el.tagName ? el : null);
                var container = input && input.closest && (input.closest('.search-container') || input.closest('.bar-right') || input.closest('.top-bar') || input.closest('form') || document);
                var btn = container && container.querySelector && (container.querySelector('.search-icon') ||
                          container.querySelector('[data-cse-search-btn]') ||
                          container.querySelector('#cse-search-btn') ||
                          container.querySelector('.cse-search-btn') ||
                          container.querySelector('button[type="submit"]'));
                if (btn && typeof btn.click === 'function'){ btn.click(); return true; }
          
                var q = (input && input.value) ? input.value.trim() : '';
                if (typeof submitFromInput === 'function'){ submitFromInput(); return true; }
                if (typeof openGoogleFromInput === 'function'){ openGoogleFromInput(); return true; }
                if (typeof executeQuery === 'function'){ executeQuery(q); return true; }
                document.dispatchEvent(new CustomEvent('perform-site-search', { detail: { query: q } }));
                return false;
              }catch(e){ console.error(e); return false; }
            }
          
            function onEnter(e){
              if (e.key === 'Enter'){
                e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                triggerSearchFrom(e.target);
              }
            }
          
            function bindEnterHandlers(){
              var nodes = Array.from(document.querySelectorAll('#site-search, input[type="search"]'));
              nodes.forEach(function(inp){
                if (!inp.__enterFixBound){
                  inp.addEventListener('keydown', onEnter, true);
                  inp.__enterFixBound = true;
                }
              });
            }
            bindEnterHandlers();
          
            document.addEventListener('submit', function(e){
              try{
                var target = e.target;
                if (target && target.querySelector && target.querySelector('#site-search, input[type="search"]')){
                  e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
                  var inp = target.querySelector('#site-search, input[type="search"]');
                  triggerSearchFrom(inp || document.getElementById('site-search'));
                }
              }catch(_ ){}
            }, true);
          
            var mo = new MutationObserver(function(){ bindEnterHandlers(); });
            mo.observe(document.documentElement, { childList: true, subtree: true });
          })();
      </script>
      <!-- === SEARCH: stable clear icon (no duplicates) === -->
      <script>
        (function(){
            function ensureClearFor(input){
              if (!input) return;
              var wrap = (input.closest && input.closest('.search-container')) || input.parentElement;
              if (!wrap) return;
              // evita duplicati: se esiste già, riusa
              var btn = wrap.querySelector('.clear-icon');
              if (!btn){
                btn = document.createElement('span');
                btn.className = 'clear-icon';
                btn.setAttribute('role','button');
                btn.setAttribute('aria-label','Pulisci ricerca');
                btn.title = 'Pulisci';
                btn.textContent = '✖';
                wrap.appendChild(btn);
              }
              if (!btn.__bound){
                btn.addEventListener('click', function(){
                  input.value = '';
                  input.focus();
                  // notifica eventuali listener
                  input.dispatchEvent(new Event('input', { bubbles: true }));
                  input.dispatchEvent(new Event('change', { bubbles: true }));
                });
                btn.__bound = true;
              }
            }
            function initAll(){
              document.querySelectorAll('.search-container input[type="search"], .search-container input[type="text"], #site-search')
                .forEach(ensureClearFor);
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', initAll, { once:true });
            } else {
              initAll();
            }
            new MutationObserver(initAll).observe(document.documentElement, { childList:true, subtree:true });
          })();
      </script>
      <script>
        (function(){
            ['btn-thunder','btn-explode'].forEach(id=>{
              const nodes = Array.from(document.querySelectorAll('#'+id));
              nodes.slice(1).forEach(n => n.remove()); // lascia solo il primo
            });
          })();
      </script>
      </audio>
      <script>
        (function(){
            function playExplosion(){
              var boom = document.getElementById('explosionSound');
              if (boom){
                try{ boom.currentTime = 0; }catch(e){}
                var p = boom.play();
                if (p && typeof p.catch === 'function'){
                  p.catch(function(err){ console.warn('Audio esplosione bloccato:', err); });
                }
              }
            }
            function triggerExplodeEffect(){
              var el = document.getElementById('exploding');
              if (!el) return;
              // se esiste il listener GSAP, riusa il click
              var hadGsap = !!window.gsap && el.querySelector('span');
              if (hadGsap){
                el.dispatchEvent(new Event('click', {bubbles:true}));
              } else {
                el.classList.add('explode');
                setTimeout(function(){ el.classList.remove('explode'); }, 1200);
              }
            }
            function bind(){
              var btn = document.getElementById('btn-explode');
              if (!btn) return;
              if (btn.__explosionBound) return;
              btn.addEventListener('click', function(){
                playExplosion();
                triggerExplodeEffect();
              });
              btn.__explosionBound = true;
            }
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', bind);
            } else {
              bind();
            }
          })();
      </script>
      <script>
        (function(){
            const $ = (s, r=document) => r.querySelector(s);
            const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
            const norm = s => (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ').trim();
            const safe = s => String(s||'').replace(/[&<>]/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]));
          
            const input = $('#site-search') || $('.search-container input[type="search"], .search-container input[type="text"]');
            if(!input) return;
          
            let box = $('#cse-suggest');
            if(!box){
              box = document.createElement('div');
              box.id = 'cse-suggest';
              document.body.appendChild(box);
            }
          
            function positionBox(){
              const r = input.getBoundingClientRect();
              const left = Math.max(8, Math.min(r.left, window.innerWidth - 8));
              const top  = Math.max(8, r.bottom + 6);
              const width = Math.min(r.width, window.innerWidth - left - 8);
              box.style.left = left + 'px';
              box.style.top = top + 'px';
              box.style.width = width + 'px';
              box.style.maxWidth = Math.min(960, window.innerWidth - 16) + 'px';
            }
            function show(){ positionBox(); box.classList.add('show'); }
            function hide(){ box.classList.remove('show'); }
          
            function collectMenu(){
              const out = [];
              $$('nav.menu-desktop a').forEach(a => {
                const href = a.getAttribute('href') || '';
                const title = (a.getAttribute('data-title') || a.textContent || '').trim();
                if(!href || !title) return;
                if(/^https?:\/\//i.test(href)) return;
                if(!/\.html?(\?|#|$)/i.test(href) && !/^\w+(\/|$)/.test(href)) return;
                out.push({ title, href, key: norm(title) });
              });
              return out;
            }
            function collectBlob(){
              const out = [];
              $$('.articles-blob a').forEach(a => {
                const href = a.getAttribute('href') || '';
                const title = (a.getAttribute('data-title') || a.textContent || '').trim();
                if(href && title) out.push({ title, href, key: norm(title) });
              });
              return out;
            }
          
          // --- ESTENSIONE: consenti di includere link ovunque con data-search="include" ---
          function collectMarked(){
            const out = [];
            document.querySelectorAll('a[data-search="include"], a[data-search="1"], a[data-search="true"]').forEach(a=>{
              const href = a.getAttribute('href') || '';
              const title = (a.getAttribute('data-title') || a.textContent || '').trim();
              if(!href || !title) return;
              if(/^https?:\/\//i.test(href)) return; // solo interni
              if(!/\.html?(\?|#|$)/i.test(href) && !/^\w+(\/|$)/.test(href)) return;
              out.push({ title, href, key: norm(title) });
            });
            return out;
          }
          
          
            let INDEX = [];
            function rebuildIndex(){
              const A = collectBlob();
              const B = collectMenu();
              const C = collectMarked();
              const seen = new Set();
              INDEX = [];
              [...A, ...B, ...C].forEach(it => {
                const k = it.href + '||' + it.title;
                if(seen.has(k)) return; seen.add(k);
                INDEX.push(it);
              });
              window._siteIndex = INDEX;
            }
            rebuildIndex();
            window.addEventListener('load', () => setTimeout(rebuildIndex, 400));
          
            function renderList(list, q){
              if(!list || !list.length){ hide(); return; }
              const qn = norm(q);
              box.innerHTML = '';
              const head = document.createElement('div');
              head.className = 'section';
              head.textContent = 'Risultati rapidi';
              box.appendChild(head);
          
              list.slice(0, 14).forEach((it, i) => {
                const a = document.createElement('a');
                a.className = 'item';
                a.href = it.href;
                a.target = '_self';
                const t = it.title;
                let html = '<i class="fa-solid fa-file-lines" aria-hidden="true"></i>';
                const nt = norm(t); const ix = qn ? nt.indexOf(qn) : -1;
                if(ix >= 0){
                  const a1 = t.slice(0, ix), a2 = t.slice(ix, ix + q.length), a3 = t.slice(ix + q.length);
                  html += '<span>'+ safe(a1) + '<mark>' + safe(a2) + '</mark>' + safe(a3) + '</span>';
                }else{
                  html += '<span>'+ safe(t) + '</span>';
                }
                a.innerHTML = html;
                box.appendChild(a);
              });
              show();
            }
          
            let t = 0;
            input.addEventListener('input', function(){
              const q = input.value || '';
              if(q.trim().length < 2){ hide(); return; }
              clearTimeout(t);
              t = setTimeout(function(){
                const qn = norm(q);
                const list = INDEX.filter(it => it.key.includes(qn));
                renderList(list, q);
              }, 80);
            });
          
            input.addEventListener('keydown', function(e){
              if(e.key === 'Escape'){ hide(); }
            });
          
            document.addEventListener('mousedown', function(e){
              if(e.target.closest('#cse-suggest')) return;
              if(e.target.closest('.search-container')) return;
              hide();
            }, true);
          
            window.addEventListener('scroll', ()=>{ if(box.classList.contains('show')) positionBox(); }, true);
            window.addEventListener('resize', ()=>{ if(box.classList.contains('show')) positionBox(); });
          })();
      </script>
      <script data-explode-guard="">
        (function(){
            function guardHeight(el, dur){
              try{
                if(!el) return;
                var r = el.getBoundingClientRect();
                el.style.minHeight = Math.ceil(r.height) + 'px';
                setTimeout(function(){ el.style.minHeight = ''; }, (dur||1200)+120);
              }catch(e){}
            }
            var et = document.querySelector('.exploding-text');
            var btn = document.getElementById('btn-explode') || document.getElementById('explode-btn');
            if(btn && et){
              btn.addEventListener('click', function(){ guardHeight(et, 1200); }, {passive:true});
            }
            if(et){
              et.addEventListener('click', function(){ guardHeight(et, 1200); }, {passive:true});
            }
          })();
      </script>
      <script>
        (function(){
            const audio = document.getElementById('thunder-sound');
            if (audio){
              if (typeof window.__thOn === 'undefined') window.__thOn = false;
              window.toggleThunder = function(){
                window.__thOn = !window.__thOn;
                if (window.__thOn){
                  try{ audio.currentTime = 0; audio.play().catch(()=>{});}catch(e){}
                }else{
                  try{ audio.pause(); audio.currentTime = 0; }catch(e){}
                }
                const b=document.getElementById('btn-thunder');
                if (b){
                  b.classList.toggle('active', window.__thOn);
                  b.setAttribute('aria-pressed', window.__thOn ? 'true':'false');
                  b.textContent = window.__thOn ? '⚡ Tuono: ON' : '⚡ Tuono';
                }
              };
            }
          })();
      </script>
      <script>
        document.addEventListener('DOMContentLoaded', function(){
            var b = document.getElementById('btn-thunder');
            if (b && !b.__thunderBound){
              b.addEventListener('click', function(e){
                try { window.toggleThunder && window.toggleThunder(); } catch (err) { console.error('toggleThunder error', err); }
              });
              b.__thunderBound = true;
            }
          });
      </script>
      <script>
        (function(){
            // Costruttori URL per le varie fonti
            const build = {
              sep:          q => 'https://plato.stanford.edu/search/searcher.py?query=' + encodeURIComponent(q),
              iep:          q => 'https://iep.utm.edu/?s=' + encodeURIComponent(q),
              treccani:     q => 'https://www.treccani.it/enciclopedia/ricerca/' + encodeURIComponent(q) + '/',
              philosophica: q => 'https://www.philosophica.info/?s=' + encodeURIComponent(q),
              'wiki-it':    q => 'https://it.wikipedia.org/w/index.php?search=' + encodeURIComponent(q)
            };
          
            function mountWidget(){
              // prova a collocarlo sopra al primo iframe della sidebar/destra
              const root = document.getElementById('edx-dict');
              if(!root) return;
              const candidates = ['aside iframe', '.articles-blob ~ iframe', '.sidebar iframe', '#sidebar iframe', '.col-dx iframe', '.right iframe'];
              for(const sel of candidates){
                const el = document.querySelector(sel);
                if(el && el.parentElement && !el.previousElementSibling?.isSameNode(root)){
                  el.parentElement.insertAdjacentElement('beforebegin', root);
                  break;
                }
              }
              // se per errore è dentro l'header, spostalo subito dopo
              const hdr = document.querySelector('header'); 
              if(hdr && hdr.contains(root)){ hdr.insertAdjacentElement('afterend', root); }
            }
          
            function wireForm(){
              const form = document.getElementById('edx-dict-form');
              const sel  = document.getElementById('edx-source');
              const input= document.getElementById('edx-q');
              if(!form || !sel || !input) return;
              // intercetta prima degli script globali del sito
              form.addEventListener('submit', function(e){
                e.preventDefault(); e.stopPropagation(); if(e.stopImmediatePropagation) e.stopImmediatePropagation();
                const q = (input.value||'').trim(); if(!q) return;
                const src = sel.value || 'sep';
                const url = (build[src] || build.sep)(q);
                window.open(url, '_blank', 'noopener');
                return false;
              }, true);
            }
          
            if(document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', function(){ mountWidget(); wireForm(); });
            }else{
              mountWidget(); wireForm();
            }
          })();
      </script>
      <script>
        // === SLIDER VERTICALE CON CONTROLLI — FIX FOTO VISIBILI (start PAUSA, senza wrap) ===
          (function(){
            const slider = document.querySelector('.slider-vertical');
            const inner  = document.querySelector('.slider-vertical .slider-inner');
            if (!slider || !inner) return;
          
            let pos = 0;          // in alto → foto visibili
            let speed = 20;       // px/sec
            let dir = 1;          // 1 = su, -1 = giù
            let paused = true;    // PARTENZA IN PAUSA (foto ben visibili)
            let last = null;
          
            function loop(ts){
              if(last == null) last = ts;
              const dt = (ts - last)/1000;
              last = ts;
          
              if(!paused){
                const contentH = inner.scrollHeight;
                const viewH    = slider.clientHeight;
                const maxScroll = Math.max(0, contentH - viewH);
          
                // aggiorna posizione
                pos -= dir * speed * dt;
          
                // limiti duri: no wrap, mai fuori
                if(pos < -maxScroll) pos = -maxScroll;
                if(pos > 0) pos = 0;
              }
          
              inner.style.transform = `translateY(${pos}px)`;
              requestAnimationFrame(loop);
            }
            requestAnimationFrame(loop);
          
            // Controlli
            const btnToggle = document.getElementById('slider-toggle');
            const btnInvert = document.getElementById('slider-invert');
            const range     = document.getElementById('slider-speed');
          
            if(btnToggle){
              // Testo iniziale coerente con partenza in pausa
              btnToggle.textContent = '▶️ Avvia';
              btnToggle.addEventListener('click', () => {
                paused = !paused;
                btnToggle.textContent = paused ? '▶️ Avvia' : '⏸️ Ferma';
              });
            }
          
            if(btnInvert){
              btnInvert.addEventListener('click', () => { dir *= -1; });
            }
          
            if(range){
              const mapSpeed = v => {
                const maxSteps = (range && range.max ? Number(range.max) : 20) - 1;
                const t = Math.max(0, Math.min(1, (Number(v) - 1) / Math.max(1, maxSteps)));
                const eased = Math.pow(t, 1.5); // crescita ancora più dolce (1.5)
                return Math.round(12 + (180 - 12) * eased); // 1–max → 12–180 px/s
              };
              // init
              speed = mapSpeed(+range.value || 8);
              speed = Math.min(speed, 180);
              range.addEventListener('input', e => {
                speed = mapSpeed(+e.target.value || 8);
                          speed = Math.min(speed, 180);
          });
            }
          })();
      </script>
      <script>
        (function(){
            if (typeof window.thunderOn === 'undefined') window.thunderOn = false;
            if (typeof window.updateLabel !== 'function') {
              window.updateLabel = function(){
                var btn = document.getElementById('btn-thunder');
                if (!btn) return;
                btn.classList.toggle('active', !!window.thunderOn);
                btn.setAttribute('aria-pressed', window.thunderOn ? 'true' : 'false');
                btn.textContent = window.thunderOn ? '⚡ Tuono: ON' : '⚡ Tuono';
              };
            }
            var audio = document.getElementById('thunder-sound');
            if (audio){
              try { audio.preload = 'auto'; audio.setAttribute('playsinline',''); audio.crossOrigin = audio.crossOrigin || 'anonymous'; } catch(e){}
              audio.addEventListener('error', function(){
                console.warn('Thunder audio non disponibile (403/CORS). Disattivo tuono.');
                window.thunderOn = false; window.updateLabel && window.updateLabel();
              });
              window.playThunderIfOn = window.playThunderIfOn || function(){
                if (window.thunderOn && audio) {
                  try { audio.currentTime = 0; audio.play().catch(function(){}); } catch(e){}
                }
              };
            }
            try { window.updateLabel(); } catch(e){}
          })();
      </script>
      <script>
        (function(){
            // Trova il controllo velocità: usa l’ID che hai già (#speed-range)
            var r = document.querySelector('#speed-range');
            if(!r) return;
          
            // Se è già wrappato, non fare nulla
            if (r.closest('.range-ui-speed')) return;
          
            // Crea wrapper e “binario” finto
            var wrap  = document.createElement('div');
            wrap.className = 'range-ui-speed';
            // Mantieni la larghezza attuale del tuo input
            var w = getComputedStyle(r).width;
            if (w && w !== 'auto') wrap.style.width = w;
          
            var track = document.createElement('div');
            track.className = 'speed-track';
          
            // Inserisci nel DOM: wrapper → input + track
            r.parentNode.insertBefore(wrap, r);
            wrap.appendChild(r);
            wrap.appendChild(track);
          
            // Aggiorna larghezza al resize (responsive)
            window.addEventListener('resize', function(){
              var ww = getComputedStyle(r).width;
              if (ww && ww !== 'auto') wrap.style.width = ww;
            }, { passive:true });
          })();
      </script>
      <script>
        (function CSEClean(){
            const $panel   = document.getElementById('searchPanel');
            const $results = document.getElementById('cseResults');
            const $input   = document.getElementById('cse-input');
            const $btn     = document.getElementById('cse-btn');
            if (!$results) return;
            function openPanel(){
              if ($panel){ $panel.setAttribute('aria-hidden','false'); $panel.style.display='block'; }
            }
            function closePanel(){
              if ($panel){ $panel.setAttribute('aria-hidden','true'); $panel.style.display='none'; }
            }
            window.execQuery = function(q){
              if (!q) return; openPanel();
              try {
                let tries = 0;
                (function waitCSE(){
                  try {
                    if (window.google && google.search && google.search.cse && google.search.cse.element){
                      const el = google.search.cse.element.getElement('cseResults');
                      if (el && typeof el.execute==='function'){ el.execute(q); return; }
                    }
                  } catch(e){}
                  if (++tries < 100) setTimeout(waitCSE, 80);
                })();
              } catch(e){ console.error('CSE exec error:', e); }
            };
            if ($input){
              $input.addEventListener('keydown',(ev)=>{
                if (ev.key==='Enter'){ ev.preventDefault(); window.execQuery($input.value.trim()); }
              });
            }
            if ($btn){ $btn.addEventListener('click', ()=>{ if ($input) window.execQuery($input.value.trim()); }); }
            document.addEventListener('keydown',(ev)=>{ if (ev.key==='Escape') closePanel(); });
          })();
      </script>
      <script>
        (function AudioManager(){
            const thunderSrc   = '/suoni/thunder-sound.mp3';
            const explosionSrc = '/suoni/explosion-1.mp3';
            function ensureAudio(id, src){
              let el = document.getElementById(id);
              if (!el){
                el = document.createElement('audio');
                el.id = id; el.preload='auto'; el.crossOrigin='anonymous';
                document.body.appendChild(el);
              }
              if (!el.src) el.src = src;
              return el;
            }
            const thunder   = ensureAudio('thunder-audio', thunderSrc);
            const explosion = ensureAudio('explosionSound', explosionSrc);
            (function aliasExplode(){
              if (!document.getElementById('explosionSound')){
                const clone = explosion.cloneNode(); clone.id='explosionSound'; document.body.appendChild(clone);
              }
            })();
            let unlocked=false;
            function unlockOnce(){
              if (unlocked) return; unlocked=true;
              [thunder, explosion].forEach(a=>{ try{ a.play().then(()=>a.pause()).catch(()=>{});}catch(_){}});
              window.removeEventListener('pointerdown', unlockOnce, {passive:true});
              window.removeEventListener('keydown',     unlockOnce);
            }
            window.addEventListener('pointerdown', unlockOnce, {passive:true});
            window.addEventListener('keydown',     unlockOnce);
            window.setThunderOn = function(on){
              try{ if(on){ thunder.currentTime=0; thunder.play(); } else { thunder.pause(); } }catch(e){}
            };
            window.playExplosion = function(){
              try{ explosion.currentTime=0; explosion.play().catch(()=>{});}catch(e){}
            };
          })();
      </script>
      <script id="lazy-images-setup">
        document.addEventListener('DOMContentLoaded', function(){
            if (document.documentElement.dataset.lazy !== 'on') return;
            var imgs = document.querySelectorAll('img:not([data-priority])');
            imgs.forEach(function(img){
              if (img.closest('.top-bar')) return;
              if (!img.hasAttribute('loading') || img.getAttribute('loading') === 'auto'){
                img.setAttribute('loading','lazy');
              }
            });
          });
      </script>
      <script id="search-suggestions">
        (function(){
            if (document.documentElement.dataset.searchSuggest !== 'on') return;
          
            function debounce(fn, wait){
              var t; return function(){ clearTimeout(t); var a=arguments; t=setTimeout(function(){ fn.apply(null,a); }, wait); };
            }
            function ensureContainer(){
              var el = document.getElementById('search-suggest-box');
              if (!el){
                el = document.createElement('div');
                el.id = 'search-suggest-box';
                document.body.appendChild(el);
              }
              return el;
            }
            function showSuggestions(){
              var input = document.getElementById('site-search') || document.querySelector('.search-container input');
              if(!input) return;
              var q = input.value.trim();
              var box = ensureContainer();
              if (!q){ box.classList.remove('show'); box.innerHTML=''; return; }
              // demo locale (sostituibile con endpoint)
              var seed = ['Platone','Aristotele','Kant','Nietzsche','Hegel','Descartes','Fenomenologia','Etica','Metafisica','Logica'];
              var list = seed.filter(function(s){ return s.toLowerCase().includes(q.toLowerCase()); }).slice(0,7);
              if (!list.length){ box.classList.remove('show'); box.innerHTML=''; return; }
              var rect = input.getBoundingClientRect();
              box.style.left = Math.round(rect.left + window.scrollX) + 'px';
              box.style.top  = Math.round(rect.bottom + window.scrollY + 6) + 'px';
              box.style.width= Math.round(rect.width) + 'px';
              box.innerHTML = '<div class="section">Suggerimenti</div>' + list.map(function(s){
                return '<a class="item" href="/cerca?q='+encodeURIComponent(s)+'"><i class="fa-solid fa-magnifying-glass"></i> '+s+'</a>';
              }).join('');
              box.classList.add('show');
            }
            var input = document.getElementById('site-search') || document.querySelector('.search-container input');
            if (input){
              input.addEventListener('input', debounce(showSuggestions, 300));
              input.addEventListener('blur', function(){ setTimeout(function(){ var b=document.getElementById('search-suggest-box'); if(b) b.classList.remove('show'); }, 200); });
            }
          })();
      </script>
      <script>
        // === Echi di Sofia — Append dataset per ricerca interna (articoli) ===
          // Attende che window.siteData esista, poi aggiunge gli articoli e, se presente,
          // richiama buildSearchIndex(siteData) per rigenerare l'indice.
          
          /* ==== Echi di Sofia — integrazione dati ricerca (merge sicuro, no duplicati) ==== */
(function(){
  "use strict";

  // Evita doppi inserimenti se lo script viene incluso due volte
  if (window.__ECHI_NEWINDEX_ADDED__) return;
  window.__ECHI_NEWINDEX_ADDED__ = true;

  /** Elenco nuovi articoli da integrare nella ricerca interna */
  const NEW_ITEMS = [
    {
      url: "articoli/austin.html",
      title: "J.L. Austin",
      content: "John Langshaw Austin (1911-1960), filosofo del linguaggio ordinario. Analisi degli atti linguistici e della teoria del performativo.",
      snippet: "Austin e la filosofia del linguaggio ordinario: atti linguistici e performativi."
    },
    {
      url: "articoli/bacon.html",
      title: "Francis Bacon",
      content: "Francis Bacon (1561-1626), filosofo e politico inglese. Padre del metodo induttivo e promotore della nuova scienza sperimentale.",
      snippet: "Bacon e il metodo induttivo: fondamenti della nuova scienza moderna."
    },
    {
      url: "articoli/dilthey.html",
      title: "Wilhelm Dilthey",
      content: "Wilhelm Dilthey (1833-1911), filosofo tedesco. Fondatore delle scienze dello spirito e teorico della comprensione ermeneutica.",
      snippet: "Dilthey: vita, opere e metodo delle scienze dello spirito."
    },
    {
      url: "articoli/gadamer.html",
      title: "Hans-Georg Gadamer",
      content: "Hans-Georg Gadamer (1900-2002), maestro dell’ermeneutica filosofica. Autore di Verità e metodo, elaborò la teoria della fusione degli orizzonti.",
      snippet: "Gadamer e l’ermeneutica filosofica: Verità e metodo."
    },
    {
      url: "articoli/habermas.html",
      title: "Jürgen Habermas",
      content: "Jürgen Habermas (1929-2023), filosofo tedesco della Scuola di Francoforte. Teoria dell’agire comunicativo e democrazia deliberativa.",
      snippet: "Habermas: teoria dell’agire comunicativo e filosofia politica."
    },
    {
      url: "articoli/lewis.html",
      title: "Clarence I. Lewis",
      content: "Clarence Irving Lewis (1883-1964), filosofo statunitense. Contributi alla logica simbolica, pragmatismo e teoria della conoscenza.",
      snippet: "Lewis: logica simbolica e pragmatismo americano."
    },
    {
      url: "articoli/quine.html",
      title: "W.V.O. Quine",
      content: "Willard Van Orman Quine (1908-2000), filosofo analitico. Critico del positivismo logico, sviluppò l’olismo epistemologico e la critica alla distinzione analitico/sintetico.",
      snippet: "Quine: olismo epistemologico e critica al positivismo logico."
    },
    {
      url: "articoli/schleiermacher.html",
      title: "Friedrich Schleiermacher",
      content: "Friedrich Schleiermacher (1768-1834), teologo e filosofo. Padre della moderna ermeneutica e promotore di un cristianesimo vissuto.",
      snippet: "Schleiermacher: ermeneutica e filosofia della religione."
    },
    {
      url: "articoli/searle.html",
      title: "John Searle",
      content: "John Rogers Searle (1932-2017), filosofo del linguaggio e della mente. Continuatore della filosofia di Austin, autore della teoria degli atti linguistici e della coscienza.",
      snippet: "Searle: atti linguistici e filosofia della mente."
    },
    {
      url: "articoli/circolo_di_vienna.html",
      title: "Circolo di Vienna",
      content: "Il Circolo di Vienna fu un gruppo di filosofi e scienziati del primo Novecento che sviluppò l'empirismo logico e il principio di verificazione.",
      snippet: "Circolo di Vienna: empirismo logico e principio di verificazione nel XX secolo."
    },
    {
      url: "articoli/platone_mito_caverna.html",
      title: "Il Mito della Caverna di Platone",
      content: "Un'analisi approfondita del Mito della Caverna di Platone con interpretazioni filosofiche e significato contemporaneo.",
      snippet: "Platone - Mito della Caverna, filosofia, allegoria, epistemologia, metafisica, Repubblica."
    },
    {
      url: "articoli/wittgenstein.html",
      title: "Ludwig Wittgenstein",
      content: "Ludwig Wittgenstein (1889-1951), filosofo austriaco. Due fasi: Tractatus logico-philosophicus e Ricerche filosofiche. Cruciale per la filosofia del linguaggio.",
      snippet: "Wittgenstein: Tractatus e Ricerche filosofiche."
    },
    {
      url: "articoli/democrito1.html",
      title: "Democrito",
      content: "Democrito di Abdera (ca. 460-370 a.C.), filosofo presocratico. Teoria atomistica della realtà, conoscenza come convenzione, etica dell’equilibrio interiore.",
      snippet: "Democrito: atomi e vuoto, filosofia presocratica."
    },
    {
      url: "articoli/althusser.html",
      title: "Louis Althusser",
      content: "Louis Althusser (1918-1990), filosofo marxista francese. Lettura strutturalista di Marx, concetto di apparati ideologici di Stato.",
      snippet: "Althusser: marxismo strutturalista e apparati ideologici di Stato."
    },
    {
      url: "articoli/bergson1.html",
      title: "Henri Bergson",
      content: "Henri Bergson (1859-1941), filosofo francese. Slancio vitale, intuizione e critica al meccanicismo scientifico.",
      snippet: "Bergson: intuizione, tempo e slancio vitale."
    },
    {
      url: "articoli/dreyfus.html",
      title: "Hubert Dreyfus",
      content: "Hubert Dreyfus (1929-2017), filosofo statunitense. Critico dell’IA forte, interprete di Heidegger, fenomenologia applicata.",
      snippet: "Dreyfus: fenomenologia e critica all’IA forte."
    },
    {
      url: "articoli/l%C3%A9vi-strauss.html",
      title: "Claude Lévi-Strauss",
      content: "Claude Lévi-Strauss (1908-2009), antropologo e pensatore strutturalista. Analisi dei miti, parentela, strutture culturali.",
      snippet: "Lévi-Strauss: antropologia strutturalista e studio dei miti."
    },
    {
      url: "articoli/malinowski.html",
      title: "Bronisław Malinowski",
      content: "Bronisław Malinowski (1884-1942), antropologo polacco. Pioniere dell’etnografia sul campo e del funzionalismo culturale.",
      snippet: "Malinowski: etnografia e funzionalismo culturale."
    },
    {
      url: "articoli/marco%20aurelio.html",
      title: "Marco Aurelio",
      content: "Esplorazione della vita, della filosofia e dell’eredità di Marco Aurelio, autore delle Meditazioni e figura chiave dello stoicismo romano.",
      snippet: "Marco Aurelio, Stoicismo, Meditazioni."
    },
    {
      url: "articoli/battaglio_maratona.html",
      title: "La Battaglia di Maratona",
      content: "Lo scontro del 490 a.C. tra Atene e l’Impero persiano: contesto, strategia, conseguenze storiche.",
      snippet: "Battaglia di Maratona: Grecia antica, Persiani, Ateniesi, Milziade, Dario I."
    },
    {
      url: "articoli/ricoeur.html",
      title: "Paul Ricoeur",
      content: "Paul Ricoeur (1913-2005), filosofo francese. Ermeneutica, identità narrativa, memoria e tempo.",
      snippet: "Ricoeur: ermeneutica, identità e narrazione."
    }
  ];

  /* ---------- utilità ---------- */

  // Normalizza URL per confronto (minuscole + decode se possibile)
  function normUrl(u){
    try { return decodeURI(String(u).trim()).toLowerCase(); }
    catch { return String(u).trim().toLowerCase(); }
  }

  // Pulisce i campi testo
  function cleanText(s){ return (s == null ? "" : String(s)).replace(/\s+/g,' ').trim(); }

  // Normalizza un item
  function normalizeItem(it){
    return {
      url: cleanText(it.url),
      title: cleanText(it.title),
      content: cleanText(it.content),
      snippet: cleanText(it.snippet)
    };
  }

  // Merge senza duplicati (preferenza: elementi esistenti, poi NEW_ITEMS)
  function mergeNoDupes(existingArr, toAddArr){
    const out = [];
    const seen = new Map(); // key: urlNorm  value: true
    // prima gli esistenti
    for (const raw of existingArr || []){
      const it = normalizeItem(raw);
      const key = normUrl(it.url) || it.title.toLowerCase();
      if (!seen.has(key)){
        seen.set(key, true);
        out.push(it);
      }
    }
    // poi i nuovi
    for (const raw of toAddArr || []){
      const it = normalizeItem(raw);
      const key = normUrl(it.url) || it.title.toLowerCase();
      if (!seen.has(key)){
        seen.set(key, true);
        out.push(it);
      }
    }
    return out;
  }

  // Applica merge a window.siteData (crea l’array se assente)
  function applyMerge(){
    if (!Array.isArray(window.siteData)) window.siteData = [];
    window.siteData = mergeNoDupes(window.siteData, NEW_ITEMS);

    // Hook opzionale: notifica eventuale motore di ricerca interno
    try {
      if (window.EchiSearch && typeof window.EchiSearch.refreshIndex === 'function'){
        window.EchiSearch.refreshIndex(window.siteData);
      }
    } catch(_) {}
  }

  /* ---------- poll semplice: attende siteData o lo crea ---------- */
  (function waitAndMerge(maxMs){
    const start = performance.now();
    const timer = setInterval(() => {
      const ready = Array.isArray(window.siteData);
      const timedOut = (performance.now() - start) > maxMs;
      if (ready || timedOut){
        clearInterval(timer);
        applyMerge();
      }
    }, 120);
  })(3000);

})();

            let tries = 0;
            const MAX_TRIES = 30;
            const iv = setInterval(() => {
              tries++;
              if (Array.isArray(window.siteData)) {
                // Evita duplicati: controlla per URL
                const existing = new Set(window.siteData.map(i => i.url));
                const toAdd = NEW_ITEMS.filter(i => !existing.has(i.url));
                if (toAdd.length) window.siteData.push(...toAdd);
          
                // Se c'è un builder d'indice, rigeneralo
                if (typeof window.buildSearchIndex === "function") {
                  try { window.buildSearchIndex(window.siteData); } catch(e) { console.warn(e); }
                }
                clearInterval(iv);
                console.log("[Ricerca interna] Aggiunti articoli:", toAdd.length);
              } else if (tries >= MAX_TRIES) {
                // Fallback: crea siteData se proprio non esiste
                window.siteData = NEW_ITEMS.slice();
                if (typeof window.buildSearchIndex === "function") {
                  try { window.buildSearchIndex(window.siteData); } catch(e) { console.warn(e); }
                }
                clearInterval(iv);
                console.warn("[Ricerca interna] siteData non trovato: creato dataset con soli articoli.");
              }
            }, 100);
          })();
      </script>
      <!-- SAFARI TUONO STABILIZER (final block) -->
      <script>
        (function(){
            var btn = document.getElementById('btn-thunder') ||
                      Array.from(document.querySelectorAll('button,[role="button"]')).find(function(b){ return /tuono|⚡/i.test(b.textContent||''); });
            var audio = document.getElementById('thunder-sound');
            if (!btn) return;
          
            // Remove previous listeners by cloning (safe, non-destructive)
            var clone = btn.cloneNode(true);
            btn.parentNode.replaceChild(clone, btn);
            btn = document.getElementById('btn-thunder') || clone;
          
            // Simple WebAudio fallback for Safari if webAudioThunder is not defined
            function synthThunder(){
              try{
                var AC = window.AudioContext || window.webkitAudioContext;
                var ctx = new AC();
                var sr = ctx.sampleRate, dur = 1.8, n = (sr*dur)|0;
                var buf = ctx.createBuffer(1, n, sr), ch = buf.getChannelData(0);
                var last = 0;
                for (var i=0;i<n;i++){
                  var t = i/sr, white = Math.random()*2-1;
                  var brown = (last + 0.02*white)/1.02; last = brown;
                  var env = Math.exp(-2.2*t);
                  ch[i] = Math.max(-1, Math.min(1, (brown*0.8 + white*0.2) * env));
                }
                var src = ctx.createBufferSource(); src.buffer = buf;
                var g = ctx.createGain(); g.gain.value = 0.9;
                src.connect(g).connect(ctx.destination);
                src.start();
              }catch(e){}
            }
          
            function playSafari(){
              if (typeof window.webAudioThunder === "function") return window.webAudioThunder();
              return Promise.resolve().then(synthThunder);
            }
          
            var isSafari = /Safari\//.test(navigator.userAgent) && !/Chrome|Chromium|Edg\//.test(navigator.userAgent);
          
            btn.addEventListener('click', function(ev){
              ev.preventDefault();
              if (isSafari) { playSafari(); return; }
              if (!audio) return;
              try { audio.currentTime = 0; var p = audio.play(); if (p && p.catch) p.catch(function(e){}); } catch(e){}
            }, {passive:false});
          })();
      </script>
      <script>
        (() => {
            // --- TROVA ELEMENTI ---
            const baseEl = document.getElementById('explosionSound');
            if (!baseEl) { console.warn('[ExplodePool] <audio id="explosionSound"> non trovato'); return; }
          
            // Bottone: prima prova per id, poi per testo (Esplodi/💥)
            let btn = document.getElementById('explode-btn');
            if (!btn) {
              btn = Array.from(document.querySelectorAll('button, [role="button"], .btn')).find(b =>
                /esplod|💥/i.test((b.textContent||'') + ' ' + (b.getAttribute('aria-label')||''))
              ) || null;
            }
            if (!btn) { console.warn('[ExplodePool] bottone "Esplodi" non trovato'); return; }
          
            // --- RICAVA LA SORGENTE DELL’AUDIO ESISTENTE ---
            const sources = Array.from(baseEl.querySelectorAll('source')).map(s => s.src).filter(Boolean);
            const primarySrc = baseEl.currentSrc || sources[0] || baseEl.src;
            if (!primarySrc) { console.warn('[ExplodePool] nessuna src per l’esplosione'); return; }
          
            // --- CREA UN POOL DI AUDIO PER CONSENTIRE CLICK RIPETUTI ---
            const POOL_SIZE = 4;
            const pool = [];
            for (let i=0; i<POOL_SIZE; i++){
              const a = new Audio(primarySrc);
              a.preload = 'auto';
              try { a.playsInline = true; } catch(_) {}
              pool.push(a);
            }
          
            // --- SBLOCCO AUDIO AL PRIMO GESTO (Safari) ---
            let unlocked = false;
            const unlock = async () => {
              if (unlocked) return;
              unlocked = true;
              // “tocca” anche il baseEl per compatibilità
              const all = [baseEl, ...pool];
              for (const a of all) {
                try { a.muted = false; await a.play(); a.pause(); a.currentTime = 0; } catch(_) {}
              }
            };
            window.addEventListener('pointerdown', unlock, {once:true, capture:true, passive:true});
            window.addEventListener('keydown', unlock, {once:true, capture:true});
          
            // --- SCEGLI UN’ISTANZA LIBERA E SUONA ---
            function playExplosion(){
              // trova un player pronto (pausato o terminato)
              let a = pool.find(x => x.paused || x.ended);
              if (!a) {
                // se tutti occupati, clona al volo (caso di spam click)
                a = new Audio(primarySrc);
                try { a.playsInline = true; } catch(_) {}
                a.preload = 'auto';
                pool.push(a);
              }
              try {
                a.currentTime = 0;
                const p = a.play();
                if (p && p.catch) p.catch(()=>{ /* Safari può rifiutare promesse se non “unlocked” */ });
              } catch(_){}
            }
          
            // --- EVITA LISTENER DUPLICATI (sostituisci il bottone con un clone) ---
            const clone = btn.cloneNode(true);
            btn.parentNode.replaceChild(clone, btn);
            const safeBtn = document.getElementById('explode-btn') || clone;
          
            safeBtn.addEventListener('click', (ev) => {
              ev.preventDefault();
              playExplosion();
            });
          
            // --- LOG MINIMO (aiuta debug senza sporcare) ---
            baseEl.addEventListener('canplaythrough', () => console.log('[ExplodePool] base pronto'));
          })();
      </script>
      <!-- Inserimento immagini fluttuanti tra i simboli/parole -->
      <script>
        (function(){
            function getLayer(){
              const p = document.querySelector('.particle');
              if (p && p.parentNode) return p.parentNode;
              return document.getElementById('philoParticles') || document.body;
            }
          
            function addFloatingPerson(src, opts){
              opts = opts || {};
              const sizeRem = opts.sizeRem || 6;
              const alt = opts.alt || 'Foto';
              const layer = getLayer();
          
              const img = new Image();
              img.decoding = 'async';
              img.loading = 'lazy';
              img.src = src;
              img.alt = alt;
              img.className = 'particle float-person';
              img.style.width  = sizeRem + 'rem';
              img.style.height = sizeRem + 'rem';
          
              layer.appendChild(img);
          
              // posizionamento iniziale visibile (centro)
              img.style.transform = 'translate(' + Math.round(window.innerWidth/2) + 'px,' + Math.round(window.innerHeight/2) + 'px)';
          
              const speedBase = (window.cfg && typeof cfg.minSpeed==='number' && typeof cfg.maxSpeed==='number')
                ? (Math.random() * (cfg.maxSpeed - cfg.minSpeed) + cfg.minSpeed)
                : 0.004;
          
              const p = {
                el: img,
                x0: Math.random() * window.innerWidth,
                y0: Math.random() * window.innerHeight,
                phase: Math.random() * Math.PI * 2,
                speed: speedBase,
                type: 'person'
              };
          
              // Se esiste un array globale usato dal tuo loop, inserisci lì
              if (Array.isArray(window.particles)) {
                window.particles.push(p);
              } else if (Array.isArray(window.symbols)) {
                window.symbols.push(p);
              } else {
                // Fallback: movimento autonomo (non tocca il tuo loop)
                let last = performance.now();
                (function selfMove(now){
                  const dt = Math.min(0.05, ((now||performance.now()) - last)/1000);
                  last = (now||performance.now());
                  p.phase += p.speed * dt * 60;
                  const fd = (window.cfg && cfg.floatDist) ? cfg.floatDist : 90;
                  const dx = Math.cos(p.phase) * fd;
                  const dy = Math.sin(p.phase) * fd;
                  p.el.style.transform = 'translate(' + (p.x0 + dx) + 'px,' + (p.y0 + dy) + 'px)';
                  requestAnimationFrame(selfMove);
                })();
              }
              return p;
            }
          
            // Inserisci entrambe le foto
            function initPhotos(){
              addFloatingPerson('https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/maria_teresa.jpg',
                { sizeRem: 2, alt: 'Maria Teresa' });
              addFloatingPerson('https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/krk.jpg',
                { sizeRem: 1.5, alt: 'KRK' });
            }
          
            if (document.readyState === 'loading'){
              document.addEventListener('DOMContentLoaded', initPhotos);
            } else {
              setTimeout(initPhotos, 0);
            }
          
            // Esporta utility per eventuali aggiunte future
            window.addFloatingPerson = addFloatingPerson;
          })();
      </script>
  
<!-- ======= Miglioramenti Conservativi (iniettati) ======= -->
<script>
// 3) Gestione errori JS: Thunder controller guard
try {
  window.__echiThunder = true;
} catch (error) {
  console.error('Errore inizializzazione thunder:', error);
}

// 5) Cookie consent fallback
try {
  if (!localStorage.getItem('cookieConsent')) {
    setTimeout(() => {
      const banner = document.getElementById('cookie-banner');
      if (banner) banner.style.display = 'block';
    }, 2000);
  }
} catch(e){ console.warn('Cookie fallback non applicato:', e); }

// 6) Debounce per ricerca (senza rompere funzioni esistenti)
(function(){
  let __searchTimeout;
  // Se esiste window.executeQuery, lo wrappo con debounce; altrimenti espongo un helper
  const _orig = window.executeQuery;
  window.debouncedExecuteQuery = function(q){
    clearTimeout(__searchTimeout);
    __searchTimeout = setTimeout(() => {
      try {
        if (typeof _orig === 'function') _orig(q);
      } catch(e){ console.error('Errore executeQuery:', e); }
    }, 300);
  };
})();

// 7) Fallback audio generico
window.playAudioFallback = function(audioElement, sources){
  let i = 0;
  function tryPlay(){
    if (!audioElement || !sources || i >= sources.length) return;
    audioElement.src = sources[i];
    const p = audioElement.play();
    if (p && typeof p.catch === 'function'){
      p.catch(() => { i++; tryPlay(); });
    }
  }
  tryPlay();
};

// 4) Ottimizzazione immagini slider (aggiunge attributi se mancano)
(function(){
  try {
    const imgs = document.querySelectorAll('.slide-vertical img');
    imgs.forEach(img => {
      if (!img.getAttribute('loading')) img.setAttribute('loading','lazy');
      if (!img.getAttribute('decoding')) img.setAttribute('decoding','async');
      if (!img.getAttribute('width')) img.setAttribute('width','260');
      if (!img.getAttribute('height')) img.setAttribute('height','140');
    });
  } catch(e){ console.warn('Ottimizzazione immagini slider non applicata:', e); }
})();

// 8) Ottimizza animazione slider (usa transform) SE non già gestito altrove
(function(){
  try {
    const inner = document.querySelector('.slider-vertical .slider-inner');
    if(!inner) return;
    if (getComputedStyle(inner).transform !== 'none') return; // già gestito da CSS/JS esistente
    let y = 0, paused = false, speed = 0.35;
    function step(){
      if (!paused){
        y += speed;
        if (y >= inner.scrollHeight/2) y = 0;
        inner.style.transform = 'translate3d(0, -'+y+'px, 0)';
      }
      requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
    // Esponi API non invasive
    window.__sliderEnh = {
      pause(){ paused = true; },
      play(){ paused = false; },
      setSpeed(v){ speed = Math.max(0, Number(v)||speed); }
    };
  } catch(e){ console.warn('Ottimizzazione slider non attiva:', e); }
})();

// 10) Fallback Google Translate (solo warning)
setTimeout(() => {
  try {
    if (!document.querySelector('.goog-te-menu-frame')) {
      console.warn('Google Translate non caricato, attivando fallback (solo avviso)');
      // Qui potresti mostrare un messaggio o un selettore alternativo.
    }
  } catch(e){}
}, 5000);
</script>
<!-- ======= Fine Miglioramenti Conservativi ======= -->


<!-- ===== SCRIPTS — Ottimizzazioni conservative v2 ===== -->
<script>
window.loadAudio = function(src){
  return new Promise(function(resolve){
    try{
      var audio = new Audio();
      audio.preload = 'auto';
      audio.src = src;
      function done(){
        audio.removeEventListener('canplaythrough', done);
        resolve(audio);
      }
      audio.addEventListener('canplaythrough', done, {once:true});
      audio.addEventListener('loadeddata', done, {once:true});
    }catch(e){ resolve(null); }
  });
};

(function(){
  try{
    var imgs = document.querySelectorAll('.slide-vertical img');
    imgs.forEach(function(img){
      if(!img.getAttribute('loading')) img.setAttribute('loading','lazy');
      if(!img.getAttribute('decoding')) img.setAttribute('decoding','async');
      if(!img.getAttribute('width')) img.setAttribute('width','260');
      if(!img.getAttribute('height')) img.setAttribute('height','340');
    });
  }catch(e){}
})();

document.body.addEventListener('click', function(e){
  var el = e.target;
  var btnThunder = el.closest && (el.closest('#btn-thunder') || el.closest('#play-thunder'));
  var btnExplode = el.closest && (el.closest('#btn-explode') || el.closest('#explode-btn'));
  try{
    if(btnThunder){
      if(typeof window.handleThunder === 'function') window.handleThunder();
      else if(typeof window.playThunder === 'function') window.playThunder();
    }
    if(btnExplode){
      if(typeof window.handleExplosion === 'function') window.handleExplosion();
      else if(typeof window.explodeNow === 'function') window.explodeNow();
    }
  }catch(err){}
}, {passive:true});

(function(){
  try{
    var style = document.createElement('style');
    style.textContent = ".mega-menu{transition:opacity .2s ease,visibility .2s ease;will-change:opacity,transform}";
    document.head.appendChild(style);
  }catch(e){}
})();

setInterval(function(){
  try{
    document.querySelectorAll('canvas').forEach(function(c){
      var ctx = c.getContext && (c.getContext('2d') || c.getContext('webgl') || c.getContext('webgl2'));
      if(!ctx) return;
      if(ctx.clearRect){
        ctx.clearRect(0,0,c.width,c.height);
      }else if(ctx instanceof WebGLRenderingContext || ctx instanceof WebGL2RenderingContext){
        var gl = ctx;
        var buf = gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT;
        gl.clear(buf);
      }
    });
  }catch(e){}
}, 1000);

window.loadGoogleTranslate = function(){
  try{
    if(document.querySelector('.goog-te-banner') || document.getElementById('google-translate-script')) return;
    var s = document.createElement('script');
    s.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
    s.id = 'google-translate-script';
    document.head.appendChild(s);
  }catch(e){}
};
</script>
<!-- ===== FINE SCRIPT v2 ===== -->


<script data-mobile-drawer-cse-js="">
(function(){
  "use strict";
  if (window.__ECHI_MOBILE_DRAWER__) return;
  window.__ECHI_MOBILE_DRAWER__ = true;

  function setTopbarHeight(){
    var candidates = [
      '.topbar','.top-bar','#topbar','#site-topbar','.header-top','.site-header','header'
    ];
    var h = 64;
    for(var i=0;i<candidates.length;i++){
      var el = document.querySelector(candidates[i]);
      if(el){
        var r = el.getBoundingClientRect();
        if(r && r.height){ h = Math.max(h, Math.round(r.height)); break; }
      }
    }
    document.documentElement.style.setProperty('--topbar-height', h + 'px');
  }

  function toggleDrawerOpen(open){
    if(window.innerWidth > 980) return;
    document.body.classList.toggle('drawer-open', !!open);
  }

  function attachSuggestObservers(){
    var box = document.getElementById('cse-suggest');
    if(!box) return;
    // MutationObserver per aggiungere/rimuovere classe drawer-open quando la tendina si apre/chiude
    var obs = new MutationObserver(function(){
      var isOpen = box.classList.contains('show') && box.innerHTML.trim().length > 0;
      toggleDrawerOpen(isOpen);
    });
    obs.observe(box, { attributes:true, childList:true, subtree:false });
  }

  // Opzione "soft" automatica se schermo stretto
  function maybeEnableCosmoSoft(){
    var prefersReduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReduce || window.innerWidth < 480){
      document.body.classList.add('cosmo-soft');
    }
  }

  window.addEventListener('resize', setTopbarHeight, {passive:true});
  window.addEventListener('orientationchange', setTopbarHeight, {passive:true});
  document.addEventListener('DOMContentLoaded', function(){
    setTopbarHeight();
    attachSuggestObservers();
    maybeEnableCosmoSoft();
  });
})();
</script>


<script data-a11y-perf-conservative="">
(function(){
  "use strict";
  if (window.__A11Y_PERF_CONSERVATIVE__) return;
  window.__A11Y_PERF_CONSERVATIVE__ = true;

  window.safeCall = function(name, fn){
    try { if (typeof fn === 'function') return fn(); }
    catch (err) { console.warn(name + " failed:", err); }
  };
  window.createManagedListener = function(el, ev, handler, opts){
    if(!el || !el.addEventListener) return function(){};
    el.addEventListener(ev, handler, opts||false);
    return function(){ try{ el.removeEventListener(ev, handler, opts||false); }catch(_){ } };
  };

  document.addEventListener('visibilitychange', function(){
    const reduce = document.visibilityState === 'hidden';
    document.documentElement.classList.toggle('reduce-motion', reduce);
  }, { passive: true });

  function ensureId(el, prefix){
    if(!el) return null;
    if(el.id) return el.id;
    const id = (prefix||'id') + '-' + Math.random().toString(36).slice(2,9);
    el.id = id;
    return id;
  }

  function setupAriaMenus(){
    const dropdowns = document.querySelectorAll('nav.menu-desktop li.dropdown');
    dropdowns.forEach(function(li){
      const trigger = li.querySelector('a, .menu-btn');
      const panel = li.querySelector('.mega-menu');
      if(!trigger || !panel) return;
      const pid = ensureId(panel, 'mega-menu');
      trigger.setAttribute('aria-haspopup', 'true');
      trigger.setAttribute('aria-controls', pid);
      trigger.setAttribute('aria-expanded', 'false');

      function setExpanded(v){ trigger.setAttribute('aria-expanded', v ? 'true' : 'false'); }
      li.addEventListener('mouseenter', function(){ setExpanded(true); }, {passive:true});
      li.addEventListener('mouseleave', function(){ setExpanded(false); }, {passive:true});
      li.addEventListener('focusin',  function(){ setExpanded(true); });
      li.addEventListener('focusout', function(e){
        if(!li.contains(e.relatedTarget)) setExpanded(false);
      });
    });
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', setupAriaMenus);
  } else {
    setupAriaMenus();
  }
})();
</script>

</body>
</html>
